const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lerc-wasm-DAWotuvb.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/geodesicLengthMeasurementUtils-DMAU1D8e.js","assets/quantityUtils-Dl0jCqxL.js","assets/index-DJGFuZJs.js","assets/geometryEngineBase-B0ZyeKAX.js","assets/hydrated-CVaIgpwV.js","assets/geodesicUtils-Bu_GZrAj.js"])))=>i.map(i=>d[i]);
import{jW as xs,S as Lt,c8 as kt,aS as Ds,G as b,H as P,I as _,cF as Xt,c4 as Ie,a as Z,K as er,b3 as _t,af as mo,s as xt,iL as go,bj as yo,aP as Pn,de as wo,aI as ur,n as Gs,b5 as _s,J as In,c9 as At,ca as bo,cb as vo,qO as xo,qP as Rn,cs as jt,qQ as Ue,qR as Co}from"./index-DJGFuZJs.js";import{b as Cs,a as $,l as je,s as Qt,o as Zt,h as kr,u as Ao,c as rr,d as ke,i as To,e as Nn,j as yt,r as So,k as Fn,n as Pr,p as $n,w as ko,q as Gt,t as Po,y as Io,v as Ro,x as No,f as Fo,W as $o,E as Mo,z as Eo,D as Oo,R as Bo,A as Do,B as Go}from"./dataUtils-DVJiFX9x.js";import{o as Mn}from"./_commonjsHelpers-DCkdB7M8.js";import{B as gr,C as Ls,H as Us,U as Fr}from"./colorUtils-BBQ_f_hl.js";import{V as _o,Z as Lo,w as Uo,j as jo,a as zo}from"./rasterProjectionHelper-AVvwgZHQ.js";const xc=xs()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),Cc=xs()({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"}),Vo=xs()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"}),Wo=["random","ndvi","ndvi2","ndvi3","elevation","gray","hillshade"],En=[{id:"aspect",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"black-to-white",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blue-bright",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blue-light-to-dark",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blue-green-bright",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blue-green-light-to-dark",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brown-light-to-dark",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brown-to-blue-green-diverging-right",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brown-to-blue-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficient-bias",fromColor:[214,214,255],toColor:[0,57,148]},{id:"cold-to-hot-diverging",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"condition-number",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyan-to-purple",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyan-light-to-blue-dark",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors",fromColor:[255,235,214],toColor:[196,10,10]},{id:"gray-light-to-dark",fromColor:[219,219,219],toColor:[69,69,69]},{id:"green-bright",fromColor:[204,255,204],toColor:[14,204,14]},{id:"green-light-to-dark",fromColor:[220,245,233],toColor:[34,102,51]},{id:"green-to-blue",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orange-bright",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orange-light-to-dark",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partial-spectrum",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partial-spectrum-1-diverging",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partial-spectrum-2-diverging",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pink-to-yellow-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pink-to-yellow-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purple-bright",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purple-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purple-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purple-blue-bright",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purple-blue-light-to-dark",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purple-red-bright",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purple-red-light-to-dark",fromColor:[250,215,246],toColor:[143,17,57]},{id:"red-bright",fromColor:[255,204,204],toColor:[219,0,0]},{id:"red-light-to-dark",fromColor:[255,224,224],toColor:[143,10,10]},{id:"red-to-blue-diverging-bright",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"red-to-blue-diverging-dark",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"red-to-green",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"red-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"red-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrum-full-bright",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrum-full-dark",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrum-full-light",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"white-to-black",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellow-to-dark-red",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellow-to-green-to-dark-blue",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellow-to-red",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellow-green-bright",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellow-green-light-to-dark",fromColor:[215,240,175],toColor:[96,107,45]}],Yt=new kt({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging","Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging","Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","Purple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark","Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark","Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});function lr(r,t){if(!r||!t||r.length!==t.length)return!1;for(let e=0;e<r.length;e++)if(r[e]>t[e]+2||r[e]<t[e]-2)return!1;return!0}function js(r){const t=r.clone();return t.fromColor=r.toColor,t.toColor=r.fromColor,t.algorithm=r.algorithm,t}function Ho(r){var t;if(r.type==="multipart"){const e=r.clone();return(t=e.colorRamps)!=null&&t.length&&(e.colorRamps=e.colorRamps.reverse().map(s=>js(s))),e}return js(r)}function zs(r,t){if(!r)return;const e=En;let s=null;return r.type==="algorithmic"?e.some(n=>{if(lr(r.fromColor.toRgb(),n.fromColor)&&lr(r.toColor.toRgb(),n.toColor))return s=n.id,!0}):r.type==="multipart"&&e.some(n=>{const i=r.colorRamps,a=n.colorRamps;if(i&&a&&i.length===a.length&&!a.some((o,l)=>{if(!lr(i[l].fromColor.toRgb(),new Ds(o.fromColor).toRgb())||!lr(i[l].toColor.toRgb(),new Ds(o.toColor).toRgb()))return!0})){if(s)return!0;s=n.id}}),s}function Jo(r,t,e=!1){if(!r)return;let s=!1,n=zs(r);return n!=null||e||(s=!0,n=zs(r=Ho(r))),n?{id:n,inverted:s}:void 0}function qo(r,t=!1){var s;const e=typeof r=="string"?r:(s=Jo(r,void 0,t))==null?void 0:s.id;return e?Yt.toJSON(e):null}function On(r,t="esriCIELabAlgorithm"){const e=En.find(({id:s})=>s===r);return e?e.colorRamps?{type:"multipart",colorRamps:e.colorRamps.map(s=>({type:"algorithmic",algorithm:t,fromColor:[...s.fromColor],toColor:[...s.toColor]}))}:{type:"algorithmic",algorithm:t,fromColor:[...e.fromColor],toColor:[...e.toColor]}:null}function Bn(r){const t=(r=r||{}).numColors||256,e=r.distanceOffset||0,s=r.isCustomInterval!=null?r.isCustomInterval:r.distanceInterval!==null&&r.distanceInterval!==1/(t-1),n=r.distanceInterval||1/(t-1);return{...r,numColors:t,distanceOffset:e,interpolateAlpha:!!r.interpolateAlpha,distanceInterval:n,isCustomInterval:s,weights:r.weights}}function Ko(r,t,e){const{numColors:s,distanceOffset:n,distanceInterval:i,isCustomInterval:a}=e,o=r.s===0,l=t.s===0;let u=r.h,p=t.h;o&&!l?u=p:l&&!o&&(t={...t,h:u},p=u);let c,h=Math.abs(p-u);const f=360;h<f/2?c=(p-u)*i:(h=f-h,c=u>p?h*i:-h*i);const m=(t.s-r.s)*i,y=(t.v-r.v)*i;let{s:d,v}=r,w=u;if(n){const g=n/i;w=(w+g*c+f)%f,d+=g*m,v+=g*y}const T=[];for(let g=0;g<s-1;g++)T.push({h:w,s:d,v}),w=(w+c+f)%f,d+=m,v+=y;return T.push(a?{h:w,s:d,v}:t),T}function Yo(r,t,e){const{numColors:s,distanceOffset:n,distanceInterval:i,isCustomInterval:a}=e;let{l:o,a:l,b:u}=r;const p=(t.l-o)*i,c=(t.a-l)*i,h=(t.b-u)*i,f=[];if(n){const m=n/i;o+=m*p,l+=m*c,u+=m*h}for(let m=0;m<s-1;m++)f.push({l:o,a:l,b:u}),o+=p,l+=c,u+=h;return f.push(a?{l:o,a:l,b:u}:t),f}function Xo(r,t,e){const{numColors:s,distanceOffset:n,distanceInterval:i,isCustomInterval:a}=e,o=r.h,l=t.h,u=2*Math.PI;let p;if(o<=l){const w=l-o,T=l-o-u;p=Math.abs(T)<Math.abs(w)?T:w}else{const w=l+u-o,T=l-o;p=Math.abs(T)<Math.abs(w)?T:w}const c=p*i,h=(t.l-r.l)*i,f=(t.c-r.c)*i;let{l:m,c:y,h:d}=r;if(n){const w=n/i;m+=w*h,y+=w*f,d=(d+w*c+u)%u}const v=[];for(let w=0;w<s-1;w++)v.push({l:m,c:y,h:d}),m+=h,y+=f,d=(d+c+u)%u;return v.push(a?{l:m,c:y,h:d}:t),v}function Dn(r,t){let{fromColor:e,toColor:s}=r;e=[...e],s=[...s],e.length===3&&(e=e.concat([255])),s.length===3&&(s=s.concat([255]));const n=r.algorithm||"esriCIELabAlgorithm",i=Bn(t),{numColors:a,distanceOffset:o,isCustomInterval:l,interpolateAlpha:u}=i;if(a===1&&o===0)return[e];if(a===2&&o===0&&!l)return[e,s];const p={r:e[0],g:e[1],b:e[2]},c={r:s[0],g:s[1],b:s[2]},h=n==="esriCIELabAlgorithm"?Yo(Ls(p),Ls(c),i):n==="esriHSVAlgorithm"?Ko(gr(p),gr(c),i):Xo(Us(p),Us(c),i),f=[],m=e[3]??255,y=((s[3]??255)-m)/(a-1);for(let d=0;d<a;d++){const{r:v,g:w,b:T}=Fr(h[d]),g=u?Math.round(m+y*d):255;f.push([v,w,T,g])}return f}function Zo(r,t){const{numColors:e,interpolateAlpha:s}=Bn(t);let n=t==null?void 0:t.weights;const{colorRamps:i}=r;if(n){const c=n.reduce((h,f)=>h+f);n=n.map(h=>h/c)}else{n=[];for(let c=0;c<i.length;c++)n[c]=1/i.length}const a=[],o=1/(e-1);let l=0,u=!1;for(let c=0;c<i.length;c++){const h=a.length,f=u?0:h*o-l;l+=n[c];let m=c===i.length-1?e-1-h:(n[c]-f)/o;if(u=Math.ceil(m)===m,m=Math.ceil(m),m===0)continue;const y=Dn(i[c],{numColors:m,interpolateAlpha:s,distanceOffset:f/n[c],distanceInterval:o/n[c]});a.push(...y)}const p=[...i[i.length-1].toColor];return p.length===3&&p.push(255),a.push(p),a}function As(r,t){const e=Lt.isSerializable(r)?r.toJSON():r;return e.type==="multipart"?Zo(e,t):Dn(e,t)}function sr(r,t){const e=As(r,t),s=t==null?void 0:t.interpolateAlpha;return e.forEach((n,i)=>{n.unshift(i),s||n.pop()}),e}function Gn(r){const t=[];for(let e=0;e<r.length;e+=4){const s=gr({r:r[e],g:r[e+1],b:r[e+2]});t.push([s.h/60,s.s/100,255*s.v/100])}return t}function Vs(r){const t=gr(r);return{type:"HsvColor",Hue:t.h,Saturation:t.s,Value:t.v,AlphaValue:255}}function Ws(r){const t=r.toJSON();return{Algorithm:(t==null?void 0:t.Algorithm)||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:Vs(r.fromColor),ToColor:Vs(r.toColor)}}function Ac(r){const t=qo(r);if(!t)return null;if(r.type==="algorithmic")return{...Ws(r),Name:t};if(r.colorRamps){const e=r.colorRamps.map(Ws);return{type:"MultiPartColorRamp",NumColorRamps:e.length,ArrayOfColorRamp:e,Name:t}}return null}function Tc(r){const t=r.reverse().map(e=>{const s=e.toString(16);return s.length<2?"0"+s:s});return 4294967295&Number.parseInt(t.join(""),16)}const Sc=new kt({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),Qo={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"};var $r;function oe(r){return r=Number(r),isNaN(r)?void 0:r}let Rt=$r=class extends Lt{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}clone(){return new $r({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};b([P({json:{name:"BandName",write:!0}})],Rt.prototype,"name",void 0),b([P({json:{name:"WavelengthMin",read:{reader:oe},write:!0}})],Rt.prototype,"minWavelength",void 0),b([P({json:{name:"WavelengthMax",read:{reader:oe},write:!0}})],Rt.prototype,"maxWavelength",void 0),b([P({json:{name:"RadianceBias",read:{reader:oe},write:!0}})],Rt.prototype,"radianceBias",void 0),b([P({json:{name:"RadianceGain",read:{reader:oe},write:!0}})],Rt.prototype,"radianceGain",void 0),b([P({json:{name:"ReflectanceBias",read:{reader:oe},write:!0}})],Rt.prototype,"reflectanceBias",void 0),b([P({json:{name:"ReflectanceGain",read:{reader:oe},write:!0}})],Rt.prototype,"reflectanceGain",void 0),b([P({json:{name:"SolarIrradiance",read:{reader:oe},write:!0}})],Rt.prototype,"solarIrradiance",void 0),Rt=$r=b([_("esri.layers.support.RasterBandInfo")],Rt);const Hs=Rt;var Mr;function Je(r){return r=Number(r),isNaN(r)?void 0:r}let Ct=Mr=class extends Lt{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(r){return new Date(r)}writeAcquisitionDate(r,t){t.AcquisitionDate=r.getTime()}clone(){return new Mr({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};b([P({type:Date,json:{name:"AcquisitionDate",write:!0}})],Ct.prototype,"acquisitionDate",void 0),b([Xt("acquisitionDate")],Ct.prototype,"readAcquisitionDate",null),b([Ie("acquisitionDate")],Ct.prototype,"writeAcquisitionDate",null),b([P({json:{name:"CloudCover",read:{reader:Je},write:!0}})],Ct.prototype,"cloudCover",void 0),b([P({json:{name:"ProductName",write:!0}})],Ct.prototype,"productName",void 0),b([P({json:{name:"SensorName",write:!0}})],Ct.prototype,"sensorName",void 0),b([P({json:{name:"SensorAzimuth",read:{reader:Je},write:!0}})],Ct.prototype,"sensorAzimuth",void 0),b([P({json:{name:"SensorElevation",read:{reader:Je},write:!0}})],Ct.prototype,"sensorElevation",void 0),b([P({json:{name:"SunAzimuth",read:{reader:Je},write:!0}})],Ct.prototype,"sunAzimuth",void 0),b([P({json:{name:"SunElevation",read:{reader:Je},write:!0}})],Ct.prototype,"sunElevation",void 0),Ct=Mr=b([_("esri.layers.support.RasterSensorInfo")],Ct);const ti=Ct;var Er;let mt=Er=class extends Lt{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new Er({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:Z(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:Z(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:Z(this.tileInfo),transposeInfo:Z(this.transposeInfo),blockBoundary:Z(this.blockBoundary)})}};b([P({type:Number,json:{write:!0}})],mt.prototype,"blockWidth",void 0),b([P({type:Number,json:{write:!0}})],mt.prototype,"blockHeight",void 0),b([P({type:String,json:{write:!0}})],mt.prototype,"compression",void 0),b([P({type:er,json:{write:!0}})],mt.prototype,"origin",void 0),b([P({type:Number,json:{write:!0}})],mt.prototype,"firstPyramidLevel",void 0),b([P({type:Number,json:{write:!0}})],mt.prototype,"maximumPyramidLevel",void 0),b([P({json:{write:!0}})],mt.prototype,"pyramidResolutions",void 0),b([P({type:Number,json:{write:!0}})],mt.prototype,"pyramidScalingFactor",void 0),b([P({type:Number,json:{write:!0}})],mt.prototype,"pyramidBlockWidth",void 0),b([P({type:Number,json:{write:!0}})],mt.prototype,"pyramidBlockHeight",void 0),b([P({type:Boolean,json:{write:!0}})],mt.prototype,"isVirtualTileInfo",void 0),b([P({json:{write:!0}})],mt.prototype,"tileInfo",void 0),b([P()],mt.prototype,"transposeInfo",void 0),b([P({json:{write:!0}})],mt.prototype,"blockBoundary",void 0),mt=Er=b([_("esri.layers.support.RasterStorageInfo")],mt);const ei=mt;var Or;let et=Or=class extends Lt{constructor(r){super(r),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){const r=this.keyProperties.BandProperties,{bandCount:t}=this;if(!(r!=null&&r.length)||r.length<t){const s=[];for(let n=1;n<=t;n++)s.push(new Hs({name:"band_"+n}));return s}const e=r.map(s=>Hs.fromJSON(s));for(let s=0;s<e.length;s++)e[s].name=e[s].name||"band_"+(s+1);return e}get dataType(){var t,e;const r=((e=(t=this.keyProperties)==null?void 0:t.DataType)==null?void 0:e.toLowerCase())??"generic";return r==="stdtime"?"standard-time":r}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(r){r&&this._set("nativeExtent",r)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;const r=this.nativeExtent;return{x:r.width/this.width,y:r.height/this.height}}get hasMultidimensionalTranspose(){var r;return!!((r=this.storageInfo)!=null&&r.transposeInfo)}get sensorInfo(){var r;if((r=this.keyProperties)!=null&&r.SensorName)return ti.fromJSON(this.keyProperties)}clone(){return new Or({attributeTable:Z(this.attributeTable),bandCount:this.bandCount,colormap:Z(this.colormap),extent:Z(this.extent),format:this.format,height:this.height,width:this.width,histograms:Z(this.histograms),keyProperties:Z(this.keyProperties),multidimensionalInfo:Z(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:Z(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:Z(this.spatialReference),statistics:Z(this.statistics),storageInfo:Z(this.storageInfo),transform:Z(this.transform)})}};b([P({json:{write:!0}})],et.prototype,"attributeTable",void 0),b([P({json:{write:!0}})],et.prototype,"bandCount",void 0),b([P({readOnly:!0})],et.prototype,"bandInfos",null),b([P({json:{write:!0}})],et.prototype,"colormap",void 0),b([P({type:String,readOnly:!0})],et.prototype,"dataType",null),b([P({type:_t,json:{write:!0}})],et.prototype,"extent",void 0),b([P({type:_t,json:{write:!0}})],et.prototype,"nativeExtent",null),b([P({json:{write:!0}})],et.prototype,"nativePixelSize",null),b([P({json:{write:!0}})],et.prototype,"format",void 0),b([P({json:{write:!0}})],et.prototype,"height",void 0),b([P({json:{write:!0}})],et.prototype,"width",void 0),b([P({json:{write:!0}})],et.prototype,"hasMultidimensionalTranspose",null),b([P({json:{write:!0}})],et.prototype,"histograms",void 0),b([P({json:{write:!0}})],et.prototype,"keyProperties",void 0),b([P({json:{write:!0}})],et.prototype,"multidimensionalInfo",void 0),b([P({json:{write:!0}})],et.prototype,"noDataValue",void 0),b([P({json:{write:!0}})],et.prototype,"pixelSize",void 0),b([P({type:Vo.apiValues,json:{write:!0}})],et.prototype,"pixelType",void 0),b([P()],et.prototype,"isPseudoSpatialReference",void 0),b([P({readOnly:!0})],et.prototype,"sensorInfo",null),b([P({type:mo,json:{write:!0}})],et.prototype,"spatialReference",void 0),b([P({json:{write:!0}})],et.prototype,"statistics",void 0),b([P({type:ei,json:{write:!0}})],et.prototype,"storageInfo",void 0),b([P({json:{write:!0}})],et.prototype,"transform",void 0),et=Or=b([_("esri.layers.support.RasterInfo")],et);const _n=et;var Js,qs={exports:{}};function ri(){return Js||(Js=1,t=qs,r=function(){function s(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return s.prototype={ensureBuffer:function(n){var i=this.buffer,a=i?i.byteLength:0;if(n<a)return i;for(var o=512;o<n;)o<<=1;for(var l=new Uint8Array(o),u=0;u<a;++u)l[u]=i[u];return this.buffer=l},getByte:function(){for(var n=this.pos;this.bufferLength<=n;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(n){var i=this.pos;if(n){this.ensureBuffer(i+n);for(var a=i+n;!this.eof&&this.bufferLength<a;)this.readBlock();var o=this.bufferLength;a>o&&(a=o)}else{for(;!this.eof;)this.readBlock();a=this.bufferLength}return this.pos=a,this.buffer.subarray(i,a)},lookChar:function(){for(var n=this.pos;this.bufferLength<=n;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var n=this.pos;this.bufferLength<=n;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(n,i,a){for(var o=n+i;this.bufferLength<=o&&!this.eof;)this.readBlock();return new Stream(this.buffer,n,i,a)},skip:function(n){n||(n=1),this.pos+=n},reset:function(){this.pos=0}},s}(),(e=function(){if(!self||!self.Uint32Array)return null;var s=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),i=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),a=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],o=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function l(p){throw new Error(p)}function u(p){var c=0,h=p[c++],f=p[c++];h!=-1&&f!=-1||l("Invalid header in flate stream"),(15&h)!=8&&l("Unknown compression method in flate stream"),((h<<8)+f)%31!=0&&l("Bad FCHECK in flate stream"),32&f&&l("FDICT bit set in flate stream"),this.bytes=p,this.bytesPos=c,this.codeSize=0,this.codeBuf=0,r.call(this)}return u.prototype=Object.create(r.prototype),u.prototype.getBits=function(p){for(var c,h=this.codeSize,f=this.codeBuf,m=this.bytes,y=this.bytesPos;h<p;)(c=m[y++])===void 0&&l("Bad encoding in flate stream"),f|=c<<h,h+=8;return c=f&(1<<p)-1,this.codeBuf=f>>p,this.codeSize=h-=p,this.bytesPos=y,c},u.prototype.getCode=function(p){for(var c=p[0],h=p[1],f=this.codeSize,m=this.codeBuf,y=this.bytes,d=this.bytesPos;f<h;){var v;(v=y[d++])===void 0&&l("Bad encoding in flate stream"),m|=v<<f,f+=8}var w=c[m&(1<<h)-1],T=w>>16,g=65535&w;return(f==0||f<T||T==0)&&l("Bad encoding in flate stream"),this.codeBuf=m>>T,this.codeSize=f-T,this.bytesPos=d,g},u.prototype.generateHuffmanTable=function(p){for(var c=p.length,h=0,f=0;f<c;++f)p[f]>h&&(h=p[f]);for(var m=1<<h,y=new Uint32Array(m),d=1,v=0,w=2;d<=h;++d,v<<=1,w<<=1)for(var T=0;T<c;++T)if(p[T]==d){var g=0,x=v;for(f=0;f<d;++f)g=g<<1|1&x,x>>=1;for(f=g;f<m;f+=w)y[f]=d<<16|T;++v}return[y,h]},u.prototype.readBlock=function(){function p(V,tt,W,j,J){for(var ct=V.getBits(W)+j;ct-- >0;)tt[w++]=J}var c=this.getBits(3);if(1&c&&(this.eof=!0),(c>>=1)!=0){var h,f;if(c==1)h=a,f=o;else if(c==2){for(var m=this.getBits(5)+257,y=this.getBits(5)+1,d=this.getBits(4)+4,v=Array(s.length),w=0;w<d;)v[s[w++]]=this.getBits(3);for(var T=this.generateHuffmanTable(v),g=0,x=(w=0,m+y),C=new Array(x);w<x;){var k=this.getCode(T);k==16?p(this,C,2,3,g):k==17?p(this,C,3,3,g=0):k==18?p(this,C,7,11,g=0):C[w++]=g=k}h=this.generateHuffmanTable(C.slice(0,m)),f=this.generateHuffmanTable(C.slice(m,x))}else l("Unknown block type in flate stream");for(var A=(O=this.buffer)?O.length:0,S=this.bufferLength;;){var I=this.getCode(h);if(I<256)S+1>=A&&(A=(O=this.ensureBuffer(S+1)).length),O[S++]=I;else{if(I==256)return void(this.bufferLength=S);var R=(I=n[I-=257])>>16;R>0&&(R=this.getBits(R)),g=(65535&I)+R,I=this.getCode(f),(R=(I=i[I])>>16)>0&&(R=this.getBits(R));var N=(65535&I)+R;S+g>=A&&(A=(O=this.ensureBuffer(S+g)).length);for(var F=0;F<g;++F,++S)O[S]=O[S-N]}}}else{var E,M=this.bytes,B=this.bytesPos;(E=M[B++])===void 0&&l("Bad block header in flate stream");var L=E;(E=M[B++])===void 0&&l("Bad block header in flate stream"),L|=E<<8,(E=M[B++])===void 0&&l("Bad block header in flate stream");var G=E;(E=M[B++])===void 0&&l("Bad block header in flate stream"),(G|=E<<8)!=(65535&~L)&&l("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var q=this.bufferLength,O=this.ensureBuffer(q+L),z=q+L;this.bufferLength=z;for(var U=q;U<z;++U){if((E=M[B++])===void 0){this.eof=!0;break}O[U]=E}this.bytesPos=B}},u}())!==void 0&&(t.exports=e)),qs.exports;var r,t,e}const nr=Mn(ri());let si=class Ln{constructor(t){this._canvas=null,this._ctx=null,t&&(this._canvas=t.canvas,this._ctx=t.ctx||t.canvas&&t.canvas.getContext("2d"))}decode(t,e,s){if(!t||t.byteLength<10)throw new xt("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:n=0,height:i=0,format:a}=e;const{applyJpegMask:o}=e;if(o&&(!n||!i))throw new xt("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((l,u)=>{let p=null;a==="jpg"&&o&&(p=Ln._getMask(t,{width:n,height:i}));const c=new Blob([new Uint8Array(t)],{type:"image/"+a=="jpg"?"jpeg":a}),h=URL.createObjectURL(c),f=new Image;let m;f.src=h,f.onload=()=>{if(URL.revokeObjectURL(h),go(s))return void u(yo());n=f.width,i=f.height,this._canvas&&this._ctx?(this._canvas.width===n&&this._canvas.height===i||(this._canvas.width=n,this._canvas.height=i),this._ctx.clearRect(0,0,n,i)):(this._canvas=document.createElement("canvas"),this._canvas.width=n,this._canvas.height=i,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(f,0,0);const y=this._ctx.getImageData(0,0,n,i);let d;if(m=y.data,e.renderOnCanvas){if(p)for(d=0;d<p.length;d++)p[d]?m[4*d+3]=255:m[4*d+3]=0;return this._ctx.putImageData(y,0,0),void l(null)}const v=n*i,w=new Uint8Array(v),T=new Uint8Array(v),g=new Uint8Array(v);if(p)for(d=0;d<v;d++)w[d]=m[4*d],T[d]=m[4*d+1],g[d]=m[4*d+2];else for(p=new Uint8Array(v),d=0;d<v;d++)w[d]=m[4*d],T[d]=m[4*d+1],g[d]=m[4*d+2],p[d]=m[4*d+3];l({width:n,height:i,pixels:[w,T,g],mask:p,pixelType:"u8"})},f.onerror=()=>{URL.revokeObjectURL(h),u("cannot load image")}})}static _getMask(t,e){let s=null;try{const n=new Uint8Array(t),i=Math.ceil(n.length/2);let a=0;const o=n.length-2;for(a=i;a<o&&(n[a]!==255||n[a+1]!==217);a++);if(a+=2,a<n.length-1){const l=new nr(n.subarray(a)).getBytes();s=new Uint8Array(e.width*e.height);let u=0;for(let p=0;p<l.length;p++)for(let c=7;c>=0;c--)s[u++]=l[p]>>c&1}}catch{}return s}};var Ks,Ys={exports:{}};function ni(){return Ks||(Ks=1,r=Ys,t=function(){var s=function(){function n(i){this.message="JPEG error: "+i}return n.prototype=new Error,n.prototype.name="JpegError",n.constructor=n,n}();return function(){if(!self||!self.Uint8ClampedArray)return null;var n=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,a=799,o=3406,l=2276,u=1567,p=3784,c=5793,h=2896;function f(){this.decodeTransform=null,this.colorTransform=-1}function m(g,x){for(var C,k,A=0,S=[],I=16;I>0&&!g[I-1];)I--;S.push({children:[],index:0});var R,N=S[0];for(C=0;C<I;C++){for(k=0;k<g[C];k++){for((N=S.pop()).children[N.index]=x[A];N.index>0;)N=S.pop();for(N.index++,S.push(N);S.length<=C;)S.push(R={children:[],index:0}),N.children[N.index]=R.children,N=R;A++}C+1<I&&(S.push(R={children:[],index:0}),N.children[N.index]=R.children,N=R)}return S[0].children}function y(g,x,C){return 64*((g.blocksPerLine+1)*x+C)}function d(g,x,C,k,A,S,I,R,N){var F=C.mcusPerLine,E=C.progressive,M=x,B=0,L=0;function G(){if(L>0)return L--,B>>L&1;if((B=g[x++])===255){var D=g[x++];if(D)throw new s("unexpected marker "+(B<<8|D).toString(16))}return L=7,B>>>7}function q(D){for(var K=D;;){if(typeof(K=K[G()])=="number")return K;if(typeof K!="object")throw new s("invalid huffman sequence")}}function O(D){for(var K=0;D>0;)K=K<<1|G(),D--;return K}function z(D){if(D===1)return G()===1?1:-1;var K=O(D);return K>=1<<D-1?K:K+(-1<<D)+1}function U(D,K){var Q=q(D.huffmanTableDC),ht=Q===0?0:z(Q);D.blockData[K]=D.pred+=ht;for(var wt=1;wt<64;){var It=q(D.huffmanTableAC),ft=15&It,bt=It>>4;if(ft!==0){var fo=n[wt+=bt];D.blockData[K+fo]=z(ft),wt++}else{if(bt<15)break;wt+=16}}}function V(D,K){var Q=q(D.huffmanTableDC),ht=Q===0?0:z(Q)<<N;D.blockData[K]=D.pred+=ht}function tt(D,K){D.blockData[K]|=G()<<N}var W=0;function j(D,K){if(W>0)W--;else for(var Q=S,ht=I;Q<=ht;){var wt=q(D.huffmanTableAC),It=15&wt,ft=wt>>4;if(It!==0){var bt=n[Q+=ft];D.blockData[K+bt]=z(It)*(1<<N),Q++}else{if(ft<15){W=O(ft)+(1<<ft)-1;break}Q+=16}}}var J,ct=0;function te(D,K){for(var Q,ht,wt=S,It=I,ft=0;wt<=It;){var bt=n[wt];switch(ct){case 0:if(ft=(ht=q(D.huffmanTableAC))>>4,(Q=15&ht)==0)ft<15?(W=O(ft)+(1<<ft),ct=4):(ft=16,ct=1);else{if(Q!==1)throw new s("invalid ACn encoding");J=z(Q),ct=ft?2:3}continue;case 1:case 2:D.blockData[K+bt]?D.blockData[K+bt]+=G()<<N:--ft==0&&(ct=ct===2?3:0);break;case 3:D.blockData[K+bt]?D.blockData[K+bt]+=G()<<N:(D.blockData[K+bt]=J<<N,ct=0);break;case 4:D.blockData[K+bt]&&(D.blockData[K+bt]+=G()<<N)}wt++}ct===4&&--W==0&&(ct=0)}function We(D,K,Q,ht,wt){var It=Q%F;K(D,y(D,(Q/F|0)*D.v+ht,It*D.h+wt))}function Sr(D,K,Q){K(D,y(D,Q/D.blocksPerLine|0,Q%D.blocksPerLine))}var Ut,Pt,Et,ee,rt,He,re=k.length;He=E?S===0?R===0?V:tt:R===0?j:te:U;var Tt,se,or,ir,Ot=0;for(se=re===1?k[0].blocksPerLine*k[0].blocksPerColumn:F*C.mcusPerColumn;Ot<se;){var ar=A?Math.min(se-Ot,A):se;for(Pt=0;Pt<re;Pt++)k[Pt].pred=0;if(W=0,re===1)for(Ut=k[0],rt=0;rt<ar;rt++)Sr(Ut,He,Ot),Ot++;else for(rt=0;rt<ar;rt++){for(Pt=0;Pt<re;Pt++)for(or=(Ut=k[Pt]).h,ir=Ut.v,Et=0;Et<ir;Et++)for(ee=0;ee<or;ee++)We(Ut,He,Ot,Et,ee);Ot++}L=0,(Tt=T(g,x))&&Tt.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+Tt.invalid),x=Tt.offset);var ne=Tt&&Tt.marker;if(!ne||ne<=65280)throw new s("marker was not found");if(!(ne>=65488&&ne<=65495))break;x+=2}return(Tt=T(g,x))&&Tt.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+Tt.invalid),x=Tt.offset),x-M}function v(g,x,C){var k,A,S,I,R,N,F,E,M,B,L,G,q,O,z,U,V,tt=g.quantizationTable,W=g.blockData;if(!tt)throw new s("missing required Quantization Table.");for(var j=0;j<64;j+=8)M=W[x+j],B=W[x+j+1],L=W[x+j+2],G=W[x+j+3],q=W[x+j+4],O=W[x+j+5],z=W[x+j+6],U=W[x+j+7],M*=tt[j],B|L|G|q|O|z|U?(B*=tt[j+1],L*=tt[j+2],G*=tt[j+3],q*=tt[j+4],O*=tt[j+5],z*=tt[j+6],U*=tt[j+7],A=(k=(k=c*M+128>>8)+(A=c*q+128>>8)+1>>1)-A,V=(S=L)*p+(I=z)*u+128>>8,S=S*u-I*p+128>>8,F=(R=(R=h*(B-U)+128>>8)+(F=O<<4)+1>>1)-F,N=(E=(E=h*(B+U)+128>>8)+(N=G<<4)+1>>1)-N,I=(k=k+(I=V)+1>>1)-I,S=(A=A+S+1>>1)-S,V=R*l+E*o+2048>>12,R=R*o-E*l+2048>>12,E=V,V=N*a+F*i+2048>>12,N=N*i-F*a+2048>>12,F=V,C[j]=k+E,C[j+7]=k-E,C[j+1]=A+F,C[j+6]=A-F,C[j+2]=S+N,C[j+5]=S-N,C[j+3]=I+R,C[j+4]=I-R):(V=c*M+512>>10,C[j]=V,C[j+1]=V,C[j+2]=V,C[j+3]=V,C[j+4]=V,C[j+5]=V,C[j+6]=V,C[j+7]=V);for(var J=0;J<8;++J)M=C[J],(B=C[J+8])|(L=C[J+16])|(G=C[J+24])|(q=C[J+32])|(O=C[J+40])|(z=C[J+48])|(U=C[J+56])?(A=(k=4112+((k=c*M+2048>>12)+(A=c*q+2048>>12)+1>>1))-A,V=(S=L)*p+(I=z)*u+2048>>12,S=S*u-I*p+2048>>12,I=V,F=(R=(R=h*(B-U)+2048>>12)+(F=O)+1>>1)-F,N=(E=(E=h*(B+U)+2048>>12)+(N=G)+1>>1)-N,V=R*l+E*o+2048>>12,R=R*o-E*l+2048>>12,E=V,V=N*a+F*i+2048>>12,N=N*i-F*a+2048>>12,M=(M=(k=k+I+1>>1)+E)<16?0:M>=4080?255:M>>4,B=(B=(A=A+S+1>>1)+(F=V))<16?0:B>=4080?255:B>>4,L=(L=(S=A-S)+N)<16?0:L>=4080?255:L>>4,G=(G=(I=k-I)+R)<16?0:G>=4080?255:G>>4,q=(q=I-R)<16?0:q>=4080?255:q>>4,O=(O=S-N)<16?0:O>=4080?255:O>>4,z=(z=A-F)<16?0:z>=4080?255:z>>4,U=(U=k-E)<16?0:U>=4080?255:U>>4,W[x+J]=M,W[x+J+8]=B,W[x+J+16]=L,W[x+J+24]=G,W[x+J+32]=q,W[x+J+40]=O,W[x+J+48]=z,W[x+J+56]=U):(V=(V=c*M+8192>>14)<-2040?0:V>=2024?255:V+2056>>4,W[x+J]=V,W[x+J+8]=V,W[x+J+16]=V,W[x+J+24]=V,W[x+J+32]=V,W[x+J+40]=V,W[x+J+48]=V,W[x+J+56]=V)}function w(g,x){for(var C=x.blocksPerLine,k=x.blocksPerColumn,A=new Int16Array(64),S=0;S<k;S++)for(var I=0;I<C;I++)v(x,y(x,S,I),A);return x.blockData}function T(g,x,C){function k(N){return g[N]<<8|g[N+1]}var A=g.length-1,S=C<x?C:x;if(x>=A)return null;var I=k(x);if(I>=65472&&I<=65534)return{invalid:null,marker:I,offset:x};for(var R=k(S);!(R>=65472&&R<=65534);){if(++S>=A)return null;R=k(S)}return{invalid:I.toString(16),marker:R,offset:S}}return f.prototype={parse:function(g){function x(){var D=g[I]<<8|g[I+1];return I+=2,D}function C(){var D=x(),K=I+D-2,Q=T(g,K,I);Q&&Q.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+Q.invalid),K=Q.offset);var ht=g.subarray(I,K);return I+=ht.length,ht}function k(D){for(var K=Math.ceil(D.samplesPerLine/8/D.maxH),Q=Math.ceil(D.scanLines/8/D.maxV),ht=0;ht<D.components.length;ht++){rt=D.components[ht];var wt=Math.ceil(Math.ceil(D.samplesPerLine/8)*rt.h/D.maxH),It=Math.ceil(Math.ceil(D.scanLines/8)*rt.v/D.maxV),ft=K*rt.h,bt=Q*rt.v*64*(ft+1);rt.blockData=new Int16Array(bt),rt.blocksPerLine=wt,rt.blocksPerColumn=It}D.mcusPerLine=K,D.mcusPerColumn=Q}var A,S,I=0,R=null,N=null,F=[],E=[],M=[],B=x();if(B!==65496)throw new s("SOI not found");for(B=x();B!==65497;){var L,G,q;switch(B){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var O=C();B===65504&&O[0]===74&&O[1]===70&&O[2]===73&&O[3]===70&&O[4]===0&&(R={version:{major:O[5],minor:O[6]},densityUnits:O[7],xDensity:O[8]<<8|O[9],yDensity:O[10]<<8|O[11],thumbWidth:O[12],thumbHeight:O[13],thumbData:O.subarray(14,14+3*O[12]*O[13])}),B===65518&&O[0]===65&&O[1]===100&&O[2]===111&&O[3]===98&&O[4]===101&&(N={version:O[5]<<8|O[6],flags0:O[7]<<8|O[8],flags1:O[9]<<8|O[10],transformCode:O[11]});break;case 65499:for(var z=x()+I-2;I<z;){var U=g[I++],V=new Uint16Array(64);if(U>>4){if(U>>4!=1)throw new s("DQT - invalid table spec");for(G=0;G<64;G++)V[n[G]]=x()}else for(G=0;G<64;G++)V[n[G]]=g[I++];F[15&U]=V}break;case 65472:case 65473:case 65474:if(A)throw new s("Only single frame JPEGs supported");x(),(A={}).extended=B===65473,A.progressive=B===65474,A.precision=g[I++],A.scanLines=x(),A.samplesPerLine=x(),A.components=[],A.componentIds={};var tt,W=g[I++],j=0,J=0;for(L=0;L<W;L++){tt=g[I];var ct=g[I+1]>>4,te=15&g[I+1];j<ct&&(j=ct),J<te&&(J=te);var We=g[I+2];q=A.components.push({h:ct,v:te,quantizationId:We,quantizationTable:null}),A.componentIds[tt]=q-1,I+=3}A.maxH=j,A.maxV=J,k(A);break;case 65476:var Sr=x();for(L=2;L<Sr;){var Ut=g[I++],Pt=new Uint8Array(16),Et=0;for(G=0;G<16;G++,I++)Et+=Pt[G]=g[I];var ee=new Uint8Array(Et);for(G=0;G<Et;G++,I++)ee[G]=g[I];L+=17+Et,(Ut>>4?E:M)[15&Ut]=m(Pt,ee)}break;case 65501:x(),S=x();break;case 65498:x();var rt,He=g[I++],re=[];for(L=0;L<He;L++){var Tt=A.componentIds[g[I++]];rt=A.components[Tt];var se=g[I++];rt.huffmanTableDC=M[se>>4],rt.huffmanTableAC=E[15&se],re.push(rt)}var or=g[I++],ir=g[I++],Ot=g[I++],ar=d(g,I,A,re,S,or,ir,Ot>>4,15&Ot);I+=ar;break;case 65535:g[I]!==255&&I--;break;default:if(g[I-3]===255&&g[I-2]>=192&&g[I-2]<=254){I-=3;break}throw new s("unknown marker "+B.toString(16))}B=x()}for(this.width=A.samplesPerLine,this.height=A.scanLines,this.jfif=R,this.eof=I,this.adobe=N,this.components=[],L=0;L<A.components.length;L++){var ne=F[(rt=A.components[L]).quantizationId];ne&&(rt.quantizationTable=ne),this.components.push({output:w(A,rt),scaleX:rt.h/A.maxH,scaleY:rt.v/A.maxV,blocksPerLine:rt.blocksPerLine,blocksPerColumn:rt.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(g,x){var C,k,A,S,I,R,N,F,E,M,B,L=this.width/g,G=this.height/x,q=0,O=this.components.length,z=g*x*O,U=new Uint8ClampedArray(z),V=new Uint32Array(g),tt=4294967288;for(N=0;N<O;N++){for(k=(C=this.components[N]).scaleX*L,A=C.scaleY*G,q=N,B=C.output,S=C.blocksPerLine+1<<3,I=0;I<g;I++)F=0|I*k,V[I]=(F&tt)<<3|7&F;for(R=0;R<x;R++)for(M=S*((F=0|R*A)&tt)|(7&F)<<3,I=0;I<g;I++)U[q]=B[M+V[I]],q+=O}var W=this.decodeTransform;if(W)for(N=0;N<z;)for(F=0,E=0;F<O;F++,N++,E+=2)U[N]=(U[N]*W[E]>>8)+W[E+1];return U},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(g){for(var x,C,k,A=0,S=g.length;A<S;A+=3)x=g[A],C=g[A+1],k=g[A+2],g[A]=x-179.456+1.402*k,g[A+1]=x+135.459-.344*C-.714*k,g[A+2]=x-226.816+1.772*C;return g},_convertYcckToRgb:function(g){for(var x,C,k,A,S=0,I=0,R=g.length;I<R;I+=4)x=g[I],C=g[I+1],k=g[I+2],A=g[I+3],g[S++]=C*(-660635669420364e-19*C+.000437130475926232*k-54080610064599e-18*x+.00048449797120281*A-.154362151871126)-122.67195406894+k*(-.000957964378445773*k+.000817076911346625*x-.00477271405408747*A+1.53380253221734)+x*(.000961250184130688*x-.00266257332283933*A+.48357088451265)+A*(-.000336197177618394*A+.484791561490776),g[S++]=107.268039397724+C*(219927104525741e-19*C-.000640992018297945*k+.000659397001245577*x+.000426105652938837*A-.176491792462875)+k*(-.000778269941513683*k+.00130872261408275*x+.000770482631801132*A-.151051492775562)+x*(.00126935368114843*x-.00265090189010898*A+.25802910206845)+A*(-.000318913117588328*A-.213742400323665),g[S++]=C*(-.000570115196973677*C-263409051004589e-19*k+.0020741088115012*x-.00288260236853442*A+.814272968359295)-20.810012546947+k*(-153496057440975e-19*k-.000132689043961446*x+.000560833691242812*A-.195152027534049)+x*(.00174418132927582*x-.00255243321439347*A+.116935020465145)+A*(-.000343531996510555*A+.24165260232407);return g},_convertYcckToCmyk:function(g){for(var x,C,k,A=0,S=g.length;A<S;A+=4)x=g[A],C=g[A+1],k=g[A+2],g[A]=434.456-x-1.402*k,g[A+1]=119.541-x+.344*C+.714*k,g[A+2]=481.816-x-1.772*C;return g},_convertCmykToRgb:function(g){for(var x,C,k,A,S=0,I=1/255,R=0,N=g.length;R<N;R+=4)x=g[R]*I,C=g[R+1]*I,k=g[R+2]*I,A=g[R+3]*I,g[S++]=255+x*(-4.387332384609988*x+54.48615194189176*C+18.82290502165302*k+212.25662451639585*A-285.2331026137004)+C*(1.7149763477362134*C-5.6096736904047315*k-17.873870861415444*A-5.497006427196366)+k*(-2.5217340131683033*k-21.248923337353073*A+17.5119270841813)-A*(21.86122147463605*A+189.48180835922747),g[S++]=255+x*(8.841041422036149*x+60.118027045597366*C+6.871425592049007*k+31.159100130055922*A-79.2970844816548)+C*(-15.310361306967817*C+17.575251261109482*k+131.35250912493976*A-190.9453302588951)+k*(4.444339102852739*k+9.8632861493405*A-24.86741582555878)-A*(20.737325471181034*A+187.80453709719578),g[S++]=255+x*(.8842522430003296*x+8.078677503112928*C+30.89978309703729*k-.23883238689178934*A-14.183576799673286)+C*(10.49593273432072*C+63.02378494754052*k+50.606957656360734*A-112.23884253719248)+k*(.03296041114873217*k+115.60384449646641*A-193.58209356861505)-A*(22.33816807309886*A+180.12613974708367);return g},getData:function(g,x,C){if(this.numComponents>4)throw new s("Unsupported color mode");var k=this._getLinearizedBlockData(g,x);if(this.numComponents===1&&C){for(var A=k.length,S=new Uint8ClampedArray(3*A),I=0,R=0;R<A;R++){var N=k[R];S[I++]=N,S[I++]=N,S[I++]=N}return S}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(k);if(this.numComponents===4){if(this._isColorConversionNeeded())return C?this._convertYcckToRgb(k):this._convertYcckToCmyk(k);if(C)return this._convertCmykToRgb(k)}return k}},f}()},(e=t())!==void 0&&(r.exports=e)),Ys.exports;var r,t,e}const Un=Mn(ni());let oi=class{static decode(t,e=!1){const s=new Uint8Array(t),n=new Un;n.parse(s);const{width:i,height:a,numComponents:o,eof:l}=n,u=n.getData(i,a,!0),p=i*a;let c,h=null,f=0,m=0,y=0;if(!e&&l<s.length-1)try{const d=new nr(s.subarray(l)).getBytes();h=new Uint8Array(p);let v=0;for(f=0;f<d.length;f++)for(y=7;y>=0;y--)h[v++]=d[f]>>y&1}catch{}if(o===1&&u.length===i*a){const d=new Uint8Array(u.buffer);c=[d,d,d]}else{for(c=[],f=0;f<3;f++)c.push(new Uint8Array(p));for(y=0,m=0;m<p;m++)for(f=0;f<3;f++)c[f][m]=u[y++]}return{width:i,height:a,pixels:c,mask:h}}};const jn=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let Ir=null;function zn(){return Ir||(Ir=Pn(()=>import("./lerc-wasm-DAWotuvb.js"),__vite__mapDeps([0,1])).then(r=>r.l).then(({default:r})=>r({locateFile:t=>wo(`esri/layers/support/rasterFormats/${t}`)})).then(r=>{ai(r)}),Ir)}const yr={getBlobInfo:null,decode:null};function ii(r){return 16+(r>>3<<3)}function zt(r,t,e){e.set(r.slice(t,t+e.length))}function ai(r){const{_malloc:t,_free:e,_lerc_getBlobInfo:s,_lerc_getDataRanges:n,_lerc_decode_4D:i,asm:a}=r;let o;const l=Object.values(a).find(p=>p&&"buffer"in p&&p.buffer===r.HEAPU8.buffer),u=p=>{const c=p.map(y=>ii(y)),h=c.reduce((y,d)=>y+d),f=t(h);o=new Uint8Array(l.buffer);let m=c[0];c[0]=f;for(let y=1;y<c.length;y++){const d=c[y];c[y]=c[y-1]+m,m=d}return c};yr.getBlobInfo=p=>{const f=new Uint8Array(48),m=new Uint8Array(8*3),[y,d,v]=u([p.length,f.length,m.length]);o.set(p,y),o.set(f,d),o.set(m,v);let w=s(y,p.length,d,v,12,3);if(w)throw e(y),new Error(`lerc-getBlobInfo: error code is ${w}`);o=new Uint8Array(l.buffer),zt(o,d,f),zt(o,v,m);const T=new Uint32Array(f.buffer),g=new Float64Array(m.buffer),[x,C,,k,A,S,I,R,N,F,E]=T,M={version:x,depthCount:F,width:k,height:A,validPixelCount:I,bandCount:S,blobSize:R,maskCount:N,dataType:C,minValue:g[0],maxValue:g[1],maxZerror:g[2],statistics:[],bandCountWithNoData:E};if(E&&F>1)return e(y),M;if(F===1&&S===1)return e(y),M.statistics.push({minValue:g[0],maxValue:g[1]}),M;const B=F*S*8,L=new Uint8Array(B),G=new Uint8Array(B);let q=y,O=0,z=0,U=!1;if(o.byteLength<y+2*B?(e(y),U=!0,[q,O,z]=u([p.length,B,B]),o.set(p,q)):[O,z]=u([B,B]),o.set(L,O),o.set(G,z),w=n(q,p.length,F,S,O,z),w)throw e(q),U||e(O),new Error(`lerc-getDataRanges: error code is ${w}`);o=new Uint8Array(l.buffer),zt(o,O,L),zt(o,z,G);const V=new Float64Array(L.buffer),tt=new Float64Array(G.buffer),W=M.statistics;for(let j=0;j<S;j++)if(F>1){const J=V.slice(j*F,(j+1)*F),ct=tt.slice(j*F,(j+1)*F),te=Math.min.apply(null,J),We=Math.max.apply(null,ct);W.push({minValue:te,maxValue:We,depthStats:{minValues:J,maxValues:ct}})}else W.push({minValue:V[j],maxValue:tt[j]});return e(q),U||e(O),M},yr.decode=(p,c)=>{const{maskCount:h,depthCount:f,bandCount:m,width:y,height:d,dataType:v,bandCountWithNoData:w}=c,T=jn[v],g=y*d,x=new Uint8Array(g*m),C=g*f*m*T.size,k=new Uint8Array(C),A=new Uint8Array(m),S=new Uint8Array(8*m),[I,R,N,F,E]=u([p.length,x.length,k.length,A.length,S.length]);o.set(p,I),o.set(x,R),o.set(k,N),o.set(A,F),o.set(S,E);const M=i(I,p.length,h,R,f,y,d,m,v,N,F,E);if(M)throw e(I),new Error(`lerc-decode: error code is ${M}`);o=new Uint8Array(l.buffer),zt(o,N,k),zt(o,R,x);let B=null;if(w){zt(o,F,A),zt(o,E,S),B=[];const L=new Float64Array(S.buffer);for(let G=0;G<A.length;G++)B.push(A[G]?L[G]:null)}return e(I),{data:k,maskData:x,noDataValues:B}}}function li(r,t,e,s,n){if(e<2)return r;const i=new s(t*e);for(let a=0,o=0;a<t;a++)for(let l=0,u=a;l<e;l++,u+=t)i[u]=r[o++];return i}function Vn(r,t={}){const e=t.inputOffset??0,s=r instanceof Uint8Array?r.subarray(e):new Uint8Array(r,e),n=yr.getBlobInfo(s),{data:i,maskData:a,noDataValues:o}=yr.decode(s,n),{width:l,height:u,bandCount:p,depthCount:c,dataType:h,maskCount:f,statistics:m}=n,y=jn[h],d=new y.ctor(i.buffer),v=[],w=[],T=l*u,g=T*c;for(let I=0;I<p;I++){const R=d.subarray(I*g,(I+1)*g);if(t.returnInterleaved)v.push(R);else{const N=li(R,T,c,y.ctor);v.push(N)}w.push(a.subarray(I*g,(I+1)*g))}const x=f===0?null:f===1?w[0]:new Uint8Array(T);if(f>1){x.set(w[0]);for(let I=1;I<w.length;I++){const R=w[I];for(let N=0;N<T;N++)x[N]=x[N]&R[N]}}const{noDataValue:C}=t,k=C!=null&&y.range[0]<=C&&y.range[1]>=C;if(f>0&&k)for(let I=0;I<p;I++){const R=v[I],N=w[I]||x;for(let F=0;F<T;F++)N[F]===0&&(R[F]=C)}const A=f===p&&p>1?w:null,{pixelType:S}=y;return{width:l,height:u,bandCount:p,pixelType:S,depthCount:c,statistics:m,pixels:v,mask:x,bandMasks:A,noDataValues:o}}function ui(r,t,e,s=!0){if(t%4!=0||e%4!=0){const n=new ArrayBuffer(4*Math.ceil(e/4)),i=new Uint8Array(n),a=new Uint8Array(r,t,e);if(s)for(let o=0;o<i.length;o+=4)i[o]=a[o+3],i[o+1]=a[o+2],i[o+2]=a[o+1],i[o+3]=a[o];else i.set(a);return new Uint32Array(i.buffer)}if(s){const n=new Uint8Array(r,t,e),i=new Uint8Array(n.length);for(let a=0;a<i.length;a+=4)i[a]=n[a+3],i[a+1]=n[a+2],i[a+2]=n[a+1],i[a+3]=n[a];return new Uint32Array(i.buffer)}return new Uint32Array(r,t,e/4)}function Xs(){const r=[];for(let t=0;t<=257;t++)r[t]=[t];return r}function Zs(r,t){for(let e=0;e<t.length;e++)r.push(t[e])}const Re=new Set;function Ts(r,t,e,s=!0){const n=ui(r,t,e,s);let i=9,a=Xs(),o=32,l=a.length,u=[],p=1,c=n[0],h=0;const f=n.length,m=8*(4*f-e),y=[];for(;c!=null;){if(o>=i)o-=i,h=c>>>32-i,c<<=i;else{h=c>>>32-o,c=n[p++];const v=i-o;o=32-v,h=(h<<v)+(c>>>o),c<<=v}if(h===257)break;if(h===256){i=9,a=Xs(),l=a.length,u=[];continue}const d=a[h];if(d==null){if(h>a.length)throw new Error("data integrity issue: code does not exist on code page");u.push(u[0]),a[l++]=u.slice(),Zs(y,u)}else Zs(y,d),u.push(d[0]),u.length>1&&(a[l++]=u.slice()),u=d.slice();if(Re.has(l)&&i++,o===0&&(c=n[p++],o=32),p>f||p===f&&o<=m)break}return new Uint8Array(y)}Re.add(511),Re.add(1023),Re.add(2047),Re.add(4095),Re.add(8191);const Qs=(r,t)=>{const e=t.width*t.height,s=t.pixelType;return Math.floor(r.byteLength/(e*Wn(s)))},Wn=r=>{let t=1;switch(r){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},ci=(r,t)=>{if(8*r.byteLength<t)return null;const e=new Uint8Array(r,0,Math.ceil(t/8)),s=new Uint8Array(t);let n=0,i=0,a=0,o=0;for(a=0;a<e.length-1;a++)for(i=e[a],o=7;o>=0;o--)s[n++]=i>>o&1;for(o=7;n<t-1;)i=e[e.length-1],s[n++]=i>>o&1,o--;return s};let pi=class{static decode(t,e){const s=e.pixelType,n=[],i=e.width*e.height,a=Qs(t,e),{bandIds:o,format:l}=e,u=(o==null?void 0:o.length)||Qs(t,e),p=t.byteLength-t.byteLength%(i*Wn(s)),c=new s(t,0,i*a);let h,f,m,y,d=null;if(l==="bip")for(h=0;h<u;h++){for(m=new s(i),y=o?o[h]:h,f=0;f<i;f++)m[f]=c[f*a+y];n.push(m)}else if(l==="bsq")for(h=0;h<u;h++)y=o?o[h]:h,n.push(c.subarray(y*i,(y+1)*i));return p<t.byteLength-1&&(d=ci(t.slice(p),i)),{pixels:n,mask:d}}};function hi(r,t){let e=0,s="",n=0,i=0;const a=r.length;for(;e<a;)i=r[e++],n=i>>4,n<8?n=1:n===15?(n=4,i=(7&i)<<18|(63&r[e++])<<12|(63&r[e++])<<6|63&r[e++]):n===14?(n=3,i=(15&i)<<12|(63&r[e++])<<6|63&r[e++]):(n=2,i=(31&i)<<6|63&r[e++]),(i!==0||t)&&(s+=String.fromCharCode(i));return s}const Ss=(()=>{const r=[];return r[254]="NEWSUBFILETYPE",r[255]="SUBFILETYPE",r[256]="IMAGEWIDTH",r[257]="IMAGELENGTH",r[258]="BITSPERSAMPLE",r[259]="COMPRESSION",r[262]="PHOTOMETRICINTERPRETATION",r[263]="THRESHHOLDING",r[264]="CELLWIDTH",r[265]="CELLLENGTH",r[266]="FILLORDER",r[269]="DOCUMENTNAME",r[270]="IMAGEDESCRIPTION",r[271]="MAKE",r[272]="MODEL",r[273]="STRIPOFFSETS",r[274]="ORIENTATION",r[277]="SAMPLESPERPIXEL",r[278]="ROWSPERSTRIP",r[279]="STRIPBYTECOUNTS",r[280]="MINSAMPLEVALUE",r[281]="MAXSAMPLEVALUE",r[282]="XRESOLUTION",r[283]="YRESOLUTION",r[284]="PLANARCONFIGURATION",r[285]="PAGENAME",r[286]="XPOSITION",r[287]="YPOSITION",r[288]="FREEOFFSETS",r[289]="FREEBYTECOUNTS",r[290]="GRAYRESPONSEUNIT",r[291]="GRAYRESPONSECURVE",r[292]="T4OPTIONS",r[293]="T6OPTIONS",r[296]="RESOLUTIONUNIT",r[297]="PAGENUMBER",r[300]="COLORRESPONSEUNIT",r[301]="TRANSFERFUNCTION",r[305]="SOFTWARE",r[306]="DATETIME",r[315]="ARTIST",r[316]="HOSTCOMPUTER",r[317]="PREDICTOR",r[318]="WHITEPOINT",r[319]="PRIMARYCHROMATICITIES",r[320]="COLORMAP",r[321]="HALFTONEHINTS",r[322]="TILEWIDTH",r[323]="TILELENGTH",r[324]="TILEOFFSETS",r[325]="TILEBYTECOUNTS",r[326]="BADFAXLINES",r[327]="CLEANFAXDATA",r[328]="CONSECUTIVEBADFAXLINES",r[330]="SUBIFD",r[332]="INKSET",r[333]="INKNAMES",r[334]="NUMBEROFINKS",r[336]="DOTRANGE",r[337]="TARGETPRINTER",r[338]="EXTRASAMPLES",r[339]="SAMPLEFORMAT",r[340]="SMINSAMPLEVALUE",r[341]="SMAXSAMPLEVALUE",r[342]="TRANSFERRANGE",r[347]="JPEGTABLES",r[512]="JPEGPROC",r[513]="JPEGIFOFFSET",r[514]="JPEGIFBYTECOUNT",r[515]="JPEGRESTARTINTERVAL",r[517]="JPEGLOSSLESSPREDICTORS",r[518]="JPEGPOINTTRANSFORM",r[519]="JPEGQTABLES",r[520]="JPEGDCTABLES",r[521]="JPEGACTABLES",r[529]="YCBCRCOEFFICIENTS",r[530]="YCBCRSUBSAMPLING",r[531]="YCBCRPOSITIONING",r[532]="REFERENCEBLACKWHITE",r[700]="XMP",r[33550]="GEOPIXELSCALE",r[33922]="GEOTIEPOINTS",r[33432]="COPYRIGHT",r[42112]="GDAL_METADATA",r[42113]="GDAL_NODATA",r[50844]="RPCCOEFFICIENT",r[34264]="GEOTRANSMATRIX",r[34735]="GEOKEYDIRECTORY",r[34736]="GEODOUBLEPARAMS",r[34737]="GEOASCIIPARAMS",r[34665]="EXIFIFD",r[34853]="GPSIFD",r[40965]="INTEROPERABILITYIFD",r})(),fi=(()=>{const r=Ss.slice();return r[36864]="ExifVersion",r[40960]="FlashpixVersion",r[40961]="ColorSpace",r[42240]="Gamma",r[37121]="ComponentsConfiguration",r[37122]="CompressedBitsPerPixel",r[40962]="PixelXDimension",r[40963]="PixelYDimension",r[37500]="MakerNote",r[37510]="UserComment",r[40964]="RelatedSoundFile",r[36867]="DateTimeOriginal",r[36868]="DateTimeDigitized",r[36880]="OffsetTime",r[36881]="OffsetTimeOriginal",r[36882]="OffsetTimeDigitized",r[37520]="SubSecTime",r[37521]="SubSecTimeOriginal",r[37522]="SubSecTimeDigitized",r[37888]="Temperature",r[37889]="Humidity",r[37890]="Pressure",r[37891]="WaterDepth",r[37892]="Acceleration",r[37893]="CameraElevationAngle",r[42016]="ImageUniqueID",r[42032]="CameraOwnerName",r[42033]="BodySerialNumber",r[42034]="LensSpecification",r[42035]="LensMake",r[42036]="LensModel",r[42037]="LensSerialNumber",r[33434]="ExposureTime",r[33437]="FNumber",r[34850]="ExposureProgram",r[34852]="SpectralSensitivity",r[34855]="PhotographicSensitivity",r[34856]="OECF",r[34864]="SensitivityType",r[34865]="StandardOutputSensitivity",r[34866]="RecommendedExposureIndex",r[34867]="ISOSpeed",r[34868]="ISOSpeedLatitudeyyy",r[34869]="ISOSpeedLatitudezzz",r[37377]="ShutterSpeedValue",r[37378]="ApertureValue",r[37379]="BrightnessValue",r[37380]="ExposureBiasValue",r[37381]="MaxApertureValue",r[37382]="SubjectDistance",r[37383]="MeteringMode",r[37384]="LightSource",r[37385]="Flash",r[37386]="FocalLength",r[37396]="SubjectArea",r[41483]="FlashEnergy",r[41484]="SpatialFrequencyResponse",r[41486]="FocalPlaneXResolution",r[41487]="FocalPlaneYResolution",r[41488]="FocalPlaneResolutionUnit",r[41492]="SubjectLocation",r[41493]="ExposureIndex",r[41495]="SensingMethod",r[41728]="FileSource",r[41729]="SceneType",r[41730]="CFAPattern",r[41985]="CustomRendered",r[41986]="ExposureMode",r[41987]="WhiteBalance",r[41988]="DigitalZoomRatio",r[41989]="FocalLengthIn35mmFilm",r[41990]="SceneCaptureType",r[41991]="GainControl",r[41992]="Contrast",r[41993]="Saturation",r[41994]="Sharpness",r[41995]="DeviceSettingDescription",r[41996]="SubjectDistanceRange",r})(),mi=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],di=(()=>{const r=[];return r[1024]="GTModelTypeGeoKey",r[1025]="GTRasterTypeGeoKey",r[1026]="GTCitationGeoKey",r[2048]="GeographicTypeGeoKey",r[2049]="GeogCitationGeoKey",r[2050]="GeogGeodeticDatumGeoKey",r[2051]="GeogPrimeMeridianGeoKey",r[2052]="GeogLinearUnitsGeoKey",r[2053]="GeogLinearUnitSizeGeoKey",r[2054]="GeogAngularUnitsGeoKey",r[2055]="GeogAngularUnitSizeGeoKey",r[2056]="GeogEllipsoidGeoKey",r[2057]="GeogSemiMajorAxisGeoKey",r[2058]="GeogSemiMinorAxisGeoKey",r[2059]="GeogInvFlatteningGeoKey",r[2061]="GeogPrimeMeridianLongGeoKey",r[2060]="GeogAzimuthUnitsGeoKey",r[3072]="ProjectedCSTypeGeoKey",r[3073]="PCSCitationGeoKey",r[3074]="ProjectionGeoKey",r[3075]="ProjCoordTransGeoKey",r[3076]="ProjLinearUnitsGeoKey",r[3077]="ProjLinearUnitSizeGeoKey",r[3078]="ProjStdParallel1GeoKey",r[3079]="ProjStdParallel2GeoKey",r[3080]="ProjNatOriginLongGeoKey",r[3081]="ProjNatOriginLatGeoKey",r[3082]="ProjFalseEastingGeoKey",r[3083]="ProjFalseNorthingGeoKey",r[3084]="ProjFalseOriginLongGeoKey",r[3085]="ProjFalseOriginLatGeoKey",r[3086]="ProjFalseOriginEastingGeoKey",r[3087]="ProjFalseOriginNorthingGeoKey",r[3088]="ProjCenterLongGeoKey",r[3090]="ProjCenterEastingGeoKey",r[3091]="ProjCenterNorthingGeoKey",r[3092]="ProjScaleAtNatOriginGeoKey",r[3093]="ProjScaleAtCenterGeoKey",r[3094]="ProjAzimuthAngleGeoKey",r[3095]="ProjStraightVertPoleLongGeoKey",r[4096]="VerticalCSTypeGeoKey",r[4097]="VerticalCitationGeoKey",r[4098]="VerticalDatumGeoKey",r[4099]="VerticalUnitsGeoKey",r})(),gi=(r,t)=>{let e=(t||Ss)[r];return e===void 0&&(e="unknown"+String(r)),e},Br=new Map;Br.set("EXIFIFD",fi),Br.set("GPSIFD",mi);const ze={tiffTags:Ss,ifdTags:Br,geoKeys:di,getTagName:gi},ks=(()=>{const r=new ArrayBuffer(4),t=new Uint8Array(r);return new Uint32Array(r)[0]=1,t[0]===1})(),tn=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Ve=4294967296,yi=new Set([1,5,6,7,8,34712,34887]);function Ps(r,t){let e="unknown";return r===3?e=t===64?"f64":"f32":r===1?t===1?e="u1":t===2?e="u2":t===4?e="u4":t<=8?e="u8":t<=16?e="u16":t<=32&&(e="u32"):r===2&&(t<=8?e="s8":t<=16?e="s16":t<=32&&(e="s32")),e}function vr(r){let t=null;switch(r?r.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f64":t=Float64Array;break;default:t=Float32Array}return t}function wi(r,t){return{x:t[0]*r.x+t[1]*r.y+t[2],y:t[3]*r.x+t[4]*r.y+t[5]}}function Hn(r,t){var e;return(e=r.get(t))==null?void 0:e.values}function Pe(r,t){var e;return(e=r.get(t))==null?void 0:e.values}function en(r,t){var e,s;return(s=(e=r.get(t))==null?void 0:e.values)==null?void 0:s[0]}function H(r,t){var e,s;return(s=(e=r.get(t))==null?void 0:e.values)==null?void 0:s[0]}function Rr(r,t,e,s=0,n=ze.tiffTags,i=4){const a=i===8,o=a?Rs(new DataView(r,e,8),0,t):new DataView(r,e,2).getUint16(0,t),l=4+2*i,u=a?8:2,p=u+o*l;if(e+p>r.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:p};const c=e+p+4<=r.byteLength?cr(new DataView(r,e+p,i===8?8:4),0,t,i===8):null,h=e+u,f=new Map;let m,y,d,v,w,T=0,g=0;for(let x=0;x<o;x++){y=new DataView(r,h+l*x,l),d=y.getUint16(0,t),w=y.getUint16(2,t),v=ze.getTagName(d,n);const C=[];i===2?(T=y.getUint16(4,t),g=y.getUint16(6,t)):i===4?(T=y.getUint32(4,t),g=y.getUint32(8,t)):i===8&&(T=cr(y,4,t,!0),g=cr(y,12,t,!0),C.push(y.getUint32(12,t)),C.push(y.getUint32(16,t))),m={id:d,type:w,valueCount:T,valueOffset:g,valueOffsets:C,values:null},Ti(r,t,m,s,!1,i),f.set(v,m)}return{success:!0,ifd:f,nextIFD:c,requiredBufferSize:p}}const bi=(r,t)=>Vn(r,{inputOffset:t}).pixels[0];function Dr(r,t){if(t!==1&&t!==2&&t!==4)return r;const e=new Uint8Array(r),s=8/t,n=new Uint8Array(r.byteLength*s);let i=0;const a=2**t-1;for(let o=0;o<e.length;o++){const l=e[o];for(let u=0;u<s;u++)n[i++]=l<<t*u>>>8-t&a}return n.buffer}function Gr(r,t,e){const s=new Un;s.parse(r),s.colorTransform=e===6?-1:0;const n=s.getData(s.width,s.height,t!==1&&t!==4);return new Uint8Array(n.buffer)}function _r(r){const t=new nr(r).getBytes(),e=new ArrayBuffer(t.length),s=new Uint8Array(e);return s.set(t),s}async function Lr(r,t,e,s,n){const i=ks===t,a=H(e,"BITSPERSAMPLE"),o=H(e,"SAMPLESPERPIXEL")??1,l=H(e,"PHOTOMETRICINTERPRETATION"),u=H(e,"SAMPLEFORMAT")??1,p=Ps(u,a),c=H(e,"COMPRESSION")??1,h=vr(p);let f,m,y;if(c===34887)return await zn(),bi(r,s);if(c===1)f=r.slice(s,s+n),m=new Uint8Array(f);else if(c===8||c===32946)m=new Uint8Array(r,s,n),m=_r(m),f=m.buffer;else if(c===6)m=new Uint8Array(r,s,n),m=Gr(m,o,l),f=m.buffer;else if(c===7){const T=e.get("JPEGTABLES").values,g=T.length-2;m=new Uint8Array(g+n-2);for(let C=0;C<g;C++)m[C]=T[C];const x=new Uint8Array(r,s+2,n-2);for(let C=0;C<x.length;C++)m[g+C]=x[C];m=Gr(m,o,l),f=m.buffer}else{if(c!==5)throw new Error("tiff-decode: unsupport compression "+c);m=Ts(r,s,n,t),f=m.buffer}if(f=Dr(f,a),p==="u8"||p==="s8"||i)y=new h(f);else{f=new ArrayBuffer(m.length);const T=new Uint8Array(f);switch(p){case"u16":case"s16":for(let g=0;g<m.length;g+=2)T[g]=m[g+1],T[g+1]=m[g];break;case"u32":case"s32":case"f32":for(let g=0;g<m.length;g+=4)T[g]=m[g+3],T[g+1]=m[g+2],T[g+2]=m[g+1],T[g+3]=m[g]}y=new h(f)}const d=H(e,"PREDICTOR")??1,v=H(e,"TILEWIDTH"),w=H(e,"TILELENGTH");if(d>1&&(c===5||c===8||c===32946)&&v&&w){const T=xr(e),g=new h(y.length);g.set(y),y=Ri(g,w,v,u===3&&d===3,T?1:o)}return y}async function vi(r,t,e){const s=Pe(e,"TILEOFFSETS");if(s===void 0)return null;const n=Pe(e,"TILEBYTECOUNTS"),{width:i,height:a,pixelType:o,tileWidth:l,tileHeight:u}=Is([e]),p=xr(e,t),c=H(e,"SAMPLESPERPIXEL")||t.planes,h=i*a,f=H(e,"BITSPERSAMPLE"),m=(H(e,"COMPRESSION")??1)===34887,y=vr(o),d=[];for(let L=0;L<c;L++)d.push(new y(h));let v,w,T,g,x,C,k,A,S,I,R,N,F;const E=Math.ceil(i/l),M=new Uint8Array(h).fill(255);let B=!1;if(f%8==0)if(m&&p&&c>1){const L=Math.round(s.length/c);for(v=0;v<L;v++){C=Math.floor(v/E)*u,k=v%E*l,A=C*i+k;for(let G=0;G<c;G++){const q=v*c+G;for(n[q]===0?(T=null,B=!0):T=await Lr(r,t.littleEndian,e,s[q],n[q]),I=0,S=A,N=Math.min(l,i-k),R=Math.min(u,a-C),F=d[G],g=0;g<R;g++)for(S=A+g*i,I=g*l,x=0;x<N;x++,S++,I++)T?F[S]=T[I]:M[S]=0}}}else for(v=0;v<s.length;v++)for(C=Math.floor(v/E)*u,k=v%E*l,A=C*i+k,n[v]===0?(T=null,B=!0):T=await Lr(r,t.littleEndian,e,s[v],n[v]),I=0,S=A,N=Math.min(l,i-k),R=Math.min(u,a-C),w=0;w<c;w++)if(F=d[w],p||m)for(g=0;g<R;g++)for(S=A+g*i,I=l*u*w+g*l,x=0;x<N;x++,S++,I++)T?F[S]=T[I]:M[S]=0;else for(g=0;g<R;g++)for(S=A+g*i,I=g*l*c+w,x=0;x<N;x++,S++,I+=c)T?F[S]=T[I]:M[S]=0;return{width:i,height:a,pixelType:o,pixels:d,mask:B?M:void 0}}const xi=(r,t,e)=>{const s=ks===t.littleEndian,n=Pe(e,"STRIPOFFSETS");if(n===void 0)return null;const{width:i,height:a,pixelType:o}=Is([e]),l=H(e,"SAMPLESPERPIXEL")||t.planes,u=H(e,"PHOTOMETRICINTERPRETATION"),p=i*a,c=H(e,"BITSPERSAMPLE"),h=vr(o),f=new h(p*l),m=Pe(e,"STRIPBYTECOUNTS"),y=H(e,"ROWSPERSTRIP"),d=H(e,"COMPRESSION")??1;let v,w,T,g,x,C,k,A,S;if(c%8==0)for(v=0;v<n.length;v++){if(x=v*(y*i)*l,o==="u8"||o==="s8"||s)d===8||d===32946?(k=new Uint8Array(r,n[v],m[v]),k=_r(k),C=k.buffer):d===6?(k=new Uint8Array(r,n[v],m[v]),k=Gr(k,l,u),C=k.buffer):d===5?(k=Ts(r,n[v],m[v],t.littleEndian),C=k.buffer):C=r.slice(n[v],n[v]+m[v]),C=Dr(C,c),g=new h(C);else{switch(d===6||d===8||d===32946?(k=new Uint8Array(r,n[v],m[v]),A=_r(k),C=A.buffer):(C=new ArrayBuffer(m[v]),k=new Uint8Array(r,n[v],m[v]),A=new Uint8Array(C)),o){case"u16":case"s16":for(T=0;T<k.length;T+=2)A[T]=k[T+1],A[T+1]=k[T];break;case"u32":case"s32":case"f32":for(T=0;T<k.length;T+=4)A[T]=k[T+3],A[T+1]=k[T+2],A[T+2]=k[T+1],A[T+3]=k[T]}C=Dr(C,c),g=new h(C)}f.set(g,x)}const I=[];if(l===1)I.push(f);else for(v=0;v<l;v++){for(S=new h(p),w=0;w<p;w++)S[w]=f[w*l+v];I.push(S)}return{width:i,height:a,pixelType:o,pixels:I}},Ci=(r,t,e)=>{if(!(r.length>0&&t&&e))return null;let s,n,i;const a=r[0].length,o=r.length,l=new Uint8Array(a);for(let u=0;u<o;u++)if(s=r[u],n=t[u],i=e[u],u===0)for(let p=0;p<a;p++)l[p]=s[p]<n||s[p]>i?0:1;else for(let p=0;p<a;p++)l[p]&&(l[p]=s[p]<n||s[p]>i?0:1);return l},Ai=r=>{if(!r)return null;const t=r.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;const e=new Map;let s,n,i,a,o;for(let v=0;v<t.length;v++)s=t[v],n=s.slice(6,s.indexOf(">")),a=s.indexOf("sample="),a>-1&&(o=s.slice(a+8,s.indexOf('"',a+8))),a=s.indexOf("name="),a>-1&&(n=s.slice(a+6,s.indexOf('"',a+6))),n&&(i=s.slice(s.indexOf(">")+1,s.indexOf("</Item>")).trim(),o!=null?e.has(n)?e.get(n)[o]=i:e.set(n,[i]):e.set(n,i)),o=null;const l=e.get("STATISTICS_MINIMUM"),u=e.get("STATISTICS_MAXIMUM"),p=e.get("STATISTICS_MEAN"),c=e.get("STATISTICS_STDDEV");let h=null;if(l&&u){h=[];for(let v=0;v<l.length;v++)h.push({min:parseFloat(l[v]),max:parseFloat(u[v]),avg:p&&parseFloat(p[v]),stddev:c&&parseFloat(c[v])})}const f=e.get("BandName"),m=e.get("WavelengthMin"),y=e.get("WavelengthMax");let d=null;if(f){d=[];for(let v=0;v<f.length;v++)d.push({BandName:f[v],WavelengthMin:m&&parseFloat(m[v]),WavelengthMax:y&&parseFloat(y[v])})}return{statistics:h,bandProperties:d,dataType:e.get("DataType"),rawMetadata:e}};function Ti(r,t,e,s=0,n=!1,i=4){if(e.values)return!0;const a=e.type,o=e.valueCount;let l=e.valueOffset,u=[];const p=tn[a],c=8*p,h=o*p,f=o*tn[a]*8;let m,y;const d=i===8?64:32,v=e.valueOffsets;if(f>d&&h>(n?r.byteLength:r?r.byteLength-l+s:0))return e.offlineOffsetSize=[l,h],e.values=null,!1;if(f<=d){if(!t)if(d<=32)l>>>=32-f;else{const w=v!=null&&v.length?v[0]:l>>>0,T=v!=null&&v.length?v[1]:Math.round((l-w)/Ve);f<=32?(l=w>>>32-f,v[0]=l):(l=w*2**(32-f)+(T>>>32-f),v[0]=w,v[1]=T>>>32-f)}if(o===1&&c===d)u=[l];else if(d===64){const w=v!=null&&v.length?v[0]:l>>>0,T=v!=null&&v.length?v[1]:Math.round((l-w)/Ve);let g=w,x=32;for(y=1;y<=o;y++){const C=32-c*y%32;if(x<c){const k=g<<C>>>32-x,A=T<<32-x>>>32-x;g=T,u.push(k+A*2**(c-x)),x-=32-(c-x)}else u.push(g<<C>>>32-c),x-=c;x===0&&(x=32,g=T)}}else for(y=1;y<=o;y++){const w=32-c*y;u.push(l<<w>>>32-c)}}else{l-=s,n&&(l=0);for(let w=l;w<l+h;w+=p){switch(a){case 1:case 2:case 7:m=new DataView(r,w,1).getUint8(0);break;case 3:m=new DataView(r,w,2).getUint16(0,t);break;case 4:case 13:m=new DataView(r,w,4).getUint32(0,t);break;case 5:m=new DataView(r,w,4).getUint32(0,t)/new DataView(r,w+4,4).getUint32(0,t);break;case 6:m=new DataView(r,w,1).getInt8(0);break;case 8:m=new DataView(r,w,2).getInt16(0,t);break;case 9:m=new DataView(r,w,4).getInt32(0,t);break;case 10:m=new DataView(r,w,4).getInt32(0,t)/new DataView(r,w+4,4).getInt32(0,t);break;case 11:m=new DataView(r,w,4).getFloat32(0,t);break;case 12:m=new DataView(r,w,8).getFloat64(0,t);break;case 16:case 18:m=Rs(new DataView(r,w,8),0,t);break;case 17:m=ki(new DataView(r,w,8),0,t);break;default:m=null}u.push(m)}}if(a===2){let w="";const T=u;for(u=[],y=0;y<T.length;y++)T[y]===0&&w!==""?(u.push(w),w=""):w+=String.fromCharCode(T[y]);w===""&&u.length!==0||u.push(w)}return e.values=u,!0}function Is(r){const t=r[0],e=H(t,"TILEWIDTH"),s=H(t,"TILELENGTH"),n=H(t,"IMAGEWIDTH"),i=H(t,"IMAGELENGTH"),a=H(t,"BITSPERSAMPLE"),o=H(t,"SAMPLESPERPIXEL"),l=H(t,"SAMPLEFORMAT")??1,u=Ps(l,a),p=xr(t),c=Hn(t,"GDAL_NODATA");let h=null;c!=null&&c.length&&(h=c.map(z=>parseFloat(z)),h.some(z=>isNaN(z))&&(h=null));const f=H(t,"COMPRESSION")??1;let m;switch(f){case 1:m="NONE";break;case 2:case 3:case 4:case 32771:m="CCITT";break;case 5:m="LZW";break;case 6:case 7:m="JPEG";break;case 32773:m="PACKBITS";break;case 8:case 32946:m="DEFLATE";break;case 34712:m="JPEG2000";break;case 34887:m="LERC";break;default:m=String(f)}let y=!0,d="";yi.has(f)||(y=!1,d+="unsupported tag compression "+f),l>3&&(y=!1,d+="unsupported tag sampleFormat "+l),a!==1&&a!==2&&a!==4&&a%8!=0&&(y=!1,d+="unsupported tag bitsPerSample "+a);const v=en(t,"GEOASCIIPARAMS");let w;if(v){const z=v.split("|").find(V=>V.includes("ESRI PE String = ")),U=z?z.replace("ESRI PE String = ",""):"";w=U.startsWith("COMPD_CS")||U.startsWith("PROJCS")||U.startsWith("GEOGCS")?{wkid:null,wkt:U}:null}const T=Pe(t,"GEOTIEPOINTS"),g=Pe(t,"GEOPIXELSCALE"),x=Pe(t,"GEOTRANSMATRIX"),C=t.has("GEOKEYDIRECTORY")?t.get("GEOKEYDIRECTORY").data:null;let k,A,S=!1,I=!1;if(C){S=H(C,"GTRasterTypeGeoKey")===2;const z=H(C,"GTModelTypeGeoKey");if(z===2){const U=H(C,"GeographicTypeGeoKey");U>=1024&&U<=32766&&(w={wkid:U}),w||U!==32767||(I=!0,w={wkid:4326})}else if(z===1){const U=H(C,"ProjectedCSTypeGeoKey");U>=1024&&U<=32766&&(w={wkid:U})}}if(g&&T&&T.length>=6?(k=[g[0],0,T[3]-T[0]*g[0],0,-Math.abs(g[1]),T[4]-T[1]*g[1]],S&&(k[2]-=.5*k[0]+.5*k[1],k[5]-=.5*k[3]+.5*k[4])):x&&x.length===16&&(k=S?[x[0],x[1],x[3]-.5*x[0],x[4],x[5],x[7]-.5*x[5]]:[x[0],x[1],x[3],x[4],x[5],x[7]]),k){const z=[{x:0,y:i},{x:0,y:0},{x:n,y:i},{x:n,y:0}];let U,V=Number.POSITIVE_INFINITY,tt=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,j=Number.NEGATIVE_INFINITY;for(let J=0;J<z.length;J++)U=wi(z[J],k),V=U.x>V?V:U.x,W=U.x<W?W:U.x,tt=U.y>tt?tt:U.y,j=U.y<j?j:U.y;A={xmin:V,xmax:W,ymin:tt,ymax:j,spatialReference:w}}else A={xmin:-.5,ymin:.5-i,xmax:n-.5,ymax:.5,spatialReference:w};I&&(A.xmax-A.xmin>400||Math.max(Math.abs(A.xmin),Math.abs(A.xmax))>361)&&(w=null,A.spatialReference=null);const R=Jn(r);let N,F,E,M,B;if(R.length>0){E=Math.round(Math.log(n/H(R[0],"IMAGEWIDTH"))/Math.LN2);const z=R[R.length-1];M=R.length,N=H(z,"TILEWIDTH"),F=H(z,"TILELENGTH")}N=M!=null&&M>0?N||e:null,F=M!=null&&M>0?F||s:null,e&&(B=[{maxCol:Math.ceil(n/e)-1,maxRow:Math.ceil(i/s)-1,minRow:0,minCol:0}],R.forEach(z=>{B.push({maxCol:Math.ceil(H(z,"IMAGEWIDTH")/H(z,"TILEWIDTH"))-1,maxRow:Math.ceil(H(z,"IMAGELENGTH")/H(z,"TILELENGTH"))-1,minRow:0,minCol:0})}));const L=en(r[0],"GDAL_METADATA"),G=Ai(L);d+=" "+Kn({width:n,height:i,tileWidth:e,tileHeight:s,planes:o,ifds:r});const q=qn(r).length===R.length+1,O=R!=null&&R.length?R.map(z=>({x:n/H(z,"IMAGEWIDTH"),y:i/H(z,"IMAGELENGTH")})):void 0;return{width:n,height:i,tileWidth:e,tileHeight:s,planes:o,isBSQ:p,pixelType:u,compression:m,noData:h,hasMaskBand:q,isSupported:y,pyramidResolutions:O,message:d,extent:A,isPseudoGeographic:I,affine:g?null:k,firstPyramidLevel:E,maximumPyramidLevel:M,pyramidBlockWidth:N,pyramidBlockHeight:F,tileBoundary:B,metadata:G}}function xr(r,t){const e=Hn(r,"PLANARCONFIGURATION");return e?e[0]===2:!!t&&t.isBSQ}function Jn(r){return r.filter(t=>H(t,"NEWSUBFILETYPE")===1)}function qn(r){return r.filter(t=>{const e=!(4&~(H(t,"NEWSUBFILETYPE")??0)),s=H(t,"PHOTOMETRICINTERPRETATION")===4;return e&&s})}function Si(r){const{littleEndian:t,isBigTiff:e,firstIFDPos:s}=Pi(r);let n=s;const i=[];do{const a=Ii(r,t,n,0,ze.tiffTags,e?8:4);if(!a.success)break;i.push(a.ifd),n=a.nextIFD}while(n>0);return{...Is(i),littleEndian:t,isBigTiff:e,ifds:i,pyramidIFDs:Jn(i),maskIFDs:qn(i)}}function Rs(r,t,e){const s=r.getUint32(t,e),n=r.getUint32(t+4,e);return e?n*Ve+s:s*Ve+n}function ki(r,t,e){let s=e?r.getInt32(t,e):r.getUint32(t,e),n=e?r.getUint32(t+4,e):r.getInt32(t+4,e);const i=(e?s:n)>=0?1:-1;return e?s*=i:n*=i,i*(e?n*Ve+s:s*Ve+n)}function cr(r,t,e,s){return s?Rs(r,t,e):r.getUint32(t,e)}function Pi(r){const t=new DataView(r,0,16),e=t.getUint16(0,!1);let s=null;if(e===18761)s=!0;else{if(e!==19789)throw new Error("unexpected endianess byte");s=!1}const n=t.getUint16(2,s);if(n!==42&&n!==43)throw new Error("unexpected tiff identifier");let i=4;const a=n===43;if(a){const o=t.getUint16(i,s);if(i+=2,o!==8)throw new Error("unsupported bigtiff version");if(t.getUint16(i,s)!==0)throw new Error("unsupported bigtiff version");i+=2}return{littleEndian:s,isBigTiff:a,firstIFDPos:cr(t,i,s,a)}}function Ii(r,t,e,s=0,n=ze.tiffTags,i=4){const a=Rr(r,t,e,s,n,i);let o;const l=a.ifd;if(l){if(ze.ifdTags.forEach((u,p)=>{l.has(p)&&(o=l.get(p),o.data=Rr(r,t,o.valueOffset-s,s,u).ifd)}),l.has("GEOKEYDIRECTORY")){o=l.get("GEOKEYDIRECTORY");const u=o.values;if(u&&u.length>4){const p=u[0]+"."+u[1]+"."+u[2];o.data=Rr(r,t,o.valueOffset+6-s,s,ze.geoKeys,2).ifd,o.data&&o.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[p]})}}if(l.has("XMP")){o=l.get("XMP");const u=o.values;typeof u[0]=="number"&&o.type===7&&(o.values=[hi(new Uint8Array(u))])}}return a}function Kn(r){const{width:t,height:e,tileHeight:s,tileWidth:n}=r,i=r.planes,a=n?n*s:t*e,o=H(r.ifds[0],"BITSPERSAMPLE");let l="";return a*i>2**30/(o>8?o/8:1)&&(l=n?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),l}function Ri(r,t,e,s,n){const i=s?4:1,a=e*i*n;s&&(r=new Uint8Array(r.buffer));for(let u=0;u<t;u++){const p=u*a;for(let c=n;c<a;c++)r[p+c]+=r[p+c-n]}if(!s)return r;const o=new Uint8Array(r.length),l=e*n;for(let u=0;u<t;u++){const p=u*a;for(let c=0;c<l;c++)for(let h=0;h<i;h++)o[p+c*i+h]=r[p+c+(i-h-1)*l]}return new Float32Array(o.buffer)}async function Ni(r,t){const{headerInfo:e,ifd:s,offsets:n,sizes:i}=t,a=[];for(let S=0;S<n.length;S++){i[S];const I=await Lr(r,e.littleEndian,s,n[S],i[S]||r.byteLength);a.push(I)}const o=xr(s,e),l=H(s,"BITSPERSAMPLE"),u=Ps(H(s,"SAMPLEFORMAT")??1,l),p=H(s,"SAMPLESPERPIXEL")||e.planes,c=vr(u),h=H(s,"TILEWIDTH"),f=H(s,"TILELENGTH"),m=H(s,"COMPRESSION")??1,y=h*f;let d;const v=[];let w=a[0];const T=m===34887;for(let S=0;S<p;S++){if(d=new c(y),a.length===p)w=a[S],w.length===y&&(d=w);else if(w.length)if(o||T)d=w.length===y?w:w.slice(y*S,y*(S+1));else for(let I=0;I<y;I++)d[I]=w[I*p+S];v.push(d)}const g=e.noData?e.noData[0]:t.noDataValue,x=e.metadata?e.metadata.statistics:null,C=x?x.map(S=>S.min):null,k=x?x.map(S=>S.max):null,A={pixelType:u,width:h,height:f,pixels:v,noDataValue:g};return g!=null?Cs(A,g,{matchAllNoData:t==null?void 0:t.matchAllNoData}):C&&k&&t.applyMinMaxConstraint&&(A.mask=Ci(v,C,k)),A}async function Fi(r,t={}){const e=t.pyramidLevel||0,s=t.headerInfo||Si(r),{ifds:n,noData:i}=s;if(n.length===0)throw new Error("no valid image file directory");const a=Kn(s);if(a)throw a;let o=null;const l=e===-1?n[n.length-1]:n[e],u=i??t.noDataValue;return o=s.tileWidth?await vi(r,s,l):xi(r,s,l),o&&(u!=null&&Cs(o,u,{matchAllNoData:i==null&&(t==null?void 0:t.matchAllNoData)}),o)}var $i=function(r){var t,e,s,n,i,a;function o(l){var u,p,c,h,f,m,y,d,v,w,T,g,x;for(this.data=l,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},f=null;;){switch(u=this.readUInt32(),d=(function(){var C,k;for(k=[],C=0;C<4;++C)k.push(String.fromCharCode(this.data[this.pos++]));return k}).call(this).join(""),d){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(u);break;case"fcTL":f&&this.animation.frames.push(f),this.pos+=4,f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},h=this.readUInt16(),c=this.readUInt16()||100,f.delay=1e3*h/c,f.disposeOp=this.data[this.pos++],f.blendOp=this.data[this.pos++],f.data=[];break;case"IDAT":case"fdAT":for(d==="fdAT"&&(this.pos+=4,u-=4),l=(f!=null?f.data:void 0)||this.imgData,T=0;0<=u?T<u:T>u;0<=u?++T:--T)l.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(u),(v=255-this.transparency.indexed.length)>0)for(g=0;0<=v?g<v:g>v;0<=v?++g:--g)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(u)[0];break;case 2:this.transparency.rgb=this.read(u)}break;case"tEXt":m=(w=this.read(u)).indexOf(0),y=String.fromCharCode.apply(String,w.slice(0,m)),this.text[y]=String.fromCharCode.apply(String,w.slice(m+1));break;case"IEND":return f&&this.animation.frames.push(f),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(x=this.colorType)===4||x===6,p=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*p,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=u}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return o.load=function(l,u,p){var c;return typeof u=="function"&&(p=u),(c=new XMLHttpRequest).open("GET",l,!0),c.responseType="arraybuffer",c.onload=function(){var h;return h=new o(new Uint8Array(c.response||c.mozResponseArrayBuffer)),typeof(u!=null?u.getContext:void 0)=="function"&&h.render(u),typeof p=="function"?p(h):void 0},c.send(null)},e=1,s=2,t=0,o.prototype.read=function(l){var u,p;for(p=[],u=0;0<=l?u<l:u>l;0<=l?++u:--u)p.push(this.data[this.pos++]);return p},o.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.decodePixels=function(l){var u,p,c,h,f,m,y,d,v,w,T,g,x,C,k,A,S,I,R,N,F,E,M;if(l==null&&(l=this.imgData),l.length===0)return new Uint8Array(0);for(l=(l=new nr(l)).getBytes(),A=(g=this.pixelBitlength/8)*this.width,x=new Uint8Array(A*this.height),m=l.length,k=0,C=0,p=0;C<m;){switch(l[C++]){case 0:for(h=R=0;R<A;h=R+=1)x[p++]=l[C++];break;case 1:for(h=N=0;N<A;h=N+=1)u=l[C++],f=h<g?0:x[p-g],x[p++]=(u+f)%256;break;case 2:for(h=F=0;F<A;h=F+=1)u=l[C++],c=(h-h%g)/g,S=k&&x[(k-1)*A+c*g+h%g],x[p++]=(S+u)%256;break;case 3:for(h=E=0;E<A;h=E+=1)u=l[C++],c=(h-h%g)/g,f=h<g?0:x[p-g],S=k&&x[(k-1)*A+c*g+h%g],x[p++]=(u+Math.floor((f+S)/2))%256;break;case 4:for(h=M=0;M<A;h=M+=1)u=l[C++],c=(h-h%g)/g,f=h<g?0:x[p-g],k===0?S=I=0:(S=x[(k-1)*A+c*g+h%g],I=c&&x[(k-1)*A+(c-1)*g+h%g]),y=f+S-I,d=Math.abs(y-f),w=Math.abs(y-S),T=Math.abs(y-I),v=d<=w&&d<=T?f:w<=T?S:I,x[p++]=(u+v)%256;break;default:throw new Error("Invalid filter algorithm: "+l[C-1])}k++}return x},o.prototype.decodePalette=function(){var l,u,p,c,h,f,m,y,d;for(p=this.palette,f=this.transparency.indexed||[],h=new Uint8Array((f.length||0)+p.length),c=0,p.length,l=0,u=m=0,y=p.length;m<y;u=m+=3)h[c++]=p[u],h[c++]=p[u+1],h[c++]=p[u+2],h[c++]=(d=f[l++])!=null?d:255;return h},o.prototype.copyToImageData=function(l,u){var p,c,h,f,m,y,d,v,w,T,g;if(c=this.colors,w=null,p=this.hasAlphaChannel,this.palette.length&&(w=(g=this._decodedPalette)!=null?g:this._decodedPalette=this.decodePalette(),c=4,p=!0),v=(h=l.data||l).length,m=w||u,f=y=0,c===1)for(;f<v;)d=w?4*u[f/4]:y,T=m[d++],h[f++]=T,h[f++]=T,h[f++]=T,h[f++]=p?m[d++]:this.transparency.grayscale&&this.transparency.grayscale===T?0:255,y=d;else for(;f<v;)d=w?4*u[f/4]:y,h[f++]=m[d++],h[f++]=m[d++],h[f++]=m[d++],h[f++]=p?m[d++]:this.transparency.rgb&&this.transparency.rgb[1]===m[d-3]&&this.transparency.rgb[3]===m[d-2]&&this.transparency.rgb[5]===m[d-1]?0:255,y=d},o.prototype.decode=function(){var l;return l=new Uint8Array(this.width*this.height*4),this.copyToImageData(l,this.decodePixels()),l},i=r.document&&r.document.createElement("canvas"),a=i&&i.getContext("2d"),n=function(l){var u;return a.width=l.width,a.height=l.height,a.clearRect(0,0,l.width,l.height),a.putImageData(l,0,0),(u=new Image).src=i.toDataURL(),u},o.prototype.decodeFrames=function(l){var u,p,c,h,f,m,y,d;if(this.animation){for(d=[],p=f=0,m=(y=this.animation.frames).length;f<m;p=++f)u=y[p],c=l.createImageData(u.width,u.height),h=this.decodePixels(new Uint8Array(u.data)),this.copyToImageData(c,h),u.imageData=c,d.push(u.image=n(c));return d}},o.prototype.renderFrame=function(l,u){var p,c,h;return p=(c=this.animation.frames)[u],h=c[u-1],u===0&&l.clearRect(0,0,this.width,this.height),(h!=null?h.disposeOp:void 0)===e?l.clearRect(h.xOffset,h.yOffset,h.width,h.height):(h!=null?h.disposeOp:void 0)===s&&l.putImageData(h.imageData,h.xOffset,h.yOffset),p.blendOp===t&&l.clearRect(p.xOffset,p.yOffset,p.width,p.height),l.drawImage(p.image,p.xOffset,p.yOffset)},o.prototype.animate=function(l){var u,p,c,h,f,m,y=this;return p=0,m=this.animation,h=m.numFrames,c=m.frames,f=m.numPlays,(u=function(){var d,v;if(d=p++%h,v=c[d],y.renderFrame(l,d),h>1&&p/h<f)return y.animation._timeout=setTimeout(u,v.delay)})()},o.prototype.stopAnimation=function(){var l;return clearTimeout((l=this.animation)!=null?l._timeout:void 0)},o.prototype.render=function(l){var u,p;return l._png&&l._png.stopAnimation(),l._png=this,l.width=this.width,l.height=this.height,u=l.getContext("2d"),this.animation?(this.decodeFrames(u),this.animate(u)):(p=u.createImageData(this.width,this.height),this.copyToImageData(p,this.decodePixels()),u.putImageData(p,0,0))},o}(self);const Mi=new Set(["jpg","png","bmp","gif"]);async function Ei(r,t){if(!ks)throw new xt("rasterCoded:decode","lerc decoder is not supported on big endian platform");await zn();const{offset:e}=t,{width:s,height:n,pixelType:i,statistics:a,depthCount:o,noDataValues:l,bandMasks:u,pixels:p,mask:c}=Vn(r,{inputOffset:e,returnInterleaved:t.returnInterleaved}),h=new $({width:s,height:n,pixelType:i.toLowerCase(),pixels:p,mask:c,statistics:a.map(({minValue:f,maxValue:m})=>new je(f,m)),bandMasks:u,depthCount:o,noDataValues:l});return a!=null&&a.length||h.updateStatistics(),h}async function Oi(r,t){const e=await Fi(r,{...t,noDataValue:t.tiffNoDataValue,matchAllNoData:t.matchAllNoData});ur(e);const s=new $({width:e.width,height:e.height,pixels:e.pixels,pixelType:e.pixelType.toLowerCase(),mask:e.mask,bandMasks:e.bandMasks,statistics:null});return s.updateStatistics(),s}async function Bi(r,t){const e=await Ni(r,t.customOptions),s=new $({width:e.width,height:e.height,pixels:e.pixels,pixelType:e.pixelType.toLowerCase(),mask:e.mask,statistics:null});return s.updateStatistics(),s}function Yn(r,t){const e=t.pixelType||"u8",s=$.getPixelArrayConstructor(e),n=e==="u8"?r:new s(r.buffer),i=[],a=t.planes||1;if(a===1)i.push(n);else for(let l=0;l<a;l++){const u=(t.width||1)*(t.height||r.length),p=new s(u);for(let c=0;c<u;c++)p[c]=n[c*a+l];i.push(p)}const o=new $({width:t.width||1,height:t.height||r.length,pixels:i,pixelType:e,statistics:null});return o.updateStatistics(),o}function Di(r,t){return Yn(new nr(new Uint8Array(r)).getBytes(),t)}function Gi(r,t){return Yn(Ts(r,t.offset,t.eof,!t.isInputBigEndian),t)}function _i(r,t,e){const{pixelTypeCtor:s}=Vi(t.pixelType),n=(0,pi.decode)(r,{width:t.width,height:t.height,pixelType:s,format:e}),i=new $({width:t.width,height:t.height,pixels:n.pixels,pixelType:t.pixelType,mask:n.mask,statistics:null});return i.updateStatistics(),i}function Li(r,t){const e=oi.decode(r,t.hasNoZlibMask??void 0),s=new $({width:e.width,height:e.height,pixels:e.pixels,pixelType:"u8",mask:e.mask,statistics:null});return s.updateStatistics(),s}function Ui(r,t){const e=new Uint8Array(r),s=new $i(e),{width:n,height:i}=t,a=n*i,o=s.decode();let l,u=0,p=0;const c=new Uint8Array(a);for(u=0;u<a;u++)c[u]=o[4*u+3];const h=new $({width:n,height:i,pixels:[],pixelType:"u8",mask:c,statistics:[]});for(u=0;u<3;u++){for(l=new Uint8Array(a),p=0;p<a;p++)l[p]=o[4*p+u];h.addData({pixels:l})}return h.updateStatistics(),h}async function ji(r,t,e,s){const n=new si,i={applyJpegMask:!1,format:t,...e},a=await n.decode(r,i,s),o=new $(a);return o.updateStatistics(),o}function Xn(r){if(r==null)throw new xt("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(r,0,10);let e="";return t[0]===255&&t[1]===216?e="jpg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?e="png":t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?e="lerc":t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?e="lerc2":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?e="tiff":t[0]===71&&t[1]===73&&t[2]===70?e="gif":t[0]===66&&t[1]===77?e="bmp":String.fromCharCode.apply(null,t).toLowerCase().includes("error")&&(e="error"),e}function zi(r){let t=null;switch(r){case"lerc":case"lerc2":t=Ei;break;case"jpg":t=Li;break;case"png":t=Ui;break;case"bsq":case"bip":t=(e,s)=>_i(e,s,r);break;case"tiff":t=Oi;break;case"deflate":t=Di;break;case"lzw":t=Gi;break;case"error":t=()=>{throw new xt("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new xt("rasterCodec:decode","unsupported raster format")}}return t}function Vi(r){let t=null,e=null;switch(r?r.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":e=255,t=Uint8Array;break;case"u16":e=e||65535,t=Uint16Array;break;case"u32":e=e||2**32-1,t=Uint32Array;break;case"s8":e=e||-128,t=Int8Array;break;case"s16":e=e||-32768,t=Int16Array;break;case"s32":e=e||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:e}}function Wi(r,t=1){if(!r)return;const{pixels:e,width:s,height:n,mask:i}=r;if(!e||e.length===0)return;const a=e.length,o=s-1,l=n-1,u=[];let p,c,h,f,m,y,d=null;const v=$.getPixelArrayConstructor(r.pixelType);if(t===0){for(p=0;p<a;p++){for(m=e[p],y=new v(o*l),c=0;c<l;c++)for(f=c*s,h=0;h<o;h++)y[c*o+h]=m[f+h];u.push(y)}if(i!=null)for(d=new Uint8Array(o*l),c=0;c<l;c++)for(f=c*s,h=0;h<o;h++)d[c*o+h]=i[f+h]}else{for(p=0;p<a;p++){for(m=e[p],y=new v(o*l),c=0;c<l;c++)for(f=c*s,h=0;h<o;h++)y[c*o+h]=(m[f+h]+m[f+h+1]+m[f+s+h]+m[f+s+h+1])/4;u.push(y)}if(i)for(d=new Uint8Array(o*l),c=0;c<l;c++)for(f=c*s,h=0;h<o;h++)d[c*o+h]=Math.min.apply(null,[i[f+h],i[f+h+1],i[f+s+h],i[f+s+h+1]])}r.width=o,r.height=l,r.mask=d,r.pixels=u}function Ic(r){let t=Xn(r);return t==="lerc2"?t="lerc":t==="error"&&(t=""),t}async function Hi(r,t={},e){var o;if(r==null)throw new xt("rasterCodec:decode","missing encodeddata parameter.");let s=(o=t.format)==null?void 0:o.toLowerCase();if(!(s!=="bsq"&&s!=="bip"||t.width!=null&&t.height!=null))throw new xt("rasterCodec:decode","requires width and height in options parameter.");if(s==="tiff"&&t.customOptions)return Bi(r,t);if((!s||s!=="bsq"&&s!=="bip"&&s!=="deflate"&&s!=="lzw")&&(s=Xn(r)),t.useCanvas&&Mi.has(s))return ji(r,s,t,e);const n=zi(s);let i;t.isPoint&&((t={...t}).width!=null&&t.width++,t.height!=null&&t.height++);const{offsets:a}=t;if(a&&a.length>1){const l=a.map((c,h)=>n(r.slice(c,a[h+1]),t)),u=await Promise.all(l);i=u[0],i.pixels=u.map(c=>c.pixels[0]);const p=u.map(c=>c.mask);u.some(c=>c!=null)&&(p.forEach((c,h)=>{c==null&&(p[h]=new Uint8Array(i.width*i.height).fill(255))}),i.bandMasks=p,i.mask=$.combineBandMasks(p)),i.updateStatistics()}else i=await n(r,{...t,offset:(a==null?void 0:a[0])??t.offset});return s!=="jpg"&&t.noDataValue!=null&&i.depthCount===1&&Cs(i,t.noDataValue,{customFloatTolerance:t.tolerance}),t.isPoint&&Wi(i),i}function Ji(r){var t,e,s;return["u8","s8"].includes(r.pixelType)&&((e=(t=r.statistics)==null?void 0:t[0])==null?void 0:e.min)!=null&&((s=r.statistics[0])==null?void 0:s.max)!=null&&r.bandCount===1}function qi(r,t){const{attributeTable:e,bandCount:s}=r;return e==null&&Ji(r)?!0:!(e==null||s>1||t&&e.fields.find(n=>n.name.toLowerCase()===t.toLowerCase())==null)}function Ki(r){const{bandCount:t,dataType:e,pixelType:s}=r;return e==="elevation"||e==="generic"&&t===1&&(s==="s16"||s==="s32"||s==="f32"||s==="f64")}function Yi(r,t=!1){const{bandCount:e,colormap:s,pixelType:n}=r;return e===1&&(!!(s!=null&&s.length)||!t&&n==="u8")}function Rc(r,t=!1){const{attributeTable:e,bandCount:s}=r;return s===1&&(!t||e!=null||r.histograms!=null)}function Nc(r){const{dataType:t}=r;return t==="vector-uv"||t==="vector-magdir"}function Fc(r){const{dataType:t}=r;return t==="vector-uv"||t==="vector-magdir"}function tr(r){return!!(r!=null&&r.length)&&r.length<=16384}const Nr=1;function Zn(r,t=256){t=Math.min(t,256);const{size:e,counts:s}=r,n=new Uint8Array(e),i=s.reduce((p,c)=>p+c/t,0);let a=0,o=0,l=0,u=i;for(let p=0;p<e;p++)if(l+=s[p],!(p<e-1&&l+s[p+1]<u)){for(;a<t-1&&u<l;)a++,u+=i;for(let c=o;c<=p;c++)n[c]=a;o=p+1}for(let p=o;p<e;p++)n[p]=t-1;return n}function Ur(r){const{minCutOff:t,maxCutOff:e,gamma:s,pixelType:n,rounding:i}=r;if(!["u8","u16","s8","s16"].includes(n))return null;const a=t.length,o=n==="s8"?-127:n==="s16"?-32767:0,l=["u16","s16"].includes(n)?65536:256,u=[],p=[],{minOutput:c=0,maxOutput:h=255}=r,f=h-c;for(let y=0;y<a;y++)p[y]=e[y]-t[y],u[y]=p[y]===0?0:f/p[y];const m=[];if(s&&s.length>=a){const y=Ns(a,s);for(let d=0;d<a;d++){const v=[];for(let w=0;w<l;w++){if(p[d]===0){v[w]=c;continue}const T=w+o,g=(T-t[d])/p[d];let x=1;if(s[d]>1&&(x-=(1/f)**(g*y[d])),T<e[d]&&T>t[d]){const C=x*f*g**(1/s[d])+c;v[w]=i==="floor"?Math.floor(C):i==="round"?Math.round(C):C}else T>=e[d]?v[w]=h:v[w]=c}m[d]=v}}else for(let y=0;y<a;y++){const d=[];for(let v=0;v<l;v++){const w=v+o;if(w<=t[y])d[v]=c;else if(w>=e[y])d[v]=h;else{const T=(w-t[y])*u[y]+c;d[v]=i==="floor"?Math.floor(T):i==="round"?Math.round(T):T}}m[y]=d}if(r.contrastOffset!=null){const y=Qn(r.contrastOffset,r.brightnessOffset);for(let d=0;d<a;d++){const v=m[d];for(let w=0;w<l;w++)v[w]=y[v[w]]}}return{lut:m,offset:o}}function Qn(r,t){const e=Math.min(Math.max(r,-100),100),s=Math.min(Math.max(t??0,-100),100),n=255,i=128,a=new Uint8Array(256);for(let o=0;o<256;o++){let l=0;e>0&&e<100?l=(200*o-100*n+2*n*s)/(2*(100-e))+i:e<=0&&e>-100?l=(200*o-100*n+2*n*s)*(100+e)/2e4+i:e===100?(l=200*o-100*n+(n+1)*(100-e)+2*n*s,l=l>0?n:0):e===-100&&(l=i),a[o]=l>n?n:l<0?0:l}return a}function Xi(r,t,e){const s=[];for(let n=0;n<t.length;n++){let i=0,a=0,o=0;"min"in t[n]?{min:i,max:a,avg:o}=t[n]:[i,a,o]=t[n];let l=o??0;r!=="u8"&&(l=255*(l-i)/(a-i)),s.push(Zi(l))}return s}function Zi(r){if(r<=0||r>=255)return Nr;const t=255,e=r+(r===150?0:r<150?45*Math.cos(.01047*r):17*Math.sin(.021*r)),s=Math.log(r/t),n=Math.log(e/t);if(n===0)return Nr;const i=s/n;return isNaN(i)?Nr:Math.min(9.9,Math.max(.01,i))}function Qi(r,t,e,s){let n=1/0,i=-1/0,a=0,o=0,l=0,u=0;const p=r.length,c=new Map,h=[];for(let k=0;k<p;k++){const A=r[k];if(!t||t[k]){h.push(A);const S=(c.get(A)??0)+1;c.set(A,S),S>u&&(u=S,l=A),n=A<n?A:n,i=A>i?A:i,a+=A,o++}}if(o===0)return{statistics:{min:0,max:0,avg:0,stddev:0,mode:0,median:0},histogram:null};const f=a/o;let m=0;for(let k=0;k<p;k++)t&&!t[k]||(m+=(r[k]-f)**2);const y=t?t.filter(k=>k).length:p,d=y<=1?0:Math.sqrt(m/(y-1));h.sort((k,A)=>k-A);const v=o>>>1,w={min:n,max:i,avg:f,stddev:d,mode:l,median:o%2?h[Math.floor(v)]:(h[v-1]+h[v])/2};if(["u8","s8","u4","u2","u1"].includes(e)){const k=i-n+1,A=new Uint32Array(k);for(let S=0;S<p;S++)t&&!t[S]||A[r[S]-n]++;return{statistics:w,histogram:{min:n-.5,max:i+.5,size:k,counts:A}}}const T=256,g=new Uint32Array(T),x=(i-n)/T;if(x===0)return{statistics:w,histogram:{min:n,max:i,size:1,counts:new Uint32Array(1).fill(o)}};const C=new Uint32Array(T+1);for(let k=0;k<p;k++)t&&!t[k]||C[Math.floor((r[k]-n)/x)]++;for(let k=0;k<T-1;k++)g[k]=C[k];return g[T-1]=C[T-1]+C[T],{statistics:w,histogram:{min:n,max:i,size:T,counts:g}}}function ta(r){const{pixels:t,mask:e,pixelType:s,bandMasks:n}=r,i=t.map((a,o)=>Qi(a,(n==null?void 0:n[o])??e,s));return{statistics:i.map(({statistics:a})=>a),histograms:i.map(({histogram:a})=>a)}}function to(r){var h;if(!((h=r==null?void 0:r.pixels)!=null&&h.length))return null;const{pixels:t,mask:e,bandMasks:s,pixelType:n}=r,i=r.width*r.height,a=t.length,o=[],l=[],u=256;let p,c;for(let f=0;f<a;f++){let m=new Uint32Array(u);const y=t[f],d=(s==null?void 0:s[f])??e;if(n==="u8"){if(p=255,c=0,d){for(let R=0;R<i;R++)if(d[R]){const N=y[R];p=N<p?N:p,c=N>c?N:c,m[N]++}}else for(let R=0;R<i;R++){const N=y[R];p=N<p?N:p,c=N>c?N:c,m[N]++}m=m.slice(p,c+1)}else{let R=!1;r.statistics||(r.updateStatistics(),R=!0);const N=r.statistics;p=N[f].minValue,c=N[f].maxValue;const F=(c-p)/u;if(F===0){!N||r.validPixelCount||R||r.updateStatistics();const E=(r.validPixelCount||r.width*r.height)/u;for(let M=0;M<u;M++)m[M]=Math.round(E*(M+1))-Math.round(E*M)}else{const E=new Uint32Array(u+1);for(let M=0;M<i;M++)d&&!d[M]||E[Math.floor((y[M]-p)/F)]++;for(let M=0;M<u-1;M++)m[M]=E[M];m[u-1]=E[u-1]+E[u]}}const v=n==="u8"?p-.5:p,w=n==="u8"?c+.5:c;o.push({min:v,max:w,size:m.length,counts:m});let T=0,g=0,x=0;for(let R=0;R<m.length;R++)T+=m[R],g+=R*m[R];const C=g/T;for(let R=0;R<m.length;R++)x+=m[R]*(R-C)**2;const k=Math.sqrt(x/(T-1)),A=(w-v)/m.length,S=(C+(n==="u8"?0:.5))*A+p,I=k*A;l.push({min:p,max:c,avg:S,stddev:I})}return{statistics:l,histograms:o}}function $c(r){const t=[];for(let e=0;e<r.length;e++){const{min:s,max:n,size:i,counts:a}=r[e];let o=0,l=0;for(let m=0;m<i;m++)o+=a[m],l+=m*a[m];const u=l/o;let p=0;for(let m=0;m<i;m++)p+=a[m]*(m-u)**2;const c=(n-s)/i,h=(u+.5)*c+s,f=Math.sqrt(p/(o-1))*c;t.push({min:s,max:n,avg:h,stddev:f})}return t}function Kt(r,t){var v;const{pixelBlock:e,bandIds:s,returnHistogramLut:n,rasterInfo:i}=t;let a=null,o=null,l=r.stretchType;if(typeof l=="number"&&(l=Qo[l]),r.dra)if(l==="minMax"&&(e!=null&&e.statistics))a=e.statistics.map(w=>[w.minValue,w.maxValue,0,0]);else{const w=to(e);a=w!=null?w.statistics:null,o=w!=null?w.histograms:null}else a=(v=r.statistics)!=null&&v.length?r.statistics:i.statistics,o="histograms"in r?r.histograms:void 0,o||(o=i.histograms);l!=="percentClip"&&l!=="histogramEqualization"||o!=null&&o.length||(l="minMax");const u=(a==null?void 0:a.length)||(o==null?void 0:o.length)||i.bandCount,p=[],c=[];a&&!Array.isArray(a[0])&&(a=a.map(w=>[w.min,w.max,w.avg,w.stddev]));const[h,f]=Qt(i.pixelType);if(!(a!=null&&a.length)){a=[];for(let w=0;w<u;w++)a.push([h,f,1,1]);l==="standardDeviation"&&(l="minMax")}switch(l){case"none":for(let w=0;w<u;w++)p[w]=h,c[w]=f;break;case"minMax":for(let w=0;w<u;w++){const T=a[w];p[w]=T[0],c[w]=T[1]}break;case"standardDeviation":{const{numberOfStandardDeviations:w=2}=r;for(let T=0;T<u;T++){const g=a[T];p[T]=g[2]-w*g[3],c[T]=g[2]+w*g[3],p[T]<g[0]&&(p[T]=g[0]),c[T]>g[1]&&(c[T]=g[1])}}break;case"histogramEqualization":ur(o);for(let w=0;w<u;w++)p[w]=o[w].min,c[w]=o[w].max;break;case"percentClip":ur(o);for(let w=0;w<o.length;w++){const T=o[w],g=new Uint32Array(T.size),x=[...T.counts];x.length>=20&&(x[0]=x[1]=x[2]=x[x.length-1]=x[x.length-2]=0);let C=0;const k=(T.max-T.min)/T.size,A=T.min===-.5&&k===1?.5:0;for(let I=0;I<T.size;I++)C+=x[I],g[I]=C;let S=(r.minPercent||0)*C/100;p[w]=T.min+A;for(let I=0;I<T.size;I++)if(g[I]>S){p[w]=T.min+k*(I+A);break}S=(1-(r.maxPercent||0)/100)*C,c[w]=T.max+A;for(let I=T.size-2;I>=0;I--)if(g[I]<S){c[w]=T.min+k*(I+2-A);break}if(c[w]<p[w]){const I=p[w];p[w]=c[w],c[w]=I}}break;default:for(let w=0;w<u;w++){const T=a[w];p[w]=T[0],c[w]=T[1]}}let m,y,d;return l==="histogramEqualization"?(ur(o),y=o[0].size||256,m=0,n&&(d=o.map(w=>Zn(w)))):(y=r.max||255,m=r.min||0),ea({minCutOff:p,maxCutOff:c,maxOutput:y,minOutput:m,histogramLut:d},s)}function ea(r,t){if(t==null||t.length===0)return r;const e=Math.max.apply(null,t),{minCutOff:s,maxCutOff:n,minOutput:i,maxOutput:a,histogramLut:o}=r;return s.length===t.length||s.length<=e?r:{minCutOff:t.map(l=>s[l]),maxCutOff:t.map(l=>n[l]),histogramLut:o?t.map(l=>o[l]):null,minOutput:i,maxOutput:a}}function Ns(r,t){const e=new Float32Array(r);for(let s=0;s<r;s++)t[s]>1?t[s]>2?e[s]=6.5+(t[s]-2)**2.5:e[s]=6.5+100*(2-t[s])**4:e[s]=1;return e}function pr(r,t){var k;if(!((k=r==null?void 0:r.pixels)!=null&&k.length))return r;const{mask:e,bandMasks:s,width:n,height:i,pixels:a}=r,{minCutOff:o,maxCutOff:l,minOutput:u,maxOutput:p,gamma:c}=t,h=n*i,f=t.outputPixelType||"u8",m=r.pixels.map(()=>$.createEmptyBand(f,h)),y=m.length,d=p-u,v=[],w=[];for(let A=0;A<y;A++)w[A]=l[A]-o[A],v[A]=w[A]===0?0:d/w[A];const T=f.startsWith("u")||f.startsWith("s"),g=c&&c.length>=y,x=!!t.isRenderer;if(g){const A=Ns(y,c);for(let S=0;S<y;S++){const I=(s==null?void 0:s[S])??e;for(let R=0;R<h;R++)if(I==null||I[R]){if(w[S]===0){m[S][R]=u;continue}const N=a[S][R],F=(N-o[S])/w[S];let E=1;if(c[S]>1&&(E-=(1/d)**(F*A[S])),N<l[S]&&N>o[S]){const M=E*d*F**(1/c[S])+u;m[S][R]=x?Math.floor(M):T?Math.round(M):M}else N>=l[S]?m[S][R]=p:m[S][R]=u}}}else for(let A=0;A<y;A++){const S=(s==null?void 0:s[A])??e;for(let I=0;I<h;I++)if(S==null||S[I]){const R=a[A][I];if(R<l[A]&&R>o[A]){const N=(R-o[A])*v[A]+u;m[A][I]=x?Math.floor(N):T?Math.round(N):N}else R>=l[A]?m[A][I]=p:m[A][I]=u}}const C=new $({width:n,height:i,mask:e,bandMasks:s,pixels:m,pixelType:f});return C.updateStatistics(),C}const gt=1,$t=1/111e3;function Cr(r){let{altitude:t,azimuth:e}=r;const{hillshadeType:s,pixelSizePower:n=1,pixelSizeFactor:i=1,scalingType:a,isGCS:o,resolution:l}=r,u=s==="multi-directional"?2*r.zFactor:r.zFactor,{x:p,y:c}=l;let h=u/(8*p),f=u/(8*c);if(o&&u>.001&&(h/=$t,f/=$t),a==="adjusted")if(o){const N=p*$t,F=c*$t;h=(u+N**n*i)/(8*N),f=(u+F**n*i)/(8*F)}else h=(u+p**n*i)/(8*p),f=(u+c**n*i)/(8*c);let m=(90-t)*Math.PI/180,y=Math.cos(m),d=(360-e+90)*Math.PI/180,v=Math.sin(m)*Math.cos(d),w=Math.sin(m)*Math.sin(d);const T=[315,270,225,360,180,0],g=[60,60,60,60,60,90],x=new Float32Array([3,5,3,2,1,4]),C=x.reduce((N,F)=>N+F),k=x.map(N=>N/C),A=s==="multi-directional"?T.length:1,S=new Float32Array(6),I=new Float32Array(6),R=new Float32Array(6);if(s==="multi-directional")for(let N=0;N<A;N++)t=g[N],e=T[N],m=(90-t)*Math.PI/180,y=Math.cos(m),d=(360-e+90)*Math.PI/180,v=Math.sin(m)*Math.cos(d),w=Math.sin(m)*Math.sin(d),S[N]=y,I[N]=v,R[N]=w;else S.fill(y),I.fill(v),R.fill(w);return{resolution:l,factor:[h,f],sinZcosA:v,sinZsinA:w,cosZ:y,sinZcosAs:[...I],sinZsinAs:[...R],cosZs:[...S],weights:[...k],hillshadeType:["traditional","multi-directional"].indexOf(s)}}function Ar(r,t){const{width:e,height:s}=r,n=e*s,i=new Uint8Array(n),a=r.mask!=null;let o;if(a){o=new Uint8Array(r.mask);for(let C=0;C<o.length;C++)o[C]&&(i[C]=1,o[C]=1)}const l=r.pixels[0],u=new Float32Array(n),p=new Float32Array(n);let c,h=0;if(t){const{resolution:C}=t,k=C?(C.x+C.y)/2:1;h=200*t.zFactor/(k*k),c=new Float32Array(n)}const f=t==null?void 0:t.curvatureType;let m,y,d,v,w,T,g,x;for(let C=gt;C<s-gt;C++){const k=C*e;for(let A=gt;A<e-gt;A++){const S=k+A;if(!o||o[S]!==0){if(o){if(o[S-e-1]+o[S-e]+o[S-e+1]+o[S-1]+o[S+1]+o[S+e-1]+o[S+e]+o[S+e+1]<7){i[S]=0;continue}m=o[S-e-1]?l[S-e-1]:l[S],y=o[S-e]?l[S-e]:l[S],d=o[S-e+1]?l[S-e+1]:l[S],v=o[S-1]?l[S-1]:l[S],w=o[S+1]?l[S+1]:l[S],T=o[S+e-1]?l[S+e-1]:l[S],g=o[S+e]?l[S+e]:l[S],x=o[S+e+1]?l[S+e+1]:l[S]}else m=l[S-e-1],y=l[S-e],d=l[S-e+1],v=l[S-1],w=l[S+1],T=l[S+e-1],g=l[S+e],x=l[S+e+1];if(u[S]=d+w+w+x-(m+v+v+T),p[S]=T+g+g+x-(m+y+y+d),c!=null){const I=l[S],R=.5*(v+w)-I,N=.5*(y+g)-I;if(f==="standard")c[S]=-h*(R+N);else{const F=(-m+d+T-x)/4,E=(-v+w)/2,M=(y-g)/2,B=E*E,L=M*M,G=B+L;G&&(c[S]=f==="profile"?h*(R*B+N*L+F*E*M)/G:-h*(R*L+N*B-F*E*M)/G)}}}}}return{outMask:a?i:null,dzxs:u,dzys:p,curvatures:c}}function Tr(r,t,e){for(let s=0;s<e;s++)r[s*t]=r[s*t+1],r[(s+1)*t-1]=r[(s+1)*t-2];for(let s=1;s<t-1;s++)r[s]=r[s+t],r[s+(e-1)*t]=r[s+(e-2)*t]}function Fs(r,t){if(!Zt(r))return r;const{factor:e,sinZcosA:s,sinZsinA:n,cosZ:i,sinZcosAs:a,sinZsinAs:o,cosZs:l,weights:u}=Cr(t),[p,c]=e,h=t.hillshadeType==="traditional",{width:f,height:m}=r,y=new Uint8Array(f*m),{dzxs:d,dzys:v,outMask:w}=Ar(r);for(let T=gt;T<m-gt;T++){const g=T*f;for(let x=gt;x<f-gt;x++){const C=g+x;if(!w||w[C]){const k=d[C]*p,A=v[C]*c,S=Math.sqrt(1+k*k+A*A);let I=0;if(h){let R=255*(i+n*A-s*k)/S;R<0&&(R=0),I=R}else{const R=o.length;for(let N=0;N<R;N++){let F=255*(l[N]+o[N]*A-a[N]*k)/S;F<0&&(F=0),I+=F*u[N]}}y[C]=255&I}}}return Tr(y,f,m),new $({width:f,height:m,pixels:[y],mask:w,pixelType:"u8",validPixelCount:r.validPixelCount,statistics:[new je(0,255)]})}function eo(r,t,e,s){if(!Zt(r)||!Zt(t))return;const{min:n,max:i}=s,a=r.pixels[0],{pixels:o,mask:l}=t,u=o[0],p=255.00001/(i-n),c=new Uint8ClampedArray(u.length),h=new Uint8ClampedArray(u.length),f=new Uint8ClampedArray(u.length),m=e.length-1;for(let y=0;y<u.length;y++){if(l&&l[y]===0)continue;const d=Math.floor((u[y]-n)*p),[v,w]=e[d<0?0:d>m?m:d],T=a[y],g=T*w,x=g*(1-Math.abs(v%2-1)),C=T-g;switch(Math.floor(v)){case 0:c[y]=g+C,h[y]=x+C,f[y]=C;break;case 1:c[y]=x+C,h[y]=g+C,f[y]=C;break;case 2:c[y]=C,h[y]=g+C,f[y]=x+C;break;case 3:c[y]=C,h[y]=x+C,f[y]=g+C;break;case 4:c[y]=x+C,h[y]=C,f[y]=g+C;break;case 5:case 6:c[y]=g+C,h[y]=C,f[y]=x+C}}r.pixels=[c,h,f],r.updateStatistics()}function ra(r,t){if(!Zt(r))return r;const e=t.zFactor,s=t.pixelSizePower??1,n=t.pixelSizeFactor??1,i=t.slopeType,a=t.isGCS,{x:o,y:l}=t.resolution;let u=e/(8*o),p=e/(8*l);a&&Math.abs(e-1)<1e-4&&(u/=$t,p/=$t),i==="adjusted"&&(u=(e+o**s*n)/(8*o),p=(e+l**s*n)/(8*l));const{dzxs:c,dzys:h,outMask:f}=Ar(r),{width:m,height:y}=r,d=new Float32Array(m*y);for(let w=gt;w<y-gt;w++){const T=w*m;for(let g=gt;g<m-gt;g++){const x=T+g;if(!f||f[x]){const C=c[x]*u,k=h[x]*p,A=Math.sqrt(C*C+k*k);d[T+g]=i==="percent-rise"?100*A:57.2957795*Math.atan(A)}}}Tr(d,m,y);const v=new $({width:m,height:y,pixels:[d],mask:f,pixelType:"f32",validPixelCount:r.validPixelCount});return v.updateStatistics(),v}function sa(r,t={}){if(!Zt(r))return r;const{resolution:e}=t,s=e?1/e.x:1,n=e?1/e.y:1,{dzxs:i,dzys:a,outMask:o}=Ar(r),{width:l,height:u}=r,p=new Float32Array(l*u);for(let c=gt;c<u-gt;c++){const h=c*l;for(let f=gt;f<l-gt;f++){const m=h+f;if(!o||o[m]){const y=i[m]*s,d=a[m]*n;let v=-1;y===0&&d===0||(v=90-57.29578*Math.atan2(d,-y),v<0&&(v+=360),v===360?v=0:v>360&&(v%=360)),p[h+f]=v}}}return Tr(p,l,u),new $({width:l,height:u,pixels:[p],mask:o,pixelType:"f32",validPixelCount:r.validPixelCount,statistics:[new je(-1,360)]})}function na(r,t){if(!Zt(r))return r;const{curvatures:e,outMask:s}=Ar(r,t),{width:n,height:i}=r;Tr(e,n,i);const a=new $({width:n,height:i,pixels:[e],mask:s,pixelType:"f32",validPixelCount:r.validPixelCount});return a.updateStatistics(),a}function wr(r,t,e){const{hillshadeType:s,altitude:n,azimuth:i,zFactor:a,pixelSizeFactor:o,pixelSizePower:l,slopeType:u}=r;return{hillshadeType:s,altitude:n,azimuth:i,zFactor:a,pixelSizePower:l,pixelSizeFactor:o,scalingType:u==="scaled"?"adjusted":"none",resolution:t,isGCS:e}}let ie=class extends Lt{constructor(t){super(t)}bind(){const{rendererJSON:t}=this;if(!t)return{success:!1};let e;switch(this.lookup={rendererJSON:{}},t.type){case"uniqueValue":e=this._updateUVRenderer(t);break;case"rasterColormap":e=this._updateColormapRenderer(t);break;case"rasterStretch":e=this._updateStretchRenderer(t);break;case"classBreaks":e=this._updateClassBreaksRenderer(t);break;case"rasterShadedRelief":e=this._updateShadedReliefRenderer(t);break;case"vectorField":e=this._updateVectorFieldRenderer();break;case"flowRenderer":e=this._updateFlowRenderer()}return e}symbolize(t){let e=t==null?void 0:t.pixelBlock;if(!rn(e))return e;if(t.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(e,t.simpleStretchParams);try{let s;switch(e.pixels.length>3&&(e=e.extractBands(t.bandIds??[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":s=this._symbolizeColormap(e);break;case"classBreaks":s=this._symbolizeClassBreaks(e);break;case"rasterStretch":s=this._symbolizeStretch(e,t.bandIds);break;case"rasterShadedRelief":{const n=t.extent,i=n.spatialReference.isGeographic,a={x:(n.xmax-n.xmin)/e.width,y:(n.ymax-n.ymin)/e.height};s=this._symbolizeShadedRelief(e,{isGCS:i,resolution:a});break}}return s}catch(s){return Gs.getLogger(this).error("symbolize",s.message),e}}simpleStretch(t,e){if(!rn(t))return t;try{return t.pixels.length>3&&(t=t.extractBands([0,1,2])),pr(t,{...e,isRenderer:!0})}catch(s){return Gs.getLogger(this).error("symbolize",s.message),t}}generateWebGLParameters(t){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){const{indexedColormap:o,offset:l}=this.lookup.colormapLut||{};return{colormap:o,colormapOffset:l,isClassBreaks:this.rendererJSON.type==="classBreaks",type:"lut"}}const{pixelBlock:e,isGCS:s,resolution:n,bandIds:i}=t,{rendererJSON:a}=this;return a.type==="rasterStretch"?this._generateStretchWebGLParams(e,a,i):a.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(a,s,n??void 0):a.type==="vectorField"?this._generateVectorFieldWebGLParams(a):null}_isLUTChanged(t){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const e=this.rendererJSON.colorRamp;return t?JSON.stringify(e)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(t){return this._isLUTChanged()&&!this.bind().success?t:kr(t,this.lookup.colormapLut)}_symbolizeClassBreaks(t){const{canUseIndexedLUT:e}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?t:e?kr(t,this.lookup.colormapLut):Ao(t,this.lookup.remapLut??[])}_symbolizeStretch(t,e){var h,f;const{rasterInfo:s}=this,{pixelType:n,bandCount:i}=s,a=this.rendererJSON,o=["u8","u16","s8","s16"].includes(n);let l,u;const{dra:p}=a,{gamma:c}=this.lookup;if(a.stretchType==="histogramEqualization"){const m=p?null:(h=this.lookup)==null?void 0:h.histogramLut,y=Kt(a,{rasterInfo:s,pixelBlock:t,bandIds:e,returnHistogramLut:!m}),d=pr(t,{...y,gamma:c,isRenderer:!0});u=rr(d,{lut:p?y.histogramLut:m,offset:0})}else if(o){if(p){const m=Kt(a,{rasterInfo:s,pixelBlock:t,bandIds:e});l=Ur({pixelType:n,...m,gamma:c,rounding:"floor"})}else if(this._isLUTChanged()){if(!this.bind().success)return t;l=this.lookup?this.lookup.stretchLut:null}else l=this.lookup?this.lookup.stretchLut:null;if(!l)return t;i>1&&e!=null&&e.length===(t==null?void 0:t.pixels.length)&&(l==null?void 0:l.lut.length)===i&&(l={lut:e.map(m=>l.lut[m]),offset:l.offset}),u=rr(t,l)}else{const m=Kt(a,{rasterInfo:s,pixelBlock:t,bandIds:e});u=pr(t,{...m,gamma:c,isRenderer:!0})}if(a.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return t;u=kr(u,(f=this.lookup)==null?void 0:f.colormapLut)}return u}_symbolizeShadedRelief(t,e){var l;const s=this.rendererJSON,n={...s,...e},i=Fs(t,n);if(!s.colorRamp)return i;let a;if(this._isLUTChanged(!0)){if(!this.bind().success)return i;a=this.lookup?this.lookup.hsvMap:null}else a=this.lookup?this.lookup.hsvMap:null;if(!a)return i;const o=((l=this.rasterInfo.statistics)==null?void 0:l[0])??{min:0,max:8e3};return eo(i,t,a,o),i}_isVectorFieldData(){const{bandCount:t,dataType:e}=this.rasterInfo;return t===2&&(e==="vector-magdir"||e==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(t){var p;const{bandCount:e,attributeTable:s,pixelType:n}=this.rasterInfo,i=t.field1;if(!i)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const a=t.defaultSymbol,o=e===1&&["u8","s8"].includes(n);if(!qi(this.rasterInfo,i)&&!o)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const l=[];if(s!=null){const c=s.fields.find(h=>h.name.toLowerCase()==="value");if(!c)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};s.features.forEach(h=>{var y,d;const f=(y=t.uniqueValueInfos)==null?void 0:y.find(v=>String(v.value)===String(h.attributes[i])),m=(d=f==null?void 0:f.symbol)==null?void 0:d.color;m?l.push([h.attributes[c.name]].concat(m)):a&&l.push([h.attributes[c.name]].concat(a.color))})}else{if(i.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not available.'};(p=t.uniqueValueInfos)==null||p.forEach(c=>{var f;const h=(f=c==null?void 0:c.symbol)==null?void 0:f.color;h?l.push([parseInt(""+c.value,10)].concat(h)):a&&l.push([parseInt(""+c.value,10)].concat(a==null?void 0:a.color))})}if(l.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const u=ke({colormap:l});return this.lookup={rendererJSON:t,colormapLut:u},this.canRenderInWebGL=tr(u==null?void 0:u.indexedColormap),{success:!0}}_updateColormapRenderer(t){if(!Yi(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const e=t.colormapInfos.map(n=>[n.value].concat(n.color)).sort((n,i)=>n[0]-i[0]);if(!e||e.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const s=ke({colormap:e});return this.lookup={rendererJSON:t,colormapLut:s},this.canRenderInWebGL=tr(s==null?void 0:s.indexedColormap),{success:!0}}_updateShadedReliefRenderer(t){if(!Ki(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(t.colorRamp){const e=sr(t.colorRamp,{interpolateAlpha:!0}),s=ke({colormap:e}),n=Gn(s.indexedColormap);this.lookup={rendererJSON:t,colormapLut:s,hsvMap:n}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(t){const{attributeTable:e,pixelType:s}=this.rasterInfo,n=e!=null?e.fields.find(o=>o.name.toLowerCase()==="value"):null,i=e!=null?e.fields.find(o=>o.name.toLowerCase()===t.field.toLowerCase()):null,a=n!=null&&i!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(s)||a,tableValueField:n,tableBreakField:i}}_updateClassBreaksRenderer(t){const{attributeTable:e}=this.rasterInfo,{canUseIndexedLUT:s,tableValueField:n,tableBreakField:i}=this._analyzeClassBreaks(t),a=t.classBreakInfos;if(!(a!=null&&a.length))return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const o=a.sort((h,f)=>h.classMaxValue-f.classMaxValue),l=o[o.length-1];let u=t.minValue;if(!s){const h=[];for(let f=0;f<o.length;f++)h.push({value:o[f].classMinValue??u,mappedColor:o[f].symbol.color}),u=o[f].classMaxValue;return h.push({value:l.classMaxValue,mappedColor:l.symbol.color}),this.lookup={rendererJSON:t,remapLut:h},this.canRenderInWebGL=!1,{success:!0}}const p=[];if(e!=null&&n!=null&&i!==null&&n!==i){const h=n.name,f=i.name,m=o[o.length-1],{classMaxValue:y}=m;u=t.minValue;for(const d of e.features){const v=d.attributes[h],w=d.attributes[f],T=w===y?m:w<u?null:o.find(({classMaxValue:g})=>g>w);T&&p.push([v].concat(T.symbol.color))}}else{u=Math.floor(t.minValue);for(let h=0;h<o.length;h++){const f=o[h];for(let m=u;m<f.classMaxValue;m++)p.push([m].concat(f.symbol.color));u=Math.ceil(f.classMaxValue)}l.classMaxValue===u&&p.push([l.classMaxValue].concat(l.symbol.color))}const c=ke({colormap:p,fillUnspecified:!1});return this.lookup={rendererJSON:t,colormapLut:c},this.canRenderInWebGL=tr(c==null?void 0:c.indexedColormap),{success:!0}}_updateStretchRenderer(t){var c,h;let{stretchType:e,dra:s}=t;if(!(e==="none"||(c=t.statistics)!=null&&c.length||aa(this.rasterInfo.statistics)||s))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};const n=t.histograms||this.rasterInfo.histograms;!ia(t.stretchType)||n!=null&&n.length||s||(e="minMax");const{computeGamma:i,useGamma:a,colorRamp:o}=t;let{gamma:l}=t;if(a&&i&&!(l!=null&&l.length)){const f=(h=t.statistics)!=null&&h.length?t.statistics:this.rasterInfo.statistics;l=Xi(this.rasterInfo.pixelType,f)}const u=this.rasterInfo.pixelType,p=!s&&["u8","u16","s8","s16"].includes(u);if(e==="histogramEqualization"){const f=n.map(m=>Zn(m));this.lookup={rendererJSON:t,histogramLut:f}}else if(p){const f=Kt(t,{rasterInfo:this.rasterInfo}),m=Ur({pixelType:u,...f,gamma:a?l:null,rounding:"floor"});this.lookup={rendererJSON:t,stretchLut:m}}if(o&&!la(o)){const f=sr(o,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:t}),this.lookup.colormapLut=ke({colormap:f}),this.lookup.rendererJSON=t}return this.lookup.gamma=a&&(l!=null&&l.length)?l:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(t,e,s){var x;let n=null,i=null;const a=(x=this.lookup)==null?void 0:x.colormapLut;e.colorRamp&&a&&(n=a.indexedColormap,i=a.offset),e.stretchType==="histogramEqualization"&&(e={...e,stretchType:"minMax"});const{gamma:o}=this.lookup,l=!(!e.useGamma||!(o!=null&&o.some(C=>C!==1))),{minCutOff:u,maxCutOff:p,minOutput:c,maxOutput:h}=Kt(e,{rasterInfo:this.rasterInfo,pixelBlock:t,bandIds:s});let f=0;t!=null&&(f=t.getPlaneCount(),f===2&&((t=t.clone()).statistics=[t.statistics[0]],t.pixels=[t.pixels[0]]));const{bandCount:m}=this.rasterInfo,y=Math.min(3,(s==null?void 0:s.length)||f||m,m),d=n||l?1:255,v=new Float32Array(y);if(l&&o)for(let C=0;C<y;C++)o[C]>1?o[C]>2?v[C]=6.5+(o[C]-2)**2.5:v[C]=6.5+100*(2-o[C])**4:v[C]=1;u.length===1&&(u[2]=u[1]=u[0]),p.length===1&&(p[2]=p[1]=p[0]);const w=l&&o?[o[0],o[1]??o[0],o[2]??o[0]]:[1,1,1],T=l?[v[0],v[1]??v[0],v[2]??v[0]]:[1,1,1],g=p.map((C,k)=>p[k]===u[k]?0:(h-c)/(p[k]-u[k])/d);return{bandCount:y,minOutput:c/d,maxOutput:h/d,minCutOff:u,maxCutOff:p,factor:g,useGamma:l,gamma:w,gammaCorrection:T,colormap:n,colormapOffset:i,stretchType:e.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(t,e=!1,s={x:0,y:0}){var p,c;let n=null,i=null;const a=(p=this.lookup)==null?void 0:p.colormapLut;t.colorRamp&&a&&(n=a.indexedColormap,i=a.offset);const o={...t,isGCS:e,resolution:s},l=Cr(o),u=(c=this.rasterInfo.statistics)==null?void 0:c[0];return{...l,minValue:(u==null?void 0:u.min)??0,maxValue:(u==null?void 0:u.max)??8e3,hillshadeType:t.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:n,colormapOffset:i}}_generateVectorFieldWebGLParams(t){var w,T,g;const{style:e,inputUnit:s,outputUnit:n,visualVariables:i,symbolTileSize:a,flowRepresentation:o}=t;let l;const u=((w=this.rasterInfo.statistics)==null?void 0:w[0].min)??0,p=((T=this.rasterInfo.statistics)==null?void 0:T[0].max)??50,c=(i==null?void 0:i.find(x=>x.type==="sizeInfo"))??{maxDataValue:p,maxSize:.8*a,minDataValue:u,minSize:.2*a},h=c.minDataValue??u,f=c.maxDataValue??p,m=c.maxSize!=null&&c.minSize!=null?[c.minSize/a,c.maxSize/a]:[.2,.8];if(e==="wind_speed"){const x=(m[0]+m[1])/2;m[0]=m[1]=x}const y=h!=null&&f!=null?[h,f]:null;if(e==="classified_arrow")if(h!=null&&f!=null&&c!=null){l=[];const x=(c.maxDataValue-c.minDataValue)/5;for(let C=0;C<6;C++)l.push(c.minDataValue+x*C)}else l=[0,1e-6,3.5,7,10.5,14];const d=o==="flow_to"==(e==="ocean_current_kn"||e==="ocean_current_m")?0:Math.PI,v=i==null?void 0:i.find(x=>x.type==="rotationInfo");return{breakValues:l,dataRange:y,inputUnit:s,outputUnit:n,symbolTileSize:a,symbolPercentRange:m,style:e||"single_arrow",rotation:d,rotationType:(g=this.rasterInfo.storageInfo)!=null&&g.tileInfo&&this.rasterInfo.dataType==="vector-uv"?"geographic":(v==null?void 0:v.rotationType)||t.rotationType,type:"vectorField"}}};b([P({json:{write:!0}})],ie.prototype,"rendererJSON",void 0),b([P({type:_n,json:{write:!0}})],ie.prototype,"rasterInfo",void 0),b([P({json:{write:!0}})],ie.prototype,"lookup",void 0),b([P()],ie.prototype,"canRenderInWebGL",void 0),ie=b([_("esri.renderers.support.RasterSymbolizer")],ie);const oa=ie;function ia(r){return r==="percentClip"||r==="histogramEqualization"}function aa(r){return r!=null&&r.length>0&&r[0].min!=null&&r[0].max!=null}function rn(r){return Zt(r)&&r.validPixelCount!==0}function la(r){return r.type==="algorithmic"&&["0,0,0,255","0,0,0"].includes(r.fromColor.join(","))&&["255,255,255,255","255,255,255"].includes(r.toColor.join(","))}function ua(r,t){if(r.spatialReference.equals(t))return r;const e=_s(r.spatialReference),s=_s(t);if(e===s)return r;const n=e/s;return{x:r.x*n,y:r.y*n}}async function Ec(r,t,e){if(e.type==="extent")return pa(r,t,e);const{width:s,height:n}=r,i=new Uint8Array(s*n),{contains:a,intersects:o}=await Pn(async()=>{const{contains:l,intersects:u}=await import("./geodesicLengthMeasurementUtils-DMAU1D8e.js").then(p=>p.g);return{contains:l,intersects:u}},__vite__mapDeps([2,3,4,5,1,6,7]));return o(t,e)?e.type==="polyline"?ha(r,t,e):a(e,t)?r:ca(r,t,e):new $({pixelType:r.pixelType,width:s,height:n,mask:i,maskIsAlpha:!1,pixels:[...r.pixels]})}function ca(r,t,e){if(!r)return r;const{width:s,height:n}=r,i=t.width/s,a=t.height/n,{xmin:o,ymax:l}=t;let u;if(e.type==="extent"){const d=(e.xmin-o)/i,v=(e.xmax-o)/i,w=(l-e.ymax)/a,T=(l-e.ymin)/a;u=[[[d,w],[d,T],[v,T],[v,w],[d,w]]]}else u=e.rings.map(d=>d.map(([v,w])=>[(v-o)/i,(l-w)/a]));const p=document.createElement("canvas");p.width=s,p.height=n;const c=p.getContext("2d");c.fillStyle="#f00",c.beginPath(),u.forEach(d=>{c.moveTo(d[0][0],d[0][1]);for(let v=0;v<d.length;v++)c.lineTo(d[v][0],d[v][1]);c.closePath()}),c.fill();const h=c.getImageData(0,0,s,n).data,f=r.mask,m=s*n,y=new Uint8Array(m);for(let d=0;d<m;d++)f&&!f[d]||(y[d]=h[4*d+3]>127?255:0);return new $({pixelType:r.pixelType,width:s,height:n,mask:y,maskIsAlpha:!1,pixels:[...r.pixels]})}function pa(r,t,e){const{width:s,height:n}=r,i=new Uint8Array(s*n),a=t.width/s,o=t.height/n;if(e.width/a<.5||e.height/o<.5)return new $({pixelType:r.pixelType,width:s,height:n,mask:i,pixels:[...r.pixels]});const{xmin:l,xmax:u,ymin:p,ymax:c}=t,{xmin:h,xmax:f,ymin:m,ymax:y}=e,d=Math.max(l,h),v=Math.min(u,f),w=Math.max(p,m),T=Math.min(c,y),g=.5*a,x=.5*o;if(v-d<g||T-w<x||v<l+g||d>u-g||w>c-x||T<p+x)return new $({pixelType:r.pixelType,width:s,height:n,mask:i,pixels:[...r.pixels]});const C=Math.max(0,(d-l)/a),k=Math.min(s,Math.max(0,(v-l)/a)),A=Math.max(0,(c-T)/o),S=Math.min(n,Math.max(0,(c-w)/o)),I=Math.round(C),R=Math.round(k)-1,N=Math.round(A),F=Math.round(S)-1;if(I===R&&C%1>.5&&k%1<.5||N===F&&A%1>.5&&S%1<.5)return new $({pixelType:r.pixelType,width:s,height:n,mask:i,pixels:[...r.pixels]});if(I===0&&N===0&&R===s&&F===n)return r;const E=r.mask;for(let M=N;M<=F;M++)for(let B=I;B<=R;B++){const L=M*s+B;i[L]=E?E[L]:255}return new $({pixelType:r.pixelType,width:s,height:n,mask:i,pixels:[...r.pixels]})}function ha(r,t,e){const{width:s,height:n}=r,i=new Uint8Array(s*n),a=t.width/s,o=t.height/n,{xmin:l,ymax:u}=t,{paths:p}=e,c=r.mask;for(let h=0;h<p.length;h++){const f=p[h];for(let m=0;m<f.length-1;m++){const[y,d]=f[m],[v,w]=f[m+1];let T=Math.floor((u-d)/o),g=Math.floor((u-w)/o);if(g<T){const C=T;T=g,g=C}T=Math.max(0,T),g=Math.min(n-1,g);const x=(v-y)/(w-d);for(let C=T;C<=g;C++){const k=C===T?Math.max(d,w):(n+1-C)*o,A=C===g?Math.min(d,w):k-o;let S=Math.floor(w===d?(y-l)/a:(x*(k-d)+y-l)/a),I=Math.floor(w===d?(v-l)/a:(x*(A-d)+y-l)/a);if(I<S){const N=S;S=I,I=N}const R=C*s;S=Math.max(0,S),I=Math.min(s-1,I);for(let N=R+S;N<=R+I;N++)i[N]=c?c[N]:255}}}return new $({pixelType:r.pixelType,width:s,height:n,mask:i,pixels:[...r.pixels]})}function fa(r,t){const{extent:e}=ma(r,t,new er({x:r.pixelSize.x,y:r.pixelSize.y,spatialReference:r.spatialReference})),{extent:s}=r.extent;if(e.xmax=Math.min(e.xmax,s.xmax),e.ymax=Math.min(e.ymax,s.ymax),e.xmin<e.xmax&&e.ymin<e.ymax){const{x:n,y:i}=r.pixelSize,a=Math.round(e.width/n),o=Math.round(e.height/i);r.extent=e,r.width=a,r.height=o}}function ma(r,t,e,s=!0){const{spatialReference:n}=r,{x:i,y:a}=ua(e,n);let o,l,u;const p=t.type==="extent"?t:t.extent;let{xmin:c,xmax:h,ymax:f,ymin:m}=p;const{xmin:y,ymax:d}=r.extent;return s?(c=y+(c>y?i*Math.round((c-y)/i):0),f=d-(f<d?a*Math.round((d-f)/a):0),h=y+(h>y?i*Math.round((h-y)/i):0),m=d-(m<d?a*Math.round((d-m)/a):0),o=new _t({xmin:c,ymax:f,xmax:h,ymin:m,spatialReference:n}),l=Math.round(o.width/i),u=Math.round(o.height/a)):(l=Math.floor((h-c)/i+.8),u=Math.floor((f-m)/a+.8),c=y+(c>y?i*Math.floor((c-y)/i+.1):0),f=d-(f<d?a*Math.floor((d-f)/a+.1):0),h=c+l*i,m=f-u*a,o=new _t({xmin:c,ymax:f,xmax:h,ymin:m,spatialReference:n})),{extent:o,width:l,height:u}}let hr=class extends Lt{constructor(){super(...arguments),this.raster=void 0}};b([P({json:{write:!0}})],hr.prototype,"raster",void 0),hr=b([_("esri.layers.support.rasterFunctions.BaseFunctionArguments")],hr);const at=hr;var jr;let Ne=jr=class extends at{constructor(){super(...arguments),this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new jr({raster:this.raster,raster2:this.raster2,operation:this.operation})}};b([P({json:{write:!0}})],Ne.prototype,"operation",void 0),b([P({json:{write:!0}})],Ne.prototype,"raster2",void 0),b([P({readOnly:!0})],Ne.prototype,"rasters",null),Ne=jr=b([_("esri.layers.support.rasterFunctions.ArithmeticFunctionArguments")],Ne);const da=Ne,ga=new Set(["slope","aspect","curvature","hillshade","shadedrelief","statistics"]);let lt=class extends Lt{constructor(){super(...arguments),this.functionArguments=null,this.readingBufferSize=0,this.id=-1,this.isNoopProcess=!1,this.rawInputBandIds=[],this.rawSourceRasterInfos=null,this.isInputBandIdsSwizzled=!1,this.swizzledBandSelection=[],this.isBranch=!1,this._bindingResult=null}get supportsGPU(){return this._bindingResult.supportsGPU}get flatWebGLFunctionChain(){var l;const t=this.getWebGLProcessorDefinition();if(!t)return null;const e=[t],{parameters:s}=t;let n=s.rasters||s.raster&&[s.raster];for(;n!=null&&n.length;){e.unshift(...n);const u=[];for(let p=0;p<n.length;p++){const{parameters:c}=n[p],h=c.rasters||c.raster&&[c.raster];h!=null&&h.length&&u.push(...h)}n=u}for(let u=e.length-1;u>=0;u--)e[u].isNoopProcess&&e.splice(u,1);let i=!1;for(let u=0;u<e.length;u++){const p=e[u];p.id=e.length-u-1;const{rasters:c}=p.parameters;i=i||c!=null&&c.length>1}const a=e.some(({name:u})=>ga.has(u.toLowerCase())),{rawSourceRasterInfos:o}=this;return{functions:e,hasBranches:i,hasFocalFunction:a,isSourceSingleBand:((l=o==null?void 0:o[0])==null?void 0:l.bandCount)===1}}bind(t,e=!1,s=-1){this.id=s+1;const n=this._getRasterValues();let i=!0;for(let a=0;a<n.length;a++){const o=n[a];if(o!=null&&this._isRasterFunctionValue(o)){const l=o.bind(t,e,this.id+a);if(!l.success)return this._bindingResult=l,l;i=i&&l.supportsGPU}}return!this.rasterInfo||e?(this.sourceRasterInfos=this._getSourceRasterInfos(t),this._bindingResult=this._bindSourceRasters(),this._bindingResult.success&&this._patchRasterInfo(),this._bindingResult.supportsGPU=i&&this._bindingResult.supportsGPU,this.processInputBandIds(),this._bindingResult):(this._bindingResult={success:!0,supportsGPU:!0},this.processInputBandIds(),this._bindingResult)}process(t){const e=this._getRasterValues(),s=e.length===0?t.pixelBlocks??t.primaryPixelBlocks:e.map(n=>this._readRasterValue(n,t));return this._processPixels({...t,pixelBlocks:s})}processInputBandIds(){const t=this._getRasterValues().filter(this._isRasterFunctionValue);let e;if(t.length>1){const i=t.map(o=>o.processInputBandIds()[0]);this.rawInputBandIds=i,this.isInputBandIdsSwizzled=this.rawInputBandIds.some((o,l)=>o!==l);const a=t.filter(o=>o.functionName==="ExtractBand");return a.length&&a.forEach((o,l)=>{o.isInputBandIdsSwizzled=!0,o.swizzledBandSelection=[l,l,l]}),this.rawInputBandIds}const s=t[0];if(s){if(e=s.processInputBandIds(),s.isInputBandIdsSwizzled)return this.rawInputBandIds=e,e}else{e=[];const{bandCount:i}=this.sourceRasterInfos[0];for(let a=0;a<i;a++)e.push(a)}const n=this._getInputBandIds(e);return this.isInputBandIdsSwizzled=n.some((i,a)=>i!==a),this.rawInputBandIds=n,this.rawInputBandIds}getPrimaryRasters(){const t=[],e=[];return this._getPrimaryRasters(this,t,e),{rasters:t,rasterIds:e}}getWebGLProcessorDefinition(){const t=this._getWebGLParameters(),{raster:e,rasters:s}=this.functionArguments;return s&&Array.isArray(s)&&s.length?(t.rasters=s.map(n=>this._isRasterFunctionValue(n)?n.getWebGLProcessorDefinition():typeof n=="number"?{name:"Constant",parameters:{value:n},pixelType:"f32",id:-1,isNoopProcess:!1}:{name:"Identity",parameters:{value:n},pixelType:"f32",id:-1,isNoopProcess:!1}),t.rasters.some(n=>n!=null)||(t.rasters=null)):this._isRasterFunctionValue(e)&&(t.raster=e.getWebGLProcessorDefinition()),{name:this.functionName,parameters:t,pixelType:this.outputPixelType,id:this.id,isNoopProcess:this.isNoopProcess}}getClippingGeometries(){const t=[];this.functionName==="Clip"&&t.push(this.functionArguments);const{raster:e,rasters:s}=this.functionArguments;if(s&&Array.isArray(s)&&s.length)s.forEach(n=>{if(this._isRasterFunctionValue(n)){const i=n.getClippingGeometries();t.push(...i)}});else if(this._isRasterFunctionValue(e)){const n=e.getClippingGeometries();t.push(...n)}return t}_getOutputPixelType(t){return this.outputPixelType==="unknown"?t:this.outputPixelType??t}_getWebGLParameters(){return{}}_getInputBandIds(t){return t}_removeStatsHistColormapVAT(t){var e;t.statistics=null,t.histograms=null,t.colormap=null,t.attributeTable=null,(e=t.multidimensionalInfo)==null||e.variables.forEach(s=>{s.statistics=void 0,s.histograms=void 0})}_getRasterValues(){const{rasterArgumentNames:t}=this;return t[0]==="rasters"?this.functionArguments.rasters??[]:t.flatMap(e=>this.functionArguments[e])}_getSourceRasterInfos(t){const e=this._getRasterValues(),{rasterInfos:s,rasterIds:n}=t;if(e.length===0)return s;const i=e.map(o=>o&&typeof o=="object"&&"bind"in o&&o.rasterInfo?o.rasterInfo:typeof o=="string"&&n.includes(o)?s[n.indexOf(o)]:typeof o!="number"?s[0]:void 0),a=i.find(o=>o)??s[0];return i.forEach((o,l)=>{o===void 0&&(i[l]=a)}),i}_getPrimaryRasterId(t){return t==null?void 0:t.rasterId}_getPrimaryRasters(t,e=[],s=[]){for(let n=0;n<t.sourceRasters.length;n++){const i=t.sourceRasters[n];if(typeof i!="number")if("bind"in i)this._getPrimaryRasters(i,e,s);else{const a=i,o=this._getPrimaryRasterId(a);if(o==null)continue;s.includes(o)||(this.mainPrimaryRasterId===o?(e.unshift(a),s.unshift(o)):(e.push(a),s.push(o)))}}}_isRasterFunctionValue(t){return t!=null&&typeof t=="object"&&"getWebGLProcessorDefinition"in t}_readRasterValue(t,e){const{primaryPixelBlocks:s}=e;if(t==null||t==="$$"){const n=s[0];return n==null?null:n.clone()}if(typeof t=="string"){const n=e.primaryRasterIds.indexOf(t);return n===-1?null:s[n]}if(typeof t=="number"){const n=s[0];if(n==null)return null;const{width:i,height:a,pixelType:o}=n,l=new Float32Array(i*a);l.fill(t);const u=this.sourceRasterInfos[0].bandCount,p=new Array(u).fill(l);return new $({width:i,height:a,pixelType:o,pixels:p})}return t.process(e)}_patchRasterInfo(){const{rasterInfo:t}=this;if(!(t!=null&&t.keyProperties))return;const{bandCount:e,keyProperties:s,statistics:n,histograms:i}=t,a=s.BandProperties;a&&a.length!==e&&(t.keyProperties={...s,BandProperties:void 0}),n&&n.length!==e&&(t.statistics=n.length>e?n.slice(0,e):null),i&&i.length!==e&&(t.histograms=i.length>e?i.slice(0,e):null),s.BAND_COUNT&&Number(s.BAND_COUNT)!==e&&(t.keyProperties={...s,BAND_COUNT:typeof s.BAND_COUNT=="string"?String(e):e})}};b([P({json:{write:!0}})],lt.prototype,"functionName",void 0),b([P({json:{write:!0}})],lt.prototype,"functionArguments",void 0),b([P()],lt.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}}),In(r=>r==null?void 0:r.toLowerCase())],lt.prototype,"outputPixelType",void 0),b([P({json:{write:!0}})],lt.prototype,"mainPrimaryRasterId",void 0),b([P()],lt.prototype,"sourceRasters",void 0),b([P({type:[_n],json:{write:!0}})],lt.prototype,"sourceRasterInfos",void 0),b([P({json:{write:!0}})],lt.prototype,"rasterInfo",void 0),b([P({json:{write:!0}})],lt.prototype,"readingBufferSize",void 0),b([P({json:{write:!0}})],lt.prototype,"id",void 0),b([P()],lt.prototype,"isNoopProcess",void 0),b([P()],lt.prototype,"supportsGPU",null),b([P()],lt.prototype,"rawInputBandIds",void 0),b([P()],lt.prototype,"rawSourceRasterInfos",void 0),b([P()],lt.prototype,"isInputBandIdsSwizzled",void 0),b([P()],lt.prototype,"swizzledBandSelection",void 0),b([P()],lt.prototype,"isBranch",void 0),b([P({readOnly:!0})],lt.prototype,"flatWebGLFunctionChain",null),b([P()],lt.prototype,"_bindingResult",void 0),lt=b([_("esri.layers.support.rasterFunctions.BaseRasterFunction")],lt);const it=lt,X={userDefined:-1,lineDetectionHorizontal:0,lineDetectionVertical:1,lineDetectionLeftDiagonal:2,lineDetectionRightDiagonal:3,gradientNorth:4,gradientWest:5,gradientEast:6,gradientSouth:7,gradientNorthEast:8,gradientNorthWest:9,smoothArithmeticMean:10,smoothing3x3:11,smoothing5x5:12,sharpening3x3:13,sharpening5x5:14,laplacian3x3:15,laplacian5x5:16,sobelHorizontal:17,sobelVertical:18,sharpen:19,sharpen2:20,pointSpread:21,none:255},ya={plus:1,minus:2,times:3,sqrt:4,power:5,abs:10,divide:23,exp:25,exp10:26,exp2:27,int:30,float:32,ln:35,log10:36,log2:37,mod:44,negate:45,roundDown:48,roundUp:49,square:53,floatDivide:64,floorDivide:65},vt={bitwiseAnd:11,bitwiseLeftShift:12,bitwiseNot:13,bitwiseOr:14,bitwiseRightShift:15,bitwiseXOr:16,booleanAnd:17,booleanNot:18,booleanOr:19,booleanXOr:20,equalTo:24,greaterThan:28,greaterThanEqual:29,lessThan:33,lessThanEqual:34,isNull:31,notEqual:46},Ft={acos:6,asin:7,atan:8,atanh:9,cos:21,cosh:22,sin:51,sinh:52,tan:56,tanh:57,acosh:59,asinh:60,atan2:61},wa={majority:38,max:39,mean:40,med:41,min:42,minority:43,range:47,stddev:54,sum:55,variety:58,majorityIgnoreNoData:66,maxIgnoreNoData:67,meanIgnoreNoData:68,medIgnoreNoData:69,minIgnoreNoData:70,minorityIgnoreNoData:71,rangeIgnoreNoData:72,stddevIgnoreNoData:73,sumIgnoreNoData:74,varietyIgnoreNoData:75},ro={setNull:50,conditional:78},sn={...ya,...vt,...Ft,...wa,...ro},so=new Map([[Ft.acos,{domain:[0,Math.PI],isInteger:!1}],[Ft.asin,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[Ft.atan,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[Ft.cos,{domain:[-1,1],isInteger:!1}],[Ft.sin,{domain:[-1,1],isInteger:!1}],[vt.booleanAnd,{domain:[0,1],isInteger:!0}],[vt.booleanNot,{domain:[0,1],isInteger:!0}],[vt.booleanOr,{domain:[0,1],isInteger:!0}],[vt.booleanXOr,{domain:[0,1],isInteger:!0}],[vt.equalTo,{domain:[0,1],isInteger:!0}],[vt.notEqual,{domain:[0,1],isInteger:!0}],[vt.greaterThan,{domain:[0,1],isInteger:!0}],[vt.greaterThanEqual,{domain:[0,1],isInteger:!0}],[vt.lessThan,{domain:[0,1],isInteger:!0}],[vt.lessThanEqual,{domain:[0,1],isInteger:!0}],[vt.isNull,{domain:[0,1],isInteger:!0}]]);function nn(r){return so.get(r)}const on=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function ba(r,t=!1){const e=r.map(o=>o.mask),s=e.filter(o=>o!=null),n=r[0].pixels[0].length;if(s.length===0||t&&s.length!==e.length)return new Uint8Array(n).fill(255);const i=s[0],a=new Uint8Array(i);if(s.length===1)return a;if(!t){for(let o=1;o<s.length;o++){const l=s[o];for(let u=0;u<a.length;u++)a[u]&&(a[u]=l[u]?255:0)}return a}for(let o=1;o<s.length;o++){const l=s[o];for(let u=0;u<a.length;u++)a[u]===0&&(a[u]=l[u]?255:0)}return a}function va(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]+n[o]);return a}function xa(r,t,e){const[s]=r,n=s.length,i=$.createEmptyBand("f32",n);return i.set(s),i}function Ca(r,t,e){const[s]=r,n=s.length,i=$.createEmptyBand(e,n);for(let a=0;a<n;a++)t&&!t[a]||(i[a]=s[a]*s[a]);return i}function Aa(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]-n[o]);return a}function Ta(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]*n[o]);return a}function Sa(r,t,e){const[s]=r,n=s.length,i=$.createEmptyBand(e,n);for(let a=0;a<n;a++)t&&!t[a]||(i[a]=Math.sign(s[a])*Math.floor(Math.abs(s[a])));return i}function no(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]/n[o]);return a}function ka(r,t,e){return no(r,t,"f32")}function Pa(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=Math.floor(s[o]/n[o]));return a}function Ia(r,t,e,s){const n=r[0],i=n.length,a=$.createEmptyBand(e,i);if(s===Ft.atanh){for(let l=0;l<i;l++)if(t[l]){const u=n[l];Math.abs(u)>=1?t[l]=0:a[l]=Math.atanh(u)}return a}const o=s===Ft.asin?Math.asin:Math.acos;for(let l=0;l<i;l++)if(t[l]){const u=n[l];Math.abs(u)>1?t[l]=0:a[l]=o(u)}return a}function Ra(r,t,e,s){const[n]=r,i=n.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s(n[o]));return a}function Na(r,t,e,s){const[n,i]=r,a=n.length,o=$.createEmptyBand(e,a);for(let l=0;l<a;l++)t&&!t[l]||(o[l]=s(n[l],i[l]));return o}function Fa(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]&n[o]);return a}function $a(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]<<n[o]);return a}function Ma(r,t,e){const[s]=r,n=s.length,i=$.createEmptyBand(e,n);for(let a=0;a<n;a++)t&&!t[a]||(i[a]=~s[a]);return i}function Ea(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]|n[o]);return a}function Oa(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]>>n[o]);return a}function Ba(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]^n[o]);return a}function Da(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]&&n[o]?1:0);return a}function Ga(r,t,e){const[s]=r,n=s.length,i=$.createEmptyBand(e,n);for(let a=0;a<n;a++)t&&!t[a]||(i[a]=s[a]?0:1);return i}function _a(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]||n[o]?1:0);return a}function La(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=(s[o]?1:0)^(n[o]?1:0));return a}function Ua(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]===n[o]?1:0);return a}function $s(r,t,e,s){const[n]=r,i=n.length,a=$.createEmptyBand(e,i),o=s===Math.E;for(let l=0;l<i;l++)t&&!t[l]||(a[l]=o?Math.exp(n[l]):s**n[l]);return a}function ja(r,t,e){return $s(r,t,e,10)}function za(r,t,e){return $s(r,t,e,2)}function Va(r,t,e){return $s(r,t,e,Math.E)}function Ms(r,t,e,s){const[n]=r,i=n.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(n[o]<=0?t[o]=0:a[o]=s(n[o]));return a}function Wa(r,t,e){return Ms(r,t,e,Math.log10)}function Ha(r,t,e){return Ms(r,t,e,Math.log2)}function Ja(r,t,e){return Ms(r,t,e,Math.log)}function qa(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]>n[o]?1:0);return a}function Ka(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]>=n[o]?1:0);return a}function Ya(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]<n[o]?1:0);return a}function Xa(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]<=n[o]?1:0);return a}function Za(r,t,e){const[s]=r,n=s.length,i=$.createEmptyBand(e,n);if(!t)return i;for(let a=0;a<n;a++)i[a]=t[a]?0:1;return i}function Qa(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]%n[o]);return a}function tl(r,t,e){const[s]=r,n=s.length,i=$.createEmptyBand(e,n);for(let a=0;a<n;a++)t&&!t[a]||(i[a]=-s[a]);return i}function el(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]===n[o]?0:1);return a}function rl(r,t,e){const[s,n]=r,i=s.length,a=$.createEmptyBand(e,i),o=new Uint8Array(i);for(let l=0;l<i;l++)t!=null&&!t[l]||s[l]!==0||(a[l]=n[l],o[l]=255);return{band:a,mask:o}}function an(r,t,e){const[s,n,i]=r,a=s.length,o=$.createEmptyBand(e,a);for(let l=0;l<a;l++)t&&!t[l]||(o[l]=s[l]?n[l]:i[l]);return o}function ln(r,t,e){const s=r.length;if(s<2)return r[0];const[n]=r,i=n.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)if(!t||t[o]){let l=n[o];for(let u=1;u<s;u++){const p=r[u][o];l<p&&(l=p)}a[o]=l}return a}function un(r,t,e){const s=r.length;if(s<2)return r[0];const[n]=r,i=n.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)if(!t||t[o]){let l=n[o];for(let u=1;u<s;u++){const p=r[u][o];l>p&&(l=p)}a[o]=l}return a}function cn(r,t,e){const s=r.length;if(s<2)return r[0];const[n]=r,i=n.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)if(!t||t[o]){let l=n[o],u=l;for(let p=1;p<s;p++){const c=r[p][o];u<c?u=c:l>c&&(l=c)}a[o]=u-l}return a}function pn(r,t,e){const s=r.length;if(s<2)return r[0];const[n]=r,i=n.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)if(!t||t[o]){let l=0;for(let u=0;u<s;u++)l+=r[u][o];a[o]=l/s}return a}function hn(r,t,e){const s=r.length;if(s<2)return r[0];const[n]=r,i=n.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)if(!t||t[o])for(let l=0;l<s;l++){const u=r[l];a[o]+=u[o]}return a}function fn(r,t,e){const s=r.length;if(s<2)return r[0];const[n]=r,i=n.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)if(!t||t[o]){const l=new Float32Array(s);let u=0;for(let c=0;c<s;c++){const h=r[c];u+=h[o],l[c]=h[o]}u/=s;let p=0;for(let c=0;c<s;c++)p+=(l[c]-u)**2;a[o]=Math.sqrt(p/s)}return a}function mn(r,t,e){const s=r.length;if(s<2)return r[0];const n=Math.floor(s/2),[i]=r,a=i.length,o=$.createEmptyBand(e,a),l=new Float32Array(s),u=s%2==1;for(let p=0;p<a;p++)if(!t||t[p]){for(let c=0;c<s;c++)l[c]=r[c][p];l.sort(),o[p]=u?l[n]:(l[n]+l[n-1])/2}return o}function oo(r,t,e){const[s,n]=r;if(n==null)return s;const i=s.length,a=$.createEmptyBand(e,i);for(let o=0;o<i;o++)t&&!t[o]||(a[o]=s[o]<n[o]?s[o]:n[o]);return a}function dn(r,t,e){const s=r.length;if(s<=2)return oo(r,t,e);const n=r[0].length,i=$.createEmptyBand(e,n),a=new Map;for(let o=0;o<n;o++)if(!t||t[o]){a.clear();for(let c=0;c<s;c++){const h=r[c][o];a.set(h,a.has(h)?a.get(h)+1:1)}let l=0,u=0;const p=[];for(const c of a.keys())l=a.get(c),l>u?(u=l,p.length=0,p.push(c)):l===u&&p.push(c);p.length>1&&p.sort((c,h)=>c-h),i[o]=p[0]}return i}function gn(r,t,e){const s=r.length;if(s<=2)return oo(r,t,e);const n=r[0].length,i=$.createEmptyBand(e,n),a=new Map;for(let o=0;o<n;o++)if(!t||t[o]){a.clear();for(let c=0;c<s;c++){const h=r[c][o];a.set(h,a.has(h)?a.get(h)+1:1)}let l=0,u=r.length;const p=[];for(const c of a.keys())l=a.get(c),l<u?(u=l,p.length=0,p.push(c)):l===u&&p.push(c);p.length>1&&p.sort((c,h)=>c-h),i[o]=p[0]}return i}function yn(r,t,e){const s=r.length;if(s<2)return r[0];const[n]=r,i=n.length,a=$.createEmptyBand(e,i),o=new Set;for(let l=0;l<i;l++)if(!t||t[l]){let u;o.clear();for(let p=0;p<s;p++)u=r[p][l],o.add(u);a[l]=o.size}return a}const ut=new Map,br=new Map,Y=new Map,ot=new Map;function sl(){ut.size||(ut.set(4,Math.sqrt),ut.set(6,Math.acos),ut.set(7,Math.asin),ut.set(8,Math.atan),ut.set(9,Math.atanh),ut.set(10,Math.abs),ut.set(21,Math.cos),ut.set(22,Math.cosh),ut.set(48,Math.floor),ut.set(49,Math.ceil),ut.set(51,Math.sin),ut.set(52,Math.sinh),ut.set(56,Math.tan),ut.set(57,Math.tanh),ut.set(59,Math.acosh),ut.set(60,Math.asinh),ut.set(65,Math.floor),br.set(5,Math.pow),br.set(61,Math.atan2),Y.set(1,va),Y.set(2,Aa),Y.set(3,Ta),Y.set(11,Fa),Y.set(12,$a),Y.set(13,Ma),Y.set(14,Ea),Y.set(15,Oa),Y.set(16,Ba),Y.set(17,Da),Y.set(18,Ga),Y.set(19,_a),Y.set(20,La),Y.set(23,no),Y.set(24,Ua),Y.set(25,Va),Y.set(26,ja),Y.set(27,za),Y.set(28,qa),Y.set(29,Ka),Y.set(30,Sa),Y.set(31,Za),Y.set(32,xa),Y.set(33,Ya),Y.set(34,Xa),Y.set(35,Ja),Y.set(36,Wa),Y.set(37,Ha),Y.set(44,Qa),Y.set(45,tl),Y.set(46,el),Y.set(53,Ca),Y.set(64,ka),Y.set(65,Pa),Y.set(76,an),Y.set(78,an),ot.set(38,dn),ot.set(39,ln),ot.set(40,pn),ot.set(41,mn),ot.set(42,un),ot.set(43,gn),ot.set(47,cn),ot.set(54,fn),ot.set(55,hn),ot.set(58,yn),ot.set(66,dn),ot.set(67,ln),ot.set(68,pn),ot.set(69,mn),ot.set(70,un),ot.set(71,gn),ot.set(72,cn),ot.set(73,fn),ot.set(74,hn),ot.set(75,yn))}function io(r,t,e={}){sl();let s=ba(r,t>=66&&t<=75);const{outputPixelType:n="f32"}=e,i=!ot.has(t)||e.processAsMultiband,a=i?r[0].pixels.length:1,o=[];for(let u=0;u<a;u++){const p=ot.has(t)&&!i?r.flatMap(f=>f.pixels):r.map(f=>f.pixels[u]);let c,h=!0;if(t===ro.setNull){const f=rl(p,s,n);c=f.band,s=f.mask,h=!1}else Y.has(t)?c=Y.get(t)(p,s,"f64"):ut.has(t)?c=t===Ft.asin||t===Ft.acos||t===Ft.atanh?Ia(p,s,"f64",t):Ra(p,s,"f64",ut.get(t)):br.has(t)?c=Na(p,s,"f64",br.get(t)):ot.has(t)?c=ot.get(t)(p,s,"f64"):(c=p[0],h=!1);if(h&&t!==vt.isNull&&!so.has(t)){const f=$.createEmptyBand(n,c.length);s||(s=new Uint8Array(c.length).fill(255)),To(c,s),Nn(c,s,n,f),c=f}o.push(c)}const l=r[0];return new $({width:l.width,height:l.height,pixelType:n,mask:t===vt.isNull?null:s,pixels:o})}function nl(r,t,e){return io(r,t=[null,1,2,3,23,5,44][t]??1,{outputPixelType:e})}let Fe=class extends it{constructor(){super(...arguments),this.functionName="Arithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster","raster2"]}_bindSourceRasters(){const{operation:t}=this.functionArguments;if(t<1||t>6)return{success:!1,supportsGPU:!1,error:"unsupported operation"};const e=this.sourceRasterInfos[0].clone();return this.outputPixelType=this._getOutputPixelType(e.pixelType),e.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(e),this.rasterInfo=e,{success:!0,supportsGPU:e.bandCount<=3}}_processPixels(t){const{pixelBlocks:e}=t;return(e==null?void 0:e[0])==null||(e==null?void 0:e[1])==null?null:nl(e,this.functionArguments.operation,this.outputPixelType)}_getWebGLParameters(){const{operation:t}=this.functionArguments,e=["","plus","minus","times","divide","power","mod"][t],s=this.outputPixelType??"f32";let[n,i]=Qt(s);const a=yt(s);return a&&(n-=1e-4,i+=1e-4),{imageCount:2,operationName:e,domainRange:[n,i],isOutputRounded:a}}};b([P({json:{write:!0,name:"rasterFunction"}})],Fe.prototype,"functionName",void 0),b([P({type:da,json:{write:!0,name:"rasterFunctionArguments"}})],Fe.prototype,"functionArguments",void 0),b([P()],Fe.prototype,"rasterArgumentNames",void 0),Fe=b([_("esri.layers.support.rasterFunctions.ArithmeticFunction")],Fe);const ol=Fe;var zr;let Vr=zr=class extends at{clone(){return new zr({raster:this.raster})}};Vr=zr=b([_("esri.layers.support.rasterFunctions.AspectFunctionArguments")],Vr);const il=Vr;let ae=class extends it{constructor(){super(...arguments),this.functionName="Aspect",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){var s;const t=this.sourceRasterInfos[0];this.isGCS=((s=t.spatialReference)==null?void 0:s.isGeographic)??!1,this.outputPixelType=this._getOutputPixelType("f32");const e=t.clone();return e.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(e),e.statistics=[{min:-1,max:360,avg:180,stddev:30}],e.bandCount=1,this.rasterInfo=e,{success:!0,supportsGPU:!0}}_processPixels(t){var o;const e=(o=t.pixelBlocks)==null?void 0:o[0];if(e==null)return null;const{extent:s,primaryPixelSizes:n}=t,i=n==null?void 0:n[0],a=i??(s?{x:s.width/e.width,y:s.height/e.height}:{x:1,y:1});return sa(e,{resolution:a})}};b([P({json:{write:!0,name:"rasterFunction"}})],ae.prototype,"functionName",void 0),b([P({type:il,json:{write:!0,name:"rasterFunctionArguments"}})],ae.prototype,"functionArguments",void 0),b([P()],ae.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],ae.prototype,"isGCS",void 0),ae=b([_("esri.layers.support.rasterFunctions.AspectFunction")],ae);const al=ae,ll=new Set(["+","-","*","/","(",")"]);function ul(r,t){(r=r.replaceAll(" ","")).startsWith("-")&&(r="0"+r),r.startsWith("+")&&(r=r.slice(1));const e=r.split(""),s=[],n=[];let i="";for(let a=0;a<e.length;a++){const o=e[a];ll.has(o)?(i.length&&n.push(wn(i,t)),s.push(o),i=""):i=i.concat(o)}return i.length&&n.push(wn(i,t)),{ops:s,nums:n}}function wn(r,t){return r.toLowerCase().startsWith("b")?t[parseInt(r.slice(1),10)-1]:parseFloat(r)}function cl(r,t,e,s){if(typeof e=="number"&&typeof s=="number")return e+s;let n,i,a;typeof e=="number"?(a=s,n=a.length,i=new Float32Array(n),i.fill(e)):(n=e.length,i=e,s.constructor===Number?(a=new Float32Array(n),a.fill(s)):a=s);const o=new Float32Array(n);switch(t){case"+":for(let l=0;l<n;l++)(r==null||r[l])&&(o[l]=i[l]+a[l]);break;case"-":for(let l=0;l<n;l++)(r==null||r[l])&&(o[l]=i[l]-a[l]);break;case"*":for(let l=0;l<n;l++)(r==null||r[l])&&(o[l]=i[l]*a[l]);break;case"/":for(let l=0;l<n;l++)(r==null||r[l])&&a[l]&&(o[l]=i[l]/a[l]);break;case"(":case")":throw new Error("encountered error with custom band index equation")}return o}function pl(r,t){r.splice(t,1);let e=0,s=0;do{e=0,s=0;for(let n=0;n<r.length;n++)if(r[n]==="(")e=n;else if(r[n]===")"){s=n;break}s===e+1&&r.splice(e,2)}while(s===e+1);return r}function hl(r){if(r.length===1)return{opIndex:0,numIndex:0};let t=0,e=0;for(let a=0;a<r.length;a++)if(r[a]==="(")t=a;else if(r[a]===")"){e=a;break}const s=e===0?r:r.slice(t+1,e);let n=-1;for(let a=0;a<s.length;a++)if(s[a]==="*"||s[a]==="/"){n=a;break}if(n>-1)e>0&&(n+=t+1);else{for(let a=0;a<s.length;a++)if(s[a]==="+"||s[a]==="-"){n=a;break}e>0&&(n+=t+1)}let i=0;for(let a=0;a<n;a++)r[a]==="("&&i++;return{opIndex:n,numIndex:n-i}}function fl(r,t,e){let s,{ops:n,nums:i}=ul(e,t);if(n.length===0){const a=i.length===1?i[0]:t[0];if(a instanceof Float32Array)return[a];const o=new Float32Array(t[0].length);return typeof a=="number"?o.fill(a):o.set(a),[o]}for(;n.length>0;){const{numIndex:a,opIndex:o}=hl(n);if(s=cl(r,n[o],i[a],i[a+1]),n.length===1)break;n=pl(n,o),i.splice(a,2,s)}return[s]}const ml=new kt({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function dl(r,t){if(!Zt(r))return r;const{equation:e,method:s}=t,n=t.bandIndexes.map(h=>h-1),{pixels:i,mask:a}=r;let o;switch(s){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":o=bn(a,i[n[0]],i[n[1]]);break;case"ndwi":o=bn(a,i[n[1]],i[n[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":o=yl(a,i[n[0]],i[n[1]]);break;case"ci-g":case"ci-re":o=wl(a,i[n[0]],i[n[1]]);break;case"savi":o=bl(a,i[n[0]],i[n[1]],n[2]+1);break;case"tsavi":o=vl(a,i[n[0]],i[n[1]],n[2]+1,n[3]+1,n[4]+1);break;case"msavi":o=xl(a,i[n[0]],i[n[1]]);break;case"gemi":o=Cl(a,i[n[0]],i[n[1]]);break;case"pvi":o=Al(a,i[n[0]],i[n[1]],n[2]+1,n[3]+1);break;case"gvitm":o=Tl(a,[i[n[0]],i[n[1]],i[n[2]],i[n[3]],i[n[4]],i[n[5]]]);break;case"sultan":o=Sl(a,[i[n[0]],i[n[1]],i[n[2]],i[n[3]],i[n[4]]]);break;case"vari":o=kl(a,[i[n[0]],i[n[1]],i[n[2]]]);break;case"mtvi2":o=Pl(a,[i[n[0]],i[n[1]],i[n[2]]]);break;case"rtvi-core":o=Il(a,[i[n[0]],i[n[1]],i[n[2]]]);break;case"evi":o=Rl(a,[i[n[0]],i[n[1]],i[n[2]]]);break;case"wndwi":o=Nl(a,[i[n[0]],i[n[1]],i[n[2]]],n[3]?n[3]+1:.5);break;case"bai":o=Fl(a,i[n[0]],i[n[1]]);break;case"custom":o=fl(a,i,e);break;default:return r}const{outputPixelType:l="f32"}=t,u=l!=null&&yt(l);let p;a?(p=new Uint8Array(r.width*r.height),p.set(a)):u&&(p=new Uint8Array(r.width*r.height).fill(255)),u&&(o=o.map(h=>{const f=$.createEmptyBand(l,h.length);return Nn(h,p,l,f),f}));const c=new $({width:r.width,height:r.height,pixelType:l,pixels:o,mask:p});return c.updateStatistics(),c}function gl(r,t,e,s){const{mask:n,pixels:i,width:a,height:o}=r,l=i[e],u=i[t],p=u.length,c=s?new Uint8Array(p):new Float32Array(p),h=s?100:1,f=s?100.5:0;for(let y=0;y<p;y++)if(n==null||n[y]){const d=l[y],v=u[y],w=d+v;w&&(c[y]=(d-v)/w*h+f)}const m=new $({width:a,height:o,mask:n,pixelType:s?"u8":"f32",pixels:[c]});return m.updateStatistics(),m}function pt(r){const t=new Float32Array(9);return t[3*r[0]]=1,t[3*r[1]+1]=1,t[3*r[2]+2]=1,t}function bn(r,t,e){const s=e.length,n=new Float32Array(s);for(let i=0;i<s;i++)if(r==null||r[i]){const a=t[i],o=e[i],l=a+o;l&&(n[i]=(a-o)/l)}return[n]}function yl(r,t,e){const s=e.length,n=new Float32Array(s);for(let i=0;i<s;i++)if(r==null||r[i]){const a=t[i],o=e[i];o&&(n[i]=a/o)}return[n]}function wl(r,t,e){const s=t.length,n=new Float32Array(s);for(let i=0;i<s;i++)if(r==null||r[i]){const a=t[i],o=e[i];o&&(n[i]=a/o-1)}return[n]}function bl(r,t,e,s){const n=e.length,i=new Float32Array(n);for(let a=0;a<n;a++)if(r==null||r[a]){const o=e[a],l=t[a],u=l+o+s;u&&(i[a]=(l-o)/u*(1+s))}return[i]}function vl(r,t,e,s,n,i){const a=e.length,o=new Float32Array(a),l=-n*s+i*(1+s*s);for(let u=0;u<a;u++)if(r==null||r[u]){const p=e[u],c=t[u],h=n*c+p+l;h&&(o[u]=s*(c-s*p-n)/h)}return[o]}function xl(r,t,e){const s=e.length,n=new Float32Array(s);for(let i=0;i<s;i++)if(r==null||r[i]){const a=e[i],o=t[i],l=2*o+1;n[i]=.5*(l-Math.sqrt(l*l-8*(o-a)))}return[n]}function Cl(r,t,e){const s=e.length,n=new Float32Array(s);for(let i=0;i<s;i++)if(r==null||r[i]){const a=e[i],o=t[i];if(a!==1&&o+a+.5!==0){const l=(2*(o*o-a*a)+1.5*o+.5*a)/(o+a+.5);n[i]=l*(1-.25*l)-(a-.125)/(1-a)}}return[n]}function Al(r,t,e,s,n){const i=e.length,a=new Float32Array(i),o=1/Math.sqrt(1+s*s);for(let l=0;l<i;l++)if(r==null||r[l]){const u=e[l],p=t[l];a[l]=(p-s*u-n)*o}return[a]}function Tl(r,t){const[e,s,n,i,a,o]=t,l=e.length,u=new Float32Array(l);for(let p=0;p<l;p++)(r==null||r[p])&&(u[p]=-.2848*e[p]-.2435*s[p]-.5436*n[p]+.7243*i[p]+.084*a[p]-.18*o[p]);return[u]}function Sl(r,t){const[e,s,n,i,a]=t,o=e.length,l=new Float32Array(o),u=new Float32Array(o),p=new Float32Array(o);for(let c=0;c<o;c++)(r==null||r[c])&&(l[c]=a[c]?i[c]/a[c]*100:0,u[c]=e[c]?i[c]/e[c]*100:0,p[c]=n[c]?s[c]/n[c]*(i[c]/n[c])*100:0);return[l,u,p]}function kl(r,t){const[e,s,n]=t,i=e.length,a=new Float32Array(i);for(let o=0;o<i;o++)if(r==null||r[o])for(o=0;o<i;o++){const l=e[o],u=s[o],p=u+l-n[o];p&&(a[o]=(u-l)/p)}return[a]}function Pl(r,t){const[e,s,n]=t,i=e.length,a=new Float32Array(i);for(let o=0;o<i;o++)if(r==null||r[o])for(o=0;o<i;o++){const l=e[o],u=s[o],p=n[o],c=Math.sqrt((2*l+1)**2-(6*l-5*Math.sqrt(u))-.5);if(c){const h=1.5*(1.2*(l-p)-2.5*(u-p));a[o]=h/c}}return[a]}function Il(r,t){const[e,s,n]=t,i=e.length,a=new Float32Array(i);for(let o=0;o<i;o++)if(r==null||r[o])for(o=0;o<i;o++){const l=e[o],u=s[o],p=n[o];a[o]=100*(l-u)-10*(l-p)}return[a]}function Rl(r,t){const[e,s,n]=t,i=e.length,a=new Float32Array(i);for(let o=0;o<i;o++)if(r==null||r[o])for(o=0;o<i;o++){const l=e[o],u=s[o],p=l+6*u-7.5*n[o]+1;p&&(a[o]=2.5*(l-u)/p)}return[a]}function Nl(r,t,e=.5){const[s,n,i]=t,a=n.length,o=new Float32Array(a);for(let l=0;l<a;l++)if(r==null||r[l])for(l=0;l<a;l++){const u=s[l],p=n[l],c=i[l],h=u+e*p+(1-e)*c;h&&(o[l]=(u-e*p-(1-e)*c)/h)}return[o]}function Fl(r,t,e){const s=e.length,n=new Float32Array(s);for(let i=0;i<s;i++)if(r==null||r[i])for(i=0;i<s;i++){const a=(.1-t[i])**2+(.06-e[i])**2;a&&(n[i]=1/a)}return[n]}var Wr;let qe=Wr=class extends at{constructor(){super(...arguments),this.method="custom"}clone(){return new Wr({method:this.method,bandIndexes:this.bandIndexes,raster:Z(this.raster)})}};b([P({json:{type:String,write:!0}})],qe.prototype,"bandIndexes",void 0),b([At(ml)],qe.prototype,"method",void 0),qe=Wr=b([_("esri.layers.support.rasterFunctions.BandArithmeticFunctionArguments")],qe);const $l=qe,Ml=new Set(["vari","mtvi2","rtvi-core","evi"]);let $e=class extends it{constructor(){super(...arguments),this.functionName="BandArithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const t=this.sourceRasterInfos[0];if(t.bandCount<2)return{success:!1,supportsGPU:!1,error:"band-arithmetic-function: source raster has insufficient amount of raster bands"};const e=t.clone();return e.pixelType=this.outputPixelType,e.bandCount=this.functionArguments.method==="sultan"?3:1,this._removeStatsHistColormapVAT(e),e.keyProperties={...e.keyProperties,BandProperties:void 0},this.rasterInfo=e,{success:!0,supportsGPU:!["custom","gvitm","sultan"].includes(this.functionArguments.method)}}_processPixels(t){var a;const e=(a=t.pixelBlocks)==null?void 0:a[0];if(e==null)return e;const{method:s,bandIndexes:n}=this.functionArguments,i=n.split(" ").map(o=>parseFloat(o));return dl(e,{method:s,bandIndexes:i,equation:n,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const t=this.functionArguments.bandIndexes.split(" ").map(o=>parseFloat(o)-1);t.length===2&&t.push(0);const e=this.isInputBandIdsSwizzled?[0,1,2]:t;let s,n;const i=new Float32Array(3),{method:a}=this.functionArguments;switch(a){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":s=pt([e[0],e[1],0]),n="ndxi";break;case"ndwi":s=pt([e[1],e[0],0]),n="ndxi";break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":s=pt([e[0],e[1],0]),n="sr";break;case"ci-g":case"ci-re":s=pt([e[0],e[1],0]),n="ci";break;case"savi":s=pt([e[0],e[1],0]),n="savi",i[0]=t[2]+1;break;case"tsavi":s=pt([e[0],e[1],0]),n="tsavi",i[0]=t[2]+1,i[1]=t[3]+1,i[2]=t[4]+1;break;case"msavi":s=pt([e[0],e[1],0]),n="msavi";break;case"gemi":s=pt([e[0],e[1],0]),n="gemi";break;case"pvi":s=pt([e[0],e[1],0]),n="tsavi",i[0]=t[2]+1,i[1]=t[3]+1;break;case"vari":s=pt([e[0],e[1],e[2]]),n="vari";break;case"mtvi2":s=pt([e[0],e[1],e[2]]),n="mtvi";break;case"rtvi-core":s=pt([e[0],e[1],e[2]]),n="rtvicore";break;case"evi":s=pt([e[0],e[1],e[2]]),n="evi";break;case"wndwi":s=pt([e[0],e[1],0]),n="wndwi",i[0]=t[3]?t[3]+1:.5;break;case"bai":s=pt([e[1],e[0],0]),n="bai";break;default:s=pt([0,1,2]),n="custom"}return{bandIndexMat3:s,indexType:n,adjustments:i,isOutputRounded:yt(this.outputPixelType)}}_getInputBandIds(t){if(this.functionArguments.method==="custom")return t;const e=this.functionArguments.bandIndexes.split(" ").map(o=>parseFloat(o)-1),s=t.length,n=e.map(o=>o>=s?s-1:o),i=Ml.has(this.functionArguments.method)?3:2,a=n.slice(0,i).map(o=>t[o]);return a.length===2&&a.push(0),a}};b([P({json:{write:!0,name:"rasterFunction"}})],$e.prototype,"functionName",void 0),b([P({type:$l,json:{write:!0,name:"rasterFunctionArguments"}})],$e.prototype,"functionArguments",void 0),b([P()],$e.prototype,"rasterArgumentNames",void 0),$e=b([_("esri.layers.support.rasterFunctions.BandArithmeticFunction")],$e);const El=$e;var Hr;const vn=new kt({1:"outside",2:"inside"},{useNumericKeys:!0});let Ke=Hr=class extends at{constructor(){super(...arguments),this.clippingType="outside"}clone(){return new Hr({clippingGeometry:this.clippingGeometry.clone(),clippingType:this.clippingType})}};b([P({types:vo,json:{read:bo,write:!0}})],Ke.prototype,"clippingGeometry",void 0),b([P({json:{read:vn.read,write:vn.write}})],Ke.prototype,"clippingType",void 0),Ke=Hr=b([_("esri.layers.support.rasterFunctions.ClipFunctionArguments")],Ke);const Ol=Ke;let le=class extends it{constructor(){super(...arguments),this.functionName="Clip",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const t=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType,this.rasterInfo=t;const{functionArguments:e}=this,{clippingGeometry:s,clippingType:n}=e;if(!s)return{success:!1,supportsGPU:!1,error:"missing clipping geometry"};if(n==="outside")try{const{spatialReference:i}=t,a=s.type==="extent"?_o(s,i):Lo(s,i).extent;a&&fa(t,a)}catch{}return{success:!0,supportsGPU:!0}}_processPixels(t){var e;return(e=t.pixelBlocks)==null?void 0:e[0]}_getWebGLParameters(){const{clippingGeometry:t,clippingType:e}=this.functionArguments;return{clippingGeometry:t.toJSON(),clippingType:e}}};b([P({json:{write:!0,name:"rasterFunction"}})],le.prototype,"functionName",void 0),b([P({type:Ol,json:{write:!0,name:"rasterFunctionArguments"}})],le.prototype,"functionArguments",void 0),b([P()],le.prototype,"rasterArgumentNames",void 0),b([P()],le.prototype,"isNoopProcess",void 0),le=b([_("esri.layers.support.rasterFunctions.ClipFunction")],le);const Bl=le;var Jr;let Mt=Jr=class extends at{castColormapName(r){if(!r)return null;const t=r.toLowerCase();return Wo.includes(t)?t:null}readColorRamp(r){return Rn(r)}readColorRampName(r,t){if(!r)return null;const e=Yt.jsonValues.find(s=>s.toLowerCase()===r.toLowerCase());return e?Yt.fromJSON(e):null}clone(){var r;return new Jr({colormap:Z(this.colormap),colormapName:this.colormapName,colorRamp:(r=this.colorRamp)==null?void 0:r.clone(),colorRampName:this.colorRampName})}};b([P({type:[[Number]],json:{write:!0}})],Mt.prototype,"colormap",void 0),b([P({type:String,json:{write:!0}})],Mt.prototype,"colormapName",void 0),b([In("colormapName")],Mt.prototype,"castColormapName",null),b([P({types:xo,json:{write:!0}})],Mt.prototype,"colorRamp",void 0),b([Xt("colorRamp")],Mt.prototype,"readColorRamp",null),b([P({type:Yt.apiValues,json:{type:Yt.jsonValues,write:Yt.write}})],Mt.prototype,"colorRampName",void 0),b([Xt("colorRampName")],Mt.prototype,"readColorRampName",null),Mt=Jr=b([_("esri.layers.support.rasterFunctions.ColormapFunctionArguments")],Mt);const Dl=Mt,Gl=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[112,75,3],[113,76,3],[114,77,3],[115,77,3],[116,78,3],[117,79,3],[118,79,3],[119,80,3],[121,81,4],[122,82,4],[123,82,4],[124,83,4],[125,84,4],[126,84,4],[127,85,4],[128,86,4],[129,86,4],[130,87,4],[131,88,4],[132,89,4],[133,89,4],[134,90,4],[135,91,4],[136,91,4],[137,92,4],[138,93,4],[139,94,4],[140,94,4],[142,95,5],[143,96,5],[144,96,5],[145,97,5],[146,98,5],[147,99,5],[148,99,5],[149,100,5],[150,101,5],[151,101,5],[152,102,5],[153,103,5],[154,104,5],[155,104,5],[156,105,5],[157,106,5],[158,106,5],[159,107,5],[160,108,5],[161,108,5],[162,109,5],[164,110,6],[165,111,6],[166,111,6],[167,112,6],[168,113,6],[169,113,6],[170,114,6],[171,115,6],[172,116,6],[173,116,6],[174,117,6],[245,0,0],[245,5,0],[245,10,0],[246,15,0],[246,20,0],[246,25,0],[246,30,0],[247,35,0],[247,40,0],[247,45,0],[247,50,0],[247,55,0],[248,60,0],[248,65,0],[248,70,0],[248,75,0],[249,81,0],[249,86,0],[249,91,0],[249,96,0],[250,101,0],[250,106,0],[250,111,0],[250,116,0],[250,121,0],[251,126,0],[251,131,0],[251,136,0],[251,141,0],[252,146,0],[252,151,0],[252,156,0],[252,156,0],[251,159,0],[250,162,0],[249,165,0],[248,168,0],[247,171,0],[246,174,0],[245,177,0],[245,179,0],[244,182,0],[243,185,0],[242,188,0],[241,191,0],[240,194,0],[239,197,0],[238,200,0],[237,203,0],[236,206,0],[235,209,0],[234,212,0],[233,215,0],[232,218,0],[231,221,0],[230,224,0],[230,226,0],[229,229,0],[228,232,0],[227,235,0],[226,238,0],[225,241,0],[224,244,0],[223,247,0],[165,247,0],[163,244,0],[161,240,0],[158,237,0],[156,233,1],[154,230,1],[152,227,1],[149,223,1],[147,220,1],[145,216,1],[143,213,1],[140,210,2],[138,206,2],[136,203,2],[134,200,2],[132,196,2],[129,193,2],[127,189,2],[125,186,3],[123,183,3],[120,179,3],[118,176,3],[116,172,3],[114,169,3],[111,166,3],[109,162,4],[107,159,4],[105,155,4],[103,152,4],[100,149,4],[98,145,4],[96,142,4],[94,138,5],[91,135,5],[89,132,5],[87,128,5],[85,125,5],[82,121,5],[80,118,5],[78,115,6],[76,111,6],[73,108,6],[71,105,6],[69,101,6],[67,98,6],[65,94,6],[62,91,7],[60,88,7],[58,84,7],[56,81,7],[53,77,7],[51,74,7],[49,71,7],[47,67,8],[44,64,8],[42,60,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8]],_l=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[245,20,0],[245,24,0],[245,29,0],[245,31,0],[247,33,0],[247,33,0],[247,37,0],[247,41,0],[247,41,0],[247,41,0],[247,45,0],[247,45,0],[247,47,0],[247,49,0],[247,49,0],[247,54,0],[247,54,0],[247,56,0],[247,58,0],[247,58,0],[250,62,0],[250,62,0],[250,62,0],[250,67,0],[250,67,0],[250,67,0],[250,69,0],[250,71,0],[250,71,0],[250,75,0],[250,75,0],[250,78,0],[250,79,0],[250,79,0],[250,79,0],[250,81,0],[250,83,0],[250,83,0],[250,87,0],[250,87,0],[250,90,0],[250,92,0],[252,93,0],[252,93,0],[252,97,0],[252,97,0],[252,97,0],[252,97,0],[252,101,0],[252,101,0],[252,101,0],[252,101,0],[252,105,0],[252,105,0],[252,107,0],[252,109,0],[252,109,0],[252,113,13],[255,118,20],[255,119,23],[255,121,25],[255,126,33],[255,132,38],[255,133,40],[255,135,43],[255,141,48],[255,144,54],[255,150,59],[255,152,61],[255,153,64],[255,159,69],[255,163,77],[255,165,79],[255,168,82],[255,174,87],[255,176,92],[255,181,97],[255,183,99],[255,186,102],[255,191,107],[255,197,115],[255,201,120],[255,203,123],[255,205,125],[255,209,130],[255,214,138],[255,216,141],[255,218,143],[255,224,150],[255,228,156],[255,234,163],[255,236,165],[255,238,168],[255,243,173],[255,248,181],[255,252,186],[253,252,186],[250,252,187],[244,250,180],[238,247,176],[234,246,173],[231,245,169],[223,240,163],[217,237,157],[211,235,150],[205,233,146],[200,230,142],[195,227,136],[189,224,132],[184,222,126],[180,220,123],[174,217,119],[169,214,114],[163,212,108],[160,210,105],[154,207,101],[148,204,96],[143,201,93],[138,199,88],[134,197,84],[130,194,81],[126,191,77],[117,189,70],[115,186,68],[112,184,64],[106,181,60],[100,179,55],[94,176,49],[92,174,47],[90,173,45],[81,168,37],[75,166,33],[71,163,28],[66,160,24],[62,158,21],[56,156,14],[51,153,0],[51,153,0],[51,153,0],[50,150,0],[50,150,0],[50,150,0],[50,150,0],[49,148,0],[49,148,0],[49,148,0],[48,145,0],[48,145,0],[48,145,0],[48,145,0],[48,143,0],[48,143,0],[48,143,0],[48,143,0],[47,140,0],[47,140,0],[47,140,0],[47,140,0],[46,138,0],[46,138,0],[46,138,0],[46,138,0],[45,135,0],[45,135,0],[45,135,0],[45,135,0],[44,133,0],[44,133,0],[44,133,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[42,128,0],[42,128,0],[42,128,0],[42,125,0],[42,125,0],[42,125,0],[42,125,0],[41,122,0],[41,122,0],[41,122,0],[41,122,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[39,117,0],[39,117,0],[39,117,0],[39,117,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0]];function Es(r,t){const e=[],s=[];for(let i=0;i<r.length-1;i++)e.push({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:r[i].slice(1),toColor:r[i+1].slice(1)}),s.push(r[i+1][0]-r[i][0]);const n=r[r.length-1][0];return As({type:"multipart",colorRamps:e},{numColors:n,weights:t=t??s})}function Ll(){return Es([[0,0,191,191],[51,0,0,255],[102,255,0,255],[153,255,0,127],[204,191,63,127],[256,20,20,20]])}function Ul(){const r=Es([[0,255,255,255],[70,0,255,0],[80,205,173,193],[100,150,150,150],[110,120,51,100],[130,120,100,200],[140,28,3,144],[160,6,0,55],[180,10,25,30],[201,6,7,27]]);for(let t=r.length;t<256;t++)r.push([6,27,7]);return r}function jl(){return As({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:[0,0,0],toColor:[255,255,255]})}function zl(){const r=[];for(let t=0;t<256;t++){const e=[];for(let s=0;s<3;s++)e.push(Math.round(255*Math.random()));r.push(e)}return r}function Vl(){return Es([[0,38,41,54],[69,79,82,90],[131,156,156,156],[256,253,253,241]],[.268,.238,.495])}function Wl(r){let t;switch(r){case"elevation":t=Ll();break;case"gray":t=jl();break;case"hillshade":t=Vl();break;case"ndvi":t=Gl;break;case"ndvi2":t=Ul();break;case"ndvi3":t=_l;break;case"random":t=zl()}return t?(t=t.map((e,s)=>[s,...e]),t):null}let Bt=class extends it{constructor(){super(...arguments),this.functionName="Colormap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const t=this.sourceRasterInfos[0];if(t.bandCount>1)return{success:!1,supportsGPU:!1,error:"colormap-function: source data must be single band"};let{colormap:e,colormapName:s,colorRamp:n,colorRampName:i}=this.functionArguments;if(!(e!=null&&e.length))if(n)this.colorRamp=n,e=sr(n,{interpolateAlpha:!0});else if(i){const l=On(i);l&&(e=sr(l),this.colorRamp=Rn(l))}else s&&(e=Wl(s));if(!(e!=null&&e.length))return{success:!1,supportsGPU:!1,error:"colormap-function: missing colormap argument"};const a=this._getOutputPixelType(t.pixelType);this.outputPixelType=a.startsWith("f")?"s32":a;const o=t.clone();return o.pixelType=this.outputPixelType,o.colormap=e,o.bandCount=1,this.rasterInfo=o,{success:!0,supportsGPU:!0}}_processPixels(t){var s;let e=(s=t.pixelBlocks)==null?void 0:s[0];return!e||yt(e.pixelType)||(e=e.clone(),e.clamp(this.outputPixelType)),e}};b([P({json:{write:!0,name:"rasterFunction"}})],Bt.prototype,"functionName",void 0),b([P({type:Dl,json:{write:!0,name:"rasterFunctionArguments"}})],Bt.prototype,"functionArguments",void 0),b([P()],Bt.prototype,"rasterArgumentNames",void 0),b([P()],Bt.prototype,"isNoopProcess",void 0),b([P({json:{write:!0}})],Bt.prototype,"indexedColormap",void 0),b([P()],Bt.prototype,"colorRamp",void 0),Bt=b([_("esri.layers.support.rasterFunctions.ColormapFunction")],Bt);const Hl=Bt;var qr;let Kr=qr=class extends at{clone(){return new qr({raster:this.raster})}};Kr=qr=b([_("esri.layers.support.rasterFunctions.ColormapToRGBFunctionArguments")],Kr);const Jl=Kr;let ue=class extends it{constructor(){super(...arguments),this.functionName="ColormapToRGB",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){var a;const t=this.sourceRasterInfos[0];if(t.bandCount>1||!((a=t.colormap)!=null&&a.length))return{success:!1,supportsGPU:!1,error:"colormap-to-rgb-function: source data must be single band with a colormap"};const e=t.clone();e.pixelType=this.outputPixelType=this._getOutputPixelType("u8"),this._removeStatsHistColormapVAT(e),e.bandCount=3,e.statistics=[{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20}],this.rasterInfo=e;const s=[...t.colormap].sort((o,l)=>o[0]-l[0]),{indexedColormap:n,offset:i}=ke({colormap:s});return n?(this.lookup={indexedColormap:n,offset:i},{success:!0,supportsGPU:tr(n)}):{success:!1,supportsGPU:!1,error:"colormap-to-rgb-function: the colormap is not supported"}}_processPixels(t){var c;let e=(c=t.pixelBlocks)==null?void 0:c[0];if(!e||!this.lookup)return e;e=e.clone();const s=e.pixels[0],n=e.mask??new Uint8Array(s.length).fill(255),i=new Uint8Array(s.length),a=new Uint8Array(s.length),o=new Uint8Array(s.length),{indexedColormap:l,offset:u}=this.lookup,p=l.length;for(let h=0;h<s.length;h++)if(n[h]){let f=4*(s[h]-u);f<0||f>p-4?n[h]=0:(i[h]=l[f++],a[h]=l[f++],o[h]=l[f++])}return e.pixels=[i,a,o],e.statistics=[new je(0,255),new je(0,255),new je(0,255)],e.pixelType=this.outputPixelType,e}_getWebGLParameters(){return this.lookup}};b([P({json:{write:!0,name:"rasterFunction"}})],ue.prototype,"functionName",void 0),b([P({type:Jl,json:{write:!0,name:"rasterFunctionArguments"}})],ue.prototype,"functionArguments",void 0),b([P()],ue.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],ue.prototype,"lookup",void 0),ue=b([_("esri.layers.support.rasterFunctions.ColormapToRGBFunction")],ue);const ql=ue;var Yr;let Ye=Yr=class extends at{constructor(){super(...arguments),this.rasters=[]}writeRasters(r,t){t.rasters=r.map(e=>typeof e=="number"||typeof e=="string"?e:e.toJSON())}clone(){return new Yr({rasters:Z(this.rasters)})}};b([P({json:{write:!0}})],Ye.prototype,"rasters",void 0),b([Ie("rasters")],Ye.prototype,"writeRasters",null),Ye=Yr=b([_("esri.layers.support.rasterFunctions.CompositeBandFunctionArguments")],Ye);const Kl=Ye;let Me=class extends it{constructor(){super(...arguments),this.functionName="CompositeBand",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){const{sourceRasterInfos:t}=this,e=t[0];this.outputPixelType=this._getOutputPixelType(e.pixelType);const s=e.clone();if(s.attributeTable=null,s.colormap=null,s.pixelType=this.outputPixelType,s.bandCount=t.map(({bandCount:i})=>i).reduce((i,a)=>i+a),t.every(({statistics:i})=>i!=null&&i.length)){const i=[];t.forEach(({statistics:a})=>a!=null&&i.push(...a)),s.statistics=i}if(t.every(({histograms:i})=>i!=null&&i.length)){const i=[];t.forEach(({histograms:a})=>a!=null&&i.push(...a)),s.histograms=i}s.multidimensionalInfo&&s.multidimensionalInfo.variables.forEach(i=>{const a=t.map(u=>{var p;return(p=u.multidimensionalInfo)==null?void 0:p.variables.find(({name:c})=>c===i.name)}),o=a.map(u=>{var p;return(p=u==null?void 0:u.statistics)!=null&&p.length?u.statistics:null}),l=a.map(u=>{var p;return(p=u==null?void 0:u.histograms)!=null&&p.length?u.histograms:null});i.statistics=o.every(u=>u!=null)?o.flat():null,i.histograms=l.every(u=>u!=null)?l.flat():null}),s.bandCount>1&&(s.colormap=null,s.attributeTable=null);const n=t.every(i=>{var a;return(a=i.keyProperties.BandProperties)==null?void 0:a.length})?t.flatMap(i=>i.keyProperties.BandProperties):void 0;return s.keyProperties={...s.keyProperties,BandProperties:n},this.rasterInfo=s,{success:!0,supportsGPU:s.bandCount<=3}}_processPixels(t){const{pixelBlocks:e}=t;return e?(e==null?void 0:e[0])==null?null:So(e):null}_getWebGLParameters(){return{bandCount:this.rasterInfo.bandCount}}};b([P({json:{write:!0,name:"rasterFunction"}})],Me.prototype,"functionName",void 0),b([P({type:Kl,json:{write:!0,name:"rasterFunctionArguments"}})],Me.prototype,"functionArguments",void 0),b([P()],Me.prototype,"rasterArgumentNames",void 0),Me=b([_("esri.layers.support.rasterFunctions.CompositeBandFunction")],Me);const Yl=Me,Xl=new kt({0:"difference",1:"relative-difference",2:"categorical",3:"euclidean-distance",4:"angle-difference",5:"band-with-most-change"},{useNumericKeys:!0}),Zl=new kt({0:"all",1:"changed",2:"unchanged"},{useNumericKeys:!0});function Ql(r,t,e,s){const[n,i]=r,a=yt(e)&&!yt(n.pixelType)&&!yt(i.pixelType),o=[n.mask,i.mask].filter(m=>m),l=$.combineBandMasks(o),u=r.map(m=>m.pixels[0]),{width:p,height:c}=n,h=$.createEmptyBand(e,p*c);switch(t){case"difference":case"relative-difference":tu({bands:u,mask:l,outBand:h,isRoundingNeeded:a,isRelative:t==="relative-difference"});break;case"categorical":eu({bands:u,mask:l,outBand:h,...s});break;case"euclidean-distance":ru({pixels:r.map(m=>m.pixels),mask:l,outBand:h});break;case"angle-difference":su({pixels:r.map(m=>m.pixels),mask:l,outBand:h});break;case"band-with-most-change":nu({pixels:r.map(m=>m.pixels),mask:l,outBand:h})}const f=new $({width:p,height:c,pixels:[h],pixelType:e,mask:l});return f.updateStatistics(),f}function tu(r){const{bands:[t,e],mask:s,isRelative:n,isRoundingNeeded:i,outBand:a}=r,o=t.length;for(let l=0;l<o;l++)if(!s||s[l]){let u=t[l]-e[l];if(n){const p=Math.max(Math.abs(t[l])-Math.abs(e[l]));u=p>0?u/p:0}a[l]=i?Math.round(u):u}}function eu(r){const{bands:[t,e],categoryIndexLookups:[s,n],classNames:[i,a],mask:o,keepMethod:l,outBand:u}=r,p=t.length,c=i.length,h=a.length,f=c*h,m=f+1,y=f+2;for(let d=0;d<p;d++)if(!o||o[d]){const v=t[d],w=e[d],T=s[v],g=n[w],x=i[T],C=a[g];u[d]=T==null||g==null?f:l==="changed"&&x===C?m:l==="unchanged"&&x!==C?y:T*h+g}}function ru(r){const{pixels:[t,e],mask:s,outBand:n}=r,i=t[0].length,a=t.length;for(let o=0;o<i;o++)if(!s||s[o]){let l=0;for(let u=0;u<a;u++){const p=t[u][o]-e[u][o];l+=p*p}n[o]=Math.sqrt(l)}}function su(r){const{pixels:[t,e],mask:s,outBand:n}=r,i=t[0].length,a=t.length;for(let o=0;o<i;o++)if(!s||s[o]){let l=0,u=0,p=0;for(let h=0;h<a;h++){const f=t[h][o],m=e[h][o];l+=f*m,u+=f*f,p+=m*m}const c=Math.sqrt(u*p);n[o]=c?Math.acos(l/c):1.5707963267948966}}function nu(r){const{pixels:[t,e],mask:s,outBand:n}=r,i=t[0].length,a=t.length;for(let o=0;o<i;o++)if(!s||s[o]){let l=0,u=0;for(let p=0;p<a;p++){const c=Math.abs(t[p][o]-e[p][o]);c>l&&(l=c,u=p)}n[o]=u}}var Xr;let ce=Xr=class extends at{constructor(){super(...arguments),this.method="difference",this.keepMethod="all",this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new Xr({raster:this.raster,raster2:this.raster2,method:this.method,keepMethod:this.keepMethod})}};b([At(Xl)],ce.prototype,"method",void 0),b([At(Zl)],ce.prototype,"keepMethod",void 0),b([P({json:{write:!0}})],ce.prototype,"raster2",void 0),b([P({readOnly:!0})],ce.prototype,"rasters",null),ce=Xr=b([_("esri.layers.support.rasterFunctions.ComputeChangeFunctionArguments")],ce);const ou=ce;let pe=class extends it{constructor(){super(...arguments),this.functionName="ComputeChange",this.functionArguments=null,this.rasterArgumentNames=["raster","raster2"]}_bindSourceRasters(){const{method:t}=this.functionArguments,e=this.sourceRasterInfos[0].clone();if(this.outputPixelType=this._getOutputPixelType(e.pixelType),e.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(e),t==="categorical"){const s=this.sourceRasterInfos.map(a=>a.attributeTable),n=this._getFieldNames(s,"value"),i=s.map(a=>this._getClassFieldName(a));if(n[0]==null||n[1]==null||i[0]==null||i[1]==null)return{success:!1,supportsGPU:!1,error:"both inputs must have proper attribute table with value and class fields"};this._updateAttributeTable(e,n,i)}return e.bandCount=1,this.rasterInfo=e,{success:!0,supportsGPU:t==="difference"||t==="relative-difference"}}_processPixels(t){const{pixelBlocks:e}=t;if((e==null?void 0:e[0])==null||(e==null?void 0:e[1])==null)return null;const{method:s}=this.functionArguments;return Ql(e,s,this.outputPixelType,this._categoryConfig)}_getWebGLParameters(){const t=this.outputPixelType??"f32";let[e,s]=Qt(t);const n=yt(t);return n&&(e-=1e-4,s+=1e-4),{method:this.functionArguments.method,domainRange:[e,s],isOutputRounded:n}}_updateAttributeTable(t,e,s){const n=this.sourceRasterInfos.map(g=>g.attributeTable),i=n.map((g,x)=>g.features.map(C=>C.attributes[e[x]])),a=n.map((g,x)=>g.features.map(C=>C.attributes[s[x]])),o=i.map(g=>{const x=[];return g.forEach((C,k)=>x[C]=k),x}),{keepMethod:l}=this.functionArguments;this._categoryConfig={categoryIndexLookups:o,classNames:a,keepMethod:l};const u=n[0].clone();u.fields=[new jt({name:"OID",type:"oid"}),new jt({name:"Value",type:"integer"}),new jt({name:"ClassName",type:"string"}),new jt({name:"Class_From",type:"string"}),new jt({name:"Class_To",type:"string"})];const p=this._getFieldNames(n,"red"),c=this._getFieldNames(n,"green"),h=this._getFieldNames(n,"blue"),f=[],m=p.length===2&&c.length===2&&h.length===2;m&&(f.push(...n.map((g,x)=>g.features.map(C=>[C.attributes[p[x]],C.attributes[c[x]],C.attributes[h[x]]]))),u.fields.push(new jt({name:"Red",type:"integer"}),new jt({name:"Green",type:"integer"}),new jt({name:"Blue",type:"integer"})));const y=u.features[0].clone();y.geometry=null;const d=[],[v,w]=i.map(g=>g.length);let T=1;for(let g=0;g<v;g++){const x=a[0][g];for(let C=0;C<w;C++){const k=a[1][C];if(l==="changed"&&x===k||l==="unchanged"&&x!==k)continue;const A=y.clone();A.attributes={OID:T++,Value:g*w+C,ClassName:x===k?x:`${x} -> ${k}`,Class_From:x,Class_To:k},m&&(A.attributes.Red=f[0][g][0]+f[1][C][0]>>1,A.attributes.Green=f[0][g][1]+f[1][C][1]>>1,A.attributes.Blue=f[0][g][2]+f[1][C][2]>>1),d.push(A)}}if(l==="changed"){const g=y.clone();g.attributes={OID:T++,Value:v*w+1,ClassName:"No Change",Class_From:"Same",Class_To:"Same"},d.push(g)}else if(l==="unchanged"){const g=y.clone();g.attributes={OID:T++,Value:v*w+2,ClassName:"Changed",Class_From:"Any",Class_To:"Any"},d.push(g)}u.features=d,t.attributeTable=u}_getFieldNames(t,e){return t.map(({fields:s})=>{var n;return(n=s.find(i=>i.name.toLowerCase()===e))==null?void 0:n.name}).filter(s=>s)}_getClassFieldName(t){const e=t.fields.find(s=>s.type==="string"&&s.name.toLowerCase().startsWith("class"))??t.fields.find(s=>s.type==="string"&&s.name.toLowerCase().includes("class")||s.name.toLowerCase().includes("type")||s.name.toLowerCase().includes("name"))??t.fields.find(s=>s.type==="string");return e==null?void 0:e.name}};b([P({json:{write:!0,name:"rasterFunction"}})],pe.prototype,"functionName",void 0),b([P({type:ou,json:{write:!0,name:"rasterFunctionArguments"}})],pe.prototype,"functionArguments",void 0),b([P()],pe.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],pe.prototype,"_categoryConfig",void 0),pe=b([_("esri.layers.support.rasterFunctions.ComputeChangeFunction")],pe);const iu=pe;var Zr;let Xe=Zr=class extends at{constructor(){super(...arguments),this.contrastOffset=0,this.brightnessOffset=0}clone(){return new Zr({contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset,raster:this.raster})}};b([P({json:{write:!0}})],Xe.prototype,"contrastOffset",void 0),b([P({json:{write:!0}})],Xe.prototype,"brightnessOffset",void 0),Xe=Zr=b([_("esri.layers.support.rasterFunctions.ContrastBrightnessFunctionArguments")],Xe);const au=Xe;let he=class extends it{constructor(){super(...arguments),this.functionName="ContrastBrightness",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){const{sourceRasterInfos:t}=this,e=t[0];if(e.pixelType!=="u8")return{success:!1,supportsGPU:!1,error:"Only unsigned 8 bit raster is supported by ContrastBrightness function."};this.outputPixelType=this._getOutputPixelType("u8");const s=e.clone();this._removeStatsHistColormapVAT(s),this.rasterInfo=s;const{contrastOffset:n,brightnessOffset:i}=this.functionArguments;return this.lookup=Qn(n,i),{success:!0,supportsGPU:!0}}_processPixels(t){var s;const e=(s=t.pixelBlocks)==null?void 0:s[0];return e==null?null:rr(e,{lut:e.pixels.map(()=>this.lookup),offset:0,outputPixelType:"u8"})}_getWebGLParameters(){const{contrastOffset:t,brightnessOffset:e}=this.functionArguments;return{contrastOffset:t,brightnessOffset:e}}};b([P({json:{write:!0,name:"rasterFunction"}})],he.prototype,"functionName",void 0),b([P({type:au,json:{write:!0,name:"rasterFunctionArguments"}})],he.prototype,"functionArguments",void 0),b([P()],he.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],he.prototype,"lookup",void 0),he=b([_("esri.layers.support.rasterFunctions.ContrastBrightnessFunction")],he);const lu=he;function Os(r,t,e,s,n){const i=Math.floor(s/2);for(let o=0;o<i;o++)for(let l=0;l<t;l++)r[o*t+l]=r[(n-1-o)*t+l],r[(e-1-o)*t+l]=r[(e-n+o)*t+l];const a=Math.floor(n/2);for(let o=0;o<e;o++){const l=o*t;for(let u=0;u<a;u++)r[l+u]=r[l+n-1-u],r[l+t-u-1]=r[l+t+u-n]}}const nt=new Map;function uu(r){const t=Math.sqrt(r.length),e=r.slice(0,t),s=[1];for(let n=1;n<t;n++){let i=null;for(let a=0;a<t;a++){const o=r[a+n*t],l=r[a];if(i==null)if(l===0){if(o)return{separable:!1,row:null,col:null}}else i=o/l;else if(o/l!==i)return{separable:!1,row:null,col:null}}if(i==null)return{separable:!1,row:null,col:null};s.push(i)}return{separable:!0,row:e,col:s}}function xn(r,t,e,s,n,i,a){const o=new Float32Array(t*e),l=i.length,u=a?0:s,p=a?s:0,c=a?1:t;for(let h=u;h<e-u;h++){const f=h*t;for(let m=p;m<t-p;m++){if(n&&!n[f+m])continue;let y=0;for(let d=0;d<l;d++)y+=r[f+m+(d-s)*c]*i[d];o[f+m]=y}}return o}function cu(r,t,e,s,n,i,a){const o=new Float32Array(t*e),l=Math.floor(s/2),u=Math.floor(n/2);for(let p=l;p<e-l;p++){const c=p*t;for(let h=u;h<t-u;h++){if(i&&!i[c+h])continue;let f=0;for(let m=0;m<s;m++)for(let y=0;y<n;y++)f+=r[c+h+(m-l)*t+y-u]*a[m*n+y];o[c+h]=f}}return o}function pu(r,t,e=!0){const{pixels:s,width:n,height:i,pixelType:a,mask:o}=r,l=s.length,u=[],{kernel:p,rows:c,cols:h}=t;for(let f=0;f<l;f++){const m=cu(s[f],n,i,c,h,o,p);e&&Os(m,n,i,c,h),u.push(m)}return new $({width:n,height:i,pixelType:a,pixels:u,mask:o})}function hu(r,t,e,s=!0){const{pixels:n,width:i,height:a,pixelType:o,mask:l}=r,u=n.length,p=[],c=t.length,h=e.length,f=Math.floor(c/2),m=Math.floor(h/2);for(let y=0;y<u;y++){let d=xn(n[y],i,a,f,l,t,!0);d=xn(d,i,a,m,l,e,!1),s&&Os(d,i,a,c,h),p.push(d)}return new $({width:i,height:a,pixelType:o,pixels:p,mask:l})}function fu(r,t){const e=uu(t.kernel),s=t.mirrorEdges!==!1,n=e.separable?hu(r,e.row,e.col,s):pu(r,t,s),{outputPixelType:i}=t;return i&&n.clamp(i),n}nt.set(X.none,[0,0,0,0,1,0,0,0,0]),nt.set(X.lineDetectionHorizontal,[-1,-1,-1,2,2,2,-1,-1,-1]),nt.set(X.lineDetectionVertical,[-1,2,-1,-1,2,-1,-1,2,-1]),nt.set(X.lineDetectionLeftDiagonal,[2,-1,-1,-1,2,-1,-1,-1,2]),nt.set(X.lineDetectionRightDiagonal,[-1,-1,2,-1,2,-1,2,-1,-1]),nt.set(X.gradientNorth,[-1,-2,-1,0,0,0,1,2,1]),nt.set(X.gradientWest,[-1,0,1,-2,0,2,-1,0,1]),nt.set(X.gradientEast,[1,0,-1,2,0,-2,1,0,-1]),nt.set(X.gradientSouth,[1,2,1,0,0,0,-1,-2,-1]),nt.set(X.gradientNorthEast,[0,-1,-2,1,0,-1,2,1,0]),nt.set(X.gradientNorthWest,[-2,-1,0,-1,0,1,0,1,2]),nt.set(X.smoothArithmeticMean,[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111]),nt.set(X.smoothing3x3,[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625]),nt.set(X.smoothing5x5,[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1]),nt.set(X.sharpening3x3,[-1,-1,-1,-1,9,-1,-1,-1,-1]),nt.set(X.sharpening5x5,[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1]),nt.set(X.laplacian3x3,[0,-1,0,-1,4,-1,0,-1,0]),nt.set(X.laplacian5x5,[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0]),nt.set(X.sobelHorizontal,[-1,-2,-1,0,0,0,1,2,1]),nt.set(X.sobelVertical,[-1,0,1,-2,0,2,-1,0,1]),nt.set(X.sharpen,[0,-.25,0,-.25,2,-.25,0,-.25,0]),nt.set(X.sharpen2,[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25]),nt.set(X.pointSpread,[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627]);var Qr;let fe=Qr=class extends at{constructor(){super(...arguments),this.rows=3,this.cols=3,this.kernel=[0,0,0,0,1,0,0,0,0]}set convolutionType(r){this._set("convolutionType",r);const t=nt.get(r);if(!t||r===X.userDefined||r===X.none)return;const e=Math.sqrt(t.length);this._set("kernel",t),this._set("cols",e),this._set("rows",e)}clone(){return new Qr({cols:this.cols,rows:this.rows,kernel:[...this.kernel],convolutionType:this.convolutionType,raster:Z(this.raster)})}};b([P({json:{type:Number,write:!0}})],fe.prototype,"rows",void 0),b([P({json:{type:Number,write:!0}})],fe.prototype,"cols",void 0),b([P({json:{name:"type",type:Number,write:!0}})],fe.prototype,"convolutionType",null),b([P({json:{type:[Number],write:!0}})],fe.prototype,"kernel",void 0),fe=Qr=b([_("esri.layers.support.rasterFunctions.ConvolutionFunctionArguments")],fe);const mu=fe,Cn=25;let me=class extends it{constructor(){super(...arguments),this.functionName="Convolution",this.rasterArgumentNames=["raster"]}get _normalizedKernel(){const{kernel:t,convolutionType:e}=this.functionArguments,s=t.reduce((n,i)=>n+i);return e===-1||s===0||s===1?t:t.map(n=>n/s)}_bindSourceRasters(){const{convolutionType:t,rows:e,cols:s,kernel:n}=this.functionArguments;if(!Object.values(X).includes(t))return{success:!1,supportsGPU:!1,error:`convolution-function: the specified kernel type is not supported ${t}`};if(t!==X.none&&e*s!==n.length)return{success:!1,supportsGPU:!1,error:"convolution-function: the specified rows and cols do not match the length of the kernel"};const i=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(i.pixelType);const a=i.clone();a.pixelType=this.outputPixelType;const o=[X.none,X.sharpen,X.sharpen2,X.sharpening3x3,X.sharpening5x5];return(t===-1||this.outputPixelType!=="u8"&&!o.includes(t))&&(a.statistics=null,a.histograms=null),a.colormap=null,a.attributeTable=null,this.rasterInfo=a,{success:!0,supportsGPU:n.length<=Cn}}_processPixels(t){var a;const e=(a=t.pixelBlocks)==null?void 0:a[0];if(e==null||this.functionArguments.convolutionType===X.none)return e;const{rows:s,cols:n}=this.functionArguments,{_normalizedKernel:i}=this;return fu(e,{kernel:i,rows:s,cols:n,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const t=new Float32Array(Cn);return t.set(this._normalizedKernel),{kernelRows:this.functionArguments.rows,kernelCols:this.functionArguments.cols,kernel:t,clampRange:Qt(this.outputPixelType)}}};b([P({json:{write:!0,name:"rasterFunction"}})],me.prototype,"functionName",void 0),b([P({type:mu,json:{write:!0,name:"rasterFunctionArguments"}})],me.prototype,"functionArguments",void 0),b([P()],me.prototype,"rasterArgumentNames",void 0),b([P()],me.prototype,"_normalizedKernel",null),me=b([_("esri.layers.support.rasterFunctions.ConvolutionFunction")],me);const du=me;var ts;const ao=new kt({0:"standard",1:"planform",2:"profile"},{useNumericKeys:!0});let Ee=ts=class extends at{constructor(){super(...arguments),this.curvatureType="standard",this.zFactor=1}readCurvatureType(r,t){return ao.fromJSON(t.type??t.curvatureType??0)}clone(){return new ts({curvatureType:this.curvatureType,zFactor:this.zFactor,raster:this.raster})}};b([P({json:{write:{target:"type"}}}),At(ao)],Ee.prototype,"curvatureType",void 0),b([Xt("curvatureType",["type","curvatureType"])],Ee.prototype,"readCurvatureType",null),b([P({type:Number,json:{write:!0}})],Ee.prototype,"zFactor",void 0),Ee=ts=b([_("esri.layers.support.rasterFunctions.CurvatureFunctionArguments")],Ee);const gu=Ee;let de=class extends it{constructor(){super(...arguments),this.functionName="Curvature",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){var e;this.outputPixelType=this._getOutputPixelType("f32");const t=this.sourceRasterInfos[0].clone();return t.pixelType=this.outputPixelType,t.bandCount=1,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,this.isGCS=((e=t.spatialReference)==null?void 0:e.isGeographic)??!1,{success:!0,supportsGPU:!0}}_processPixels(t){var p;const e=(p=t.pixelBlocks)==null?void 0:p[0];if(e==null)return null;const{zFactor:s,curvatureType:n}=this.functionArguments,{extent:i,primaryPixelSizes:a}=t,o=a==null?void 0:a[0],l=o??(i?{x:i.width/e.width,y:i.height/e.height}:{x:1,y:1}),u=this.isGCS&&s>=1?s*$t:s;return na(e,{zFactor:u,curvatureType:n,resolution:l})}_getWebGLParameters(){const{zFactor:t,curvatureType:e}=this.functionArguments;return{curvatureType:e,zFactor:this.isGCS&&t>=1?t*$t:t}}};b([P({json:{write:!0,name:"rasterFunction"}})],de.prototype,"functionName",void 0),b([P({type:gu,json:{write:!0,name:"rasterFunctionArguments"}})],de.prototype,"functionArguments",void 0),b([P()],de.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],de.prototype,"isGCS",void 0),de=b([_("esri.layers.support.rasterFunctions.CurvatureFunction")],de);const yu=de;var es;let Dt=es=class extends at{constructor(){super(...arguments),this.bandIds=[],this.bandNames=[],this.bandWavelengths=[],this.missingBandAction=Fn.bestMatch}clone(){var r,t,e;return new es({bandIds:(r=this.bandIds)==null?void 0:r.slice(),bandNames:(t=this.bandNames)==null?void 0:t.slice(),bandWavelengths:(e=this.bandWavelengths)==null?void 0:e.slice(),missingBandAction:this.missingBandAction,method:this.method,wavelengthMatchTolerance:this.wavelengthMatchTolerance})}};b([P({json:{write:!0}})],Dt.prototype,"bandIds",void 0),b([P({json:{write:!0}})],Dt.prototype,"bandNames",void 0),b([P({json:{write:!0}})],Dt.prototype,"bandWavelengths",void 0),b([At({0:"name",1:"wavelength",2:"id"})],Dt.prototype,"method",void 0),b([P({json:{write:!0}})],Dt.prototype,"missingBandAction",void 0),b([P({json:{write:!0}})],Dt.prototype,"wavelengthMatchTolerance",void 0),Dt=es=b([_("esri.layers.support.rasterFunctions.ExtractBandFunctionArguments")],Dt);const wu=Dt;let Oe=class extends it{constructor(){super(...arguments),this.functionName="ExtractBand",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){var v;const{functionArguments:t,sourceRasterInfos:e}=this,s=e[0],{method:n,bandNames:i,bandWavelengths:a,bandIds:o,missingBandAction:l}=t,u=(i==null?void 0:i.length)&&(n==="name"||n!=="id"&&!(o!=null&&o.length)),p=(a==null?void 0:a.length)&&(n==="wavelength"||n!=="id"&&!(o!=null&&o.length)),c=l===Fn.fail,h=u?vu(s,i):p?Cu(s,a,this.functionArguments,c):xu(s,o,c);if(h==null)return{success:!1,supportsGPU:!1,error:`extract-band-function: Invalid ${u?"band names":p?"band wavelengths":"band ids"} for the imagery data source`};this.functionArguments.bandIds=h,this.functionArguments.method="id",this.outputPixelType=this._getOutputPixelType("f32");const f=s.clone();f.pixelType=this.outputPixelType,f.bandCount=h.length;const{statistics:m,histograms:y}=f;m!=null&&m.length&&(f.statistics=h.map(w=>m[w]||m[m.length-1])),y!=null&&y.length&&(f.histograms=h.map(w=>y[w]||y[y.length-1])),f.multidimensionalInfo&&f.multidimensionalInfo.variables.forEach(w=>{const{statistics:T,histograms:g}=w;T!=null&&T.length&&(w.statistics=h.map(x=>T[x]||T[T.length-1])),g!=null&&g.length&&(w.histograms=h.map(x=>g[x]||g[g.length-1]))});let d=(v=f.keyProperties)==null?void 0:v.BandProperties;return d!=null&&d.length&&(d=h.map(w=>w>=d.length?d[d.length-1]:d[w]),f.keyProperties={...f.keyProperties,BandProperties:d}),this.rasterInfo=f,{success:!0,supportsGPU:f.bandCount<=3}}_processPixels(t){var i;const e=(i=t.pixelBlocks)==null?void 0:i[0];if(e==null)return null;const s=e.pixels.length,n=this.functionArguments.bandIds.map(a=>a>=s?s-1:a);return e.extractBands(n)}_getWebGLParameters(){let t;if(this.isInputBandIdsSwizzled)t=this.swizzledBandSelection.length?this.swizzledBandSelection:[0,1,2];else{t=[...this.functionArguments.bandIds],t.length===0?t=[0,1,2]:t.length<3&&(t[1]=t[1]??t[0],t[2]=t[2]??t[1]);for(let e=0;e<3;e++)t[e]=Math.min(t[e],2)}return{bandIndexMat3:pt(t)}}_getInputBandIds(t){const e=t.length;return this.functionArguments.bandIds.map(s=>s>=e?e-1:s).map(s=>t[s])}};b([P({json:{write:!0,name:"rasterFunction"}})],Oe.prototype,"functionName",void 0),b([P({type:wu,json:{write:!0,name:"rasterFunctionArguments"}})],Oe.prototype,"functionArguments",void 0),b([P()],Oe.prototype,"rasterArgumentNames",void 0),Oe=b([_("esri.layers.support.rasterFunctions.ExtractBandFunction")],Oe);const bu=Oe;function vu(r,t){const e=r.bandInfos.map(({name:n})=>n.toLowerCase()),s=[];for(let n=0;n<t.length;n++){const i=t[n].toLowerCase();let a=e.indexOf(i);if(a===-1&&i==="nearinfrared"&&(a=e.findIndex(o=>o.startsWith("nearinfrared_1")),a===-1&&(a=e.findIndex(o=>o.startsWith("nearinfrared")))),a===-1)return null;s.push(a)}return s}function xu(r,t,e){const{bandCount:s}=r;return!(t!=null&&t.length)||e&&t.some(n=>n<0||n>=s)?null:t}function Cu(r,t,{wavelengthMatchTolerance:e},s){const{bandInfos:n}=r,i=[];for(let o=0;o<n.length;o++){const{minWavelength:l,maxWavelength:u}=n[o];if(!l||!u)return null;i.push({minWavelength:l,maxWavelength:u})}const a=[];for(let o=0;o<t.length;o++){const l=t[o];let u=!1,p=-1,c=Number.MAX_VALUE;for(let h=0;h<i.length;h++){const f=i[h],m=l>=f.minWavelength&&l<=f.maxWavelength,y=Math.abs(l-(f.minWavelength+f.maxWavelength)/2);m?y<c&&(u=!0,p=h,c=y):!u&&y<c&&(p=h,c=y)}if(!u&&e&&c<e&&(u=!0),!u&&s)return null;a.push(p)}return a}function Au(r,t,e){const{pixels:s,width:n,height:i,mask:a,bandMasks:o}=r,l=n*i,u=o!=null&&o.length?$.combineBandMasks(o):a,p=Math.min(t.length,s.length),c=e.startsWith("f"),h=!c&&e!==r.pixelType,[f,m]=Qt(e),y=$.createEmptyBand(e,l);for(let v=0;v<i;v++){let w=v*n;for(let T=0;T<n;T++,w++)if(!u||u[w]){let g=0;for(let x=0;x<p;x++)g+=t[x]*s[x][w];c||(g=Math.round(g),h&&(g=g>m?m:g<f?f:g)),y[w]=g}}const d=new $({width:n,height:i,pixels:[y],pixelType:e,mask:u});return d.updateStatistics(),d}var rs;let fr=rs=class extends at{clone(){return new rs({conversionParameters:[...this.conversionParameters],raster:this.raster})}};b([P({type:[Number],json:{write:!0}})],fr.prototype,"conversionParameters",void 0),fr=rs=b([_("esri.layers.support.rasterFunctions.GrayscaleFunctionArguments")],fr);const Tu=fr;let ge=class extends it{constructor(){super(...arguments),this.functionName="Grayscale",this.functionArguments=null,this.rasterArgumentNames=["raster"]}get _normalizedWeights(){const{conversionParameters:t}=this.functionArguments,e=t.reduce((s,n)=>s+n);return t.map(s=>s/e)}_bindSourceRasters(){const{conversionParameters:t}=this.functionArguments;if(!(t!=null&&t.length))return{success:!1,supportsGPU:!1,error:"missing valid conversion parameters."};const e=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(e.pixelType),e.pixelType=this.outputPixelType;const s=t.length===3||e.bandCount===3&&t.length>3;return e.bandCount=1,this._removeStatsHistColormapVAT(e),this.rasterInfo=e,{success:!0,supportsGPU:s}}_processPixels(t){var s;const e=(s=t.pixelBlocks)==null?void 0:s[0];return e==null?null:Au(e,this._normalizedWeights,this.outputPixelType)}_getWebGLParameters(){return{weights:this._normalizedWeights}}};b([P({json:{write:!0,name:"rasterFunction"}})],ge.prototype,"functionName",void 0),b([P({type:Tu,json:{write:!0,name:"rasterFunctionArguments"}})],ge.prototype,"functionArguments",void 0),b([P()],ge.prototype,"rasterArgumentNames",void 0),b([P()],ge.prototype,"_normalizedWeights",null),ge=b([_("esri.layers.support.rasterFunctions.GrayscaleFunction")],ge);const Su=ge;var ss;const ku=new kt({0:"traditional",1:"multi-directional"},{useNumericKeys:!0}),Pu=new kt({1:"degree",2:"percent-rise",3:"scaled"},{useNumericKeys:!0});let Nt=ss=class extends at{constructor(){super(...arguments),this.altitude=45,this.azimuth=315,this.hillshadeType="traditional",this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.slopeType="degree",this.zFactor=1,this.removeEdgeEffect=!1}clone(){return new ss({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,slopeType:this.slopeType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};b([P({type:Number,json:{write:!0}})],Nt.prototype,"altitude",void 0),b([P({type:Number,json:{write:!0}})],Nt.prototype,"azimuth",void 0),b([P(),At(ku)],Nt.prototype,"hillshadeType",void 0),b([P({type:Number,json:{write:!0,name:"psPower"}})],Nt.prototype,"pixelSizePower",void 0),b([P({type:Number,json:{write:!0,name:"psZFactor"}})],Nt.prototype,"pixelSizeFactor",void 0),b([P(),At(Pu)],Nt.prototype,"slopeType",void 0),b([P({type:Number,json:{write:!0}})],Nt.prototype,"zFactor",void 0),b([P({type:Boolean,json:{write:!0}})],Nt.prototype,"removeEdgeEffect",void 0),Nt=ss=b([_("esri.layers.support.rasterFunctions.HillshadeFunctionArguments")],Nt);const lo=Nt;let ye=class extends it{constructor(){super(...arguments),this.functionName="Hillshade",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){var s;const t=this.sourceRasterInfos[0];if(t.bandCount>1)return{success:!1,supportsGPU:!1,error:"hillshade-function: source data must be single band"};this.outputPixelType=this._getOutputPixelType("u8");const e=t.clone();return this._removeStatsHistColormapVAT(e),e.pixelType=this.outputPixelType,e.bandCount=1,e.statistics=[{min:0,max:255,avg:60,stddev:10}],this.rasterInfo=e,this.isGCS=((s=e.spatialReference)==null?void 0:s.isGeographic)??!1,{success:!0,supportsGPU:!0}}_processPixels(t){var u;const e=(u=t.pixelBlocks)==null?void 0:u[0];if(!e)return null;const{extent:s,primaryPixelSizes:n}=t,i=n==null?void 0:n[0],a=i??(s?{x:s.width/e.width,y:s.height/e.height}:{x:1,y:1}),o=wr(this.functionArguments,a,this.isGCS),l=Fs(e,o);return l.pixelType=this.outputPixelType,l}_getWebGLParameters(){const t=wr(this.functionArguments,{x:1,y:1},this.isGCS),e=Cr(t),{slopeType:s,zFactor:n,pixelSizeFactor:i,pixelSizePower:a}=this.functionArguments,o=s==="scaled",l=yt(this.outputPixelType);return{...e,zFactor:n,gcsFactor:this.isGCS?$t:1,pixelSizeFactor:o?i:0,pixelSizePower:o?a:0,isOutputRounded:l}}};b([P({json:{write:!0,name:"rasterFunction"}})],ye.prototype,"functionName",void 0),b([P({type:lo,json:{write:!0,name:"rasterFunctionArguments"}})],ye.prototype,"functionArguments",void 0),b([P()],ye.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],ye.prototype,"isGCS",void 0),ye=b([_("esri.layers.support.rasterFunctions.HillshadeFunction")],ye);const Iu=ye;var ns;let we=ns=class extends at{constructor(){super(...arguments),this.rasters=[],this.processAsMultiband=!0}writeRasters(r,t){t.rasters=r.map(e=>typeof e=="number"||typeof e=="string"?e:e.toJSON())}clone(){return new ns({operation:this.operation,processAsMultiband:this.processAsMultiband,rasters:Z(this.rasters)})}};b([P({json:{write:!0}})],we.prototype,"operation",void 0),b([P({json:{write:!0}})],we.prototype,"rasters",void 0),b([Ie("rasters")],we.prototype,"writeRasters",null),b([P({json:{write:!0}})],we.prototype,"processAsMultiband",void 0),we=ns=b([_("esri.layers.support.rasterFunctions.LocalFunctionArguments")],we);const Ru=we;let Be=class extends it{constructor(){super(...arguments),this.functionName="Local",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){const{sourceRasterInfos:t}=this,e=t[0],{bandCount:s}=e,{processAsMultiband:n}=this.functionArguments;if(t.some(u=>u.bandCount!==s))return{success:!1,supportsGPU:!1,error:"local-function: input rasters do not have same band count"};const{operation:i,rasters:a}=this.functionArguments,o=on[i];if(!(o===999||a.length===o||a.length<=1&&o===1))return{success:!1,supportsGPU:!1,error:`local-function: the length of functionArguments.rasters does not match operation's requirement: ${o}`};const l=e.clone();return l.bandCount=o!==999||n?s:1,this._removeStatsHistColormapVAT(l),this._updateStatistics(l),this._updatePixelType(l),this.rasterInfo=l,{success:!0,supportsGPU:l.bandCount===1&&o<=3}}_processPixels(t){const{pixelBlocks:e}=t;return e==null||e.some(s=>s==null)?null:io(e,this.functionArguments.operation,{processAsMultiband:this.functionArguments.processAsMultiband,outputPixelType:this.outputPixelType??void 0})}_getWebGLParameters(){var l;const{operation:t}=this.functionArguments,e=on[t],s=((l=Object.keys(sn).find(u=>sn[u]===t))==null?void 0:l.toLowerCase())??"undefined",n=this.outputPixelType??"f32";let[i,a]=Qt(n);const o=yt(n);return o&&(i-=1e-4,a+=1e-4),{imageCount:e,operationName:s,domainRange:[i,a],isOutputRounded:o}}_updateStatistics(t){var i,a;const e=this.sourceRasterInfos[0],{operation:s}=this.functionArguments,n=(i=nn(s))==null?void 0:i.domain;if(n){t.statistics=[];for(let o=0;o<t.bandCount;o++)t.statistics[o]={min:n[0],max:n[1],avg:(n[0]+n[1])/2,stddev:(n[0]+n[1])/10}}else s===45&&((a=e.statistics)!=null&&a.length)&&(t.statistics=e.statistics.map(o=>({min:-o.max,max:-o.min,avg:o.avg!=null?-o.avg:void 0,stddev:o.stddev!=null?-o.stddev:void 0})))}_updatePixelType(t){const{statistics:e,pixelType:s}=this.sourceRasterInfos[0],{operation:n}=this.functionArguments,{domain:i,isInteger:a}=nn(n)??{domain:null,isInteger:!1};let o="f32";if(i&&a)o=Pr(i[0],i[1]);else if(n===30){const l=e==null?void 0:e[0];o=l?Pr(l.min,l.max):yt(s)?s:"s32"}else if(n===45&&yt(s)){const l=e==null?void 0:e.map(({max:h})=>-h),u=e==null?void 0:e.map(({min:h})=>-h),p=l!=null&&l.length?Math.min(...l):null,c=u!=null&&u.length?Math.min(...u):null;o=p!=null&&c!=null?Pr(p,c):s.startsWith("s")?s.replace("s","u"):s==="u1"||s==="u2"||s==="u4"?"s8":s==="u8"?"s16":"s32"}t.pixelType=this.outputPixelType=this._getOutputPixelType(o)}};b([P({json:{write:!0,name:"rasterFunction"}})],Be.prototype,"functionName",void 0),b([P({type:Ru,json:{write:!0,name:"rasterFunctionArguments"}})],Be.prototype,"functionArguments",void 0),b([P()],Be.prototype,"rasterArgumentNames",void 0),Be=b([_("esri.layers.support.rasterFunctions.LocalFunction")],Be);const Nu=Be;var os;let be=os=class extends at{constructor(){super(...arguments),this.includedRanges=null,this.noDataValues=null,this.noDataInterpretation=$n.matchAny}get normalizedNoDataValues(){const{noDataValues:r}=this;if(!(r!=null&&r.length))return null;let t=!1;const e=r.map(s=>{if(typeof s=="number")return t=!0,[s];if(typeof s=="string"){const n=s.trim().split(" ").filter(i=>i.trim()!=="").map(i=>Number(i));return t=t||n.length>0,n.length===0?null:n}return null});return t?e:null}clone(){var r,t;return new os({includedRanges:((r=this.includedRanges)==null?void 0:r.slice())??[],noDataValues:((t=this.noDataValues)==null?void 0:t.slice())??[],noDataInterpretation:this.noDataInterpretation})}};b([P({json:{write:!0}})],be.prototype,"includedRanges",void 0),b([P({json:{write:!0}})],be.prototype,"noDataValues",void 0),b([P()],be.prototype,"normalizedNoDataValues",null),b([P({json:{write:!0}})],be.prototype,"noDataInterpretation",void 0),be=os=b([_("esri.layers.support.rasterFunctions.MaskFunctionArguments")],be);const Fu=be;let ve=class extends it{constructor(){super(...arguments),this.functionName="Mask",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const t=this.sourceRasterInfos[0].clone(),{pixelType:e}=t;this.outputPixelType=this._getOutputPixelType(e),t.pixelType=this.outputPixelType,this.rasterInfo=t;const{includedRanges:s,normalizedNoDataValues:n}=this.functionArguments;if(!(s!=null&&s.length)&&!(n!=null&&n.length))return{success:!1,supportsGPU:!1,error:"missing includedRanges or noDataValues argument"};let i=[];for(let o=0;o<t.bandCount;o++){const l=ko(e,s==null?void 0:s.slice(2*o,2*o+2),n==null?void 0:n[o]);if(l==null){i=null;break}i.push(l)}this.lookups=i;const a=n!=null&&n.every(o=>{var l;return(o==null?void 0:o.length)===((l=n[0])==null?void 0:l.length)});return{success:!0,supportsGPU:(!s||s.length<=2*Gt)&&(!n||a&&n[0].length<=Gt)}}_processPixels(t){var u;const e=(u=t.pixelBlocks)==null?void 0:u[0];if(e==null)return null;const{outputPixelType:s,lookups:n}=this,{includedRanges:i,noDataInterpretation:a,normalizedNoDataValues:o}=this.functionArguments,l=a===$n.matchAll;return Po(e,{includedRanges:i,noDataValues:o,outputPixelType:s,matchAll:l,lookups:n})}_getWebGLParameters(){var i;const{includedRanges:t,normalizedNoDataValues:e}=this.functionArguments,s=new Float32Array(Gt);s.fill(Ue),(i=e==null?void 0:e[0])!=null&&i.length&&s.set(e[0]);const n=new Float32Array(Gt);for(let a=0;a<n.length;a+=2)n[a]=(t==null?void 0:t[a])??-Ue,n[a+1]=(t==null?void 0:t[a+1])??Ue;return t!=null&&t.length&&n.set(t),{bandCount:this.sourceRasterInfos[0].bandCount,noDataValues:s,includedRanges:n}}};b([P({json:{write:!0,name:"rasterFunction"}})],ve.prototype,"functionName",void 0),b([P({type:Fu,json:{write:!0,name:"rasterFunctionArguments"}})],ve.prototype,"functionArguments",void 0),b([P()],ve.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],ve.prototype,"lookups",void 0),ve=b([_("esri.layers.support.rasterFunctions.MaskFunction")],ve);const $u=ve;var is;let De=is=class extends at{constructor(){super(...arguments),this.visibleBandID=0,this.infraredBandID=1,this.scientificOutput=!1}clone(){const{visibleBandID:r,infraredBandID:t,scientificOutput:e}=this;return new is({visibleBandID:r,infraredBandID:t,scientificOutput:e})}};b([P({json:{write:!0}})],De.prototype,"visibleBandID",void 0),b([P({json:{write:!0}})],De.prototype,"infraredBandID",void 0),b([P({json:{write:!0}})],De.prototype,"scientificOutput",void 0),De=is=b([_("esri.layers.support.rasterFunctions.NDVIFunctionArguments")],De);const Mu=De;let Ge=class extends it{constructor(){super(...arguments),this.functionName="NDVI",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{scientificOutput:t,visibleBandID:e,infraredBandID:s}=this.functionArguments;this.outputPixelType=this._getOutputPixelType(t?"f32":"u8");const n=this.sourceRasterInfos[0],i=Math.max(e,s);if(n.bandCount<2||i>=n.bandCount)return{success:!1,supportsGPU:!1,error:"ndvi-function: source raster has insufficient amount of raster bands"};if(e<0||s<0)return{success:!1,supportsGPU:!1,error:"ndvi-function: invalid visible or infrared band id"};const a=n.clone();a.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(a),a.bandCount=1,a.keyProperties={...a.keyProperties,BandProperties:void 0};const[o,l,u,p]=t?[-1,1,0,.1]:[0,200,100,10];return a.statistics=[{min:o,max:l,avg:u,stddev:p}],this.rasterInfo=a,{success:!0,supportsGPU:!0}}_processPixels(t){var a;const e=(a=t.pixelBlocks)==null?void 0:a[0];if(e==null)return null;const{visibleBandID:s,infraredBandID:n,scientificOutput:i}=this.functionArguments;return gl(e,s,n,!i)}_getWebGLParameters(){const{visibleBandID:t,infraredBandID:e,scientificOutput:s}=this.functionArguments,n=this.isInputBandIdsSwizzled?[0,1,2]:[e,t,0];return{bandIndexMat3:pt(n),scaled:!s}}_getInputBandIds(t){const{visibleBandID:e,infraredBandID:s}=this.functionArguments;return[s,e,0].map(n=>t[n])}};b([P({json:{write:!0,name:"rasterFunction"}})],Ge.prototype,"functionName",void 0),b([P({type:Mu,json:{write:!0,name:"rasterFunctionArguments"}})],Ge.prototype,"functionArguments",void 0),b([P()],Ge.prototype,"rasterArgumentNames",void 0),Ge=b([_("esri.layers.support.rasterFunctions.NDVIFunction")],Ge);const Eu=Ge;var as;let Vt=as=class extends at{constructor(){super(...arguments),this.inputRanges=null,this.outputValues=null,this.noDataRanges=null,this.allowUnmatched=!1,this.isLastInputRangeInclusive=!1}clone(){return new as({inputRanges:[...this.inputRanges],outputValues:[...this.outputValues],noDataRanges:[...this.noDataRanges],allowUnmatched:this.allowUnmatched,isLastInputRangeInclusive:this.isLastInputRangeInclusive})}};b([P({json:{write:!0}})],Vt.prototype,"inputRanges",void 0),b([P({json:{write:!0}})],Vt.prototype,"outputValues",void 0),b([P({json:{write:!0}})],Vt.prototype,"noDataRanges",void 0),b([P({json:{write:!0}})],Vt.prototype,"allowUnmatched",void 0),b([P({json:{write:!0}})],Vt.prototype,"isLastInputRangeInclusive",void 0),Vt=as=b([_("esri.layers.support.rasterFunctions.RemapFunctionArguments")],Vt);const Ou=Vt;let xe=class extends it{constructor(){super(...arguments),this.functionName="Remap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){const t=this.sourceRasterInfos[0].clone(),{pixelType:e}=t;this.outputPixelType=this._getOutputPixelType(e),t.pixelType=this.outputPixelType,t.bandCount=1;const{statistics:s}=t;this._removeStatsHistColormapVAT(t);const{allowUnmatched:n,outputValues:i,inputRanges:a,noDataRanges:o,isLastInputRangeInclusive:l}=this.functionArguments;if(s!=null&&s.length&&(i!=null&&i.length))if(n){const u=Math.min.apply(null,[...i,s[0].min]),p=Math.max.apply(null,[...i,s[0].max]);t.statistics=[{...s[0],min:u,max:p}]}else{let u=i[0],p=u;for(let c=0;c<i.length;c++)u=u>i[c]?i[c]:u,p=p>i[c]?p:i[c];t.statistics=[{...s[0],min:u,max:p}]}return this.rasterInfo=t,this.lookup=n?null:Io({srcPixelType:e,inputRanges:a,outputValues:i,noDataRanges:o,allowUnmatched:n,isLastInputRangeInclusive:l,outputPixelType:this.outputPixelType}),{success:!0,supportsGPU:(!i||i.length<=Gt)&&(!o||o.length<=Gt)}}_processPixels(t){var p;const e=(p=t.pixelBlocks)==null?void 0:p[0];if(e==null)return null;const{lookup:s,outputPixelType:n}=this;if(s){const c=rr(e,{lut:[s.lut],offset:s.offset,outputPixelType:n});return c!=null&&s.mask&&(c.mask=Ro(e.pixels[0],e.mask,s.mask,s.offset,"u8")),c}const{inputRanges:i,outputValues:a,noDataRanges:o,allowUnmatched:l,isLastInputRangeInclusive:u}=this.functionArguments;return No(e,{inputRanges:i,outputValues:a,noDataRanges:o,outputPixelType:n,allowUnmatched:l,isLastInputRangeInclusive:u})}_getWebGLParameters(){const{allowUnmatched:t,noDataRanges:e,isLastInputRangeInclusive:s}=this.functionArguments,n=new Float32Array(3*Gt),i=1e-5,a=this.functionArguments.inputRanges??[],o=this.functionArguments.outputValues??[],l=o.length;for(let p=0;p<Gt;p++)n[3*p]=a[2*p]??Ue-1,n[3*p+1]=a[2*p+1]??Ue,n[3*p+2]=o[p]??0,p<l&&(p>0&&(n[3*p]-=i),(p<l-1||!s)&&(n[3*p+1]-=i));const u=new Float32Array(2*Gt);return u.fill(Ue),e!=null&&e.length&&u.set(e),{allowUnmatched:t,rangeMaps:n,noDataRanges:u,clampRange:Qt(this.outputPixelType)}}};b([P({json:{write:!0,name:"rasterFunction"}})],xe.prototype,"functionName",void 0),b([P({type:Ou,json:{write:!0,name:"rasterFunctionArguments"}})],xe.prototype,"functionArguments",void 0),b([P()],xe.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],xe.prototype,"lookup",void 0),xe=b([_("esri.layers.support.rasterFunctions.RemapFunction")],xe);const Bu=xe;var ls;let _e=ls=class extends lo{readColorRamp(r){if(typeof r=="string"){const t=Yt.jsonValues.find(e=>e.toLowerCase()===r.toLowerCase());return t?On(Yt.fromJSON(t)):null}return"toJSON"in r?r.toJSON():r}clone(){return new ls({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,slopeType:this.slopeType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,removeEdgeEffect:this.removeEdgeEffect,colorRamp:this.colorRamp,colormap:this.colormap,raster:this.raster})}};b([P({json:{write:!0}})],_e.prototype,"colorRamp",void 0),b([Xt("colorRamp")],_e.prototype,"readColorRamp",null),b([P({type:[[Number]],json:{write:!0}})],_e.prototype,"colormap",void 0),_e=ls=b([_("esri.layers.support.rasterFunctions.ShadedReliefFunctionArguments")],_e);const Du=_e;let Wt=class extends it{constructor(){super(...arguments),this.functionName="ShadedRelief",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){var o;const r=this.sourceRasterInfos[0];if(r.bandCount>1)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: source data must be single band"};let{colorRamp:t,colormap:e}=this.functionArguments;if(!t&&!(e!=null&&e.length))return{success:!1,supportsGPU:!1,error:"shadedrelief-function: a color ramp argument must be specified"};this.outputPixelType=this._getOutputPixelType("u8");const s=r.clone();this._removeStatsHistColormapVAT(s),s.pixelType=this.outputPixelType,s.bandCount=3,s.statistics=[{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10}],this.rasterInfo=s,this.isGCS=((o=s.spatialReference)==null?void 0:o.isGeographic)??!1,e!=null&&e.length||(e=sr(t,{interpolateAlpha:!0}));const{indexedColormap:n,offset:i}=ke({colormap:e});if(!(n!=null&&n.length))return{success:!1,supportsGPU:!1,error:"shadedrelief-function: a valid colorramp is required"};const a=Gn(n);return this.lookup={indexedColormap:n,offset:i,hsvMap:a},{success:!0,supportsGPU:tr(n)}}_processPixels(r){var a,o,l;const t=(a=r.pixelBlocks)==null?void 0:a[0];if(!t||!this.lookup)return null;let e=(o=r.primaryPixelSizes)==null?void 0:o[0];if(e==null){const{extent:u}=r;e=u?{x:u.width/t.width,y:u.height/t.height}:{x:1,y:1}}const s=wr(this.functionArguments,e,this.isGCS),n=Fs(t,s),i=((l=this.sourceRasterInfos[0].statistics)==null?void 0:l[0])??{min:0,max:8e3};return eo(n,t,this.lookup.hsvMap,i),n.pixelType=this.outputPixelType,n}_getWebGLParameters(){var c;const r=wr(this.functionArguments,{x:1,y:1},this.isGCS),t=Cr(r),{slopeType:e,zFactor:s,pixelSizeFactor:n,pixelSizePower:i}=this.functionArguments,a=e==="scaled",{indexedColormap:o,offset:l}=this.lookup,u=(c=this.sourceRasterInfos[0].statistics)==null?void 0:c[0],p=yt(this.outputPixelType);return{...t,indexedColormap:o,offset:l,zFactor:s,gcsFactor:this.isGCS?$t:1,pixelSizeFactor:a?n:0,pixelSizePower:a?i:0,minValue:(u==null?void 0:u.min)??0,maxValue:(u==null?void 0:u.max)??8e3,isOutputRounded:p}}};b([P({json:{write:!0,name:"rasterFunction"}})],Wt.prototype,"functionName",void 0),b([P({type:Du,json:{write:!0,name:"rasterFunctionArguments"}})],Wt.prototype,"functionArguments",void 0),b([P()],Wt.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],Wt.prototype,"isGCS",void 0),b([P({json:{write:!0}})],Wt.prototype,"lookup",void 0),Wt=b([_("esri.layers.support.rasterFunctions.ShadedReliefFunction")],Wt);const Gu=Wt;var us;const _u=new kt({1:"degree",2:"percent-rise",3:"adjusted"},{useNumericKeys:!0});let Ht=us=class extends at{constructor(){super(...arguments),this.slopeType="degree",this.zFactor=1,this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.removeEdgeEffect=!1}clone(){return new us({slopeType:this.slopeType,zFactor:this.zFactor,pixelSizePower:this.pixelSizePower,pixelSizeFactor:this.pixelSizeFactor,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};b([At(_u)],Ht.prototype,"slopeType",void 0),b([P({type:Number,json:{write:!0}})],Ht.prototype,"zFactor",void 0),b([P({type:Number,json:{name:"psPower",write:!0}})],Ht.prototype,"pixelSizePower",void 0),b([P({type:Number,json:{name:"psZFactor",write:!0}})],Ht.prototype,"pixelSizeFactor",void 0),b([P({type:Boolean,json:{write:!0}})],Ht.prototype,"removeEdgeEffect",void 0),Ht=us=b([_("esri.layers.support.rasterFunctions.SlopeFunctionArguments")],Ht);const Lu=Ht;let Ce=class extends it{constructor(){super(...arguments),this.functionName="Slope",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){var e;this.outputPixelType=this._getOutputPixelType("f32");const t=this.sourceRasterInfos[0].clone();return t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),t.statistics=this.functionArguments.slopeType!=="percent-rise"?[{min:0,max:90,avg:1,stddev:1}]:null,t.bandCount=1,this.rasterInfo=t,this.isGCS=((e=t.spatialReference)==null?void 0:e.isGeographic)??!1,{success:!0,supportsGPU:!0}}_processPixels(t){var h;const e=(h=t.pixelBlocks)==null?void 0:h[0];if(e==null)return null;const{zFactor:s,slopeType:n,pixelSizePower:i,pixelSizeFactor:a}=this.functionArguments,{isGCS:o}=this,{extent:l,primaryPixelSizes:u}=t,p=u==null?void 0:u[0],c=p??(l?{x:l.width/e.width,y:l.height/e.height}:{x:1,y:1});return ra(e,{zFactor:s,slopeType:n,pixelSizePower:i,pixelSizeFactor:a,isGCS:o,resolution:c})}_getWebGLParameters(){const{zFactor:t,slopeType:e,pixelSizeFactor:s,pixelSizePower:n}=this.functionArguments;return{zFactor:this.isGCS&&t>=1?t*$t:t,slopeType:e,pixelSizeFactor:s??0,pixelSizePower:n??0,isOutputRounded:yt(this.outputPixelType)}}};b([P({json:{write:!0,name:"rasterFunction"}})],Ce.prototype,"functionName",void 0),b([P({type:Lu,json:{write:!0,name:"rasterFunctionArguments"}})],Ce.prototype,"functionArguments",void 0),b([P()],Ce.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],Ce.prototype,"isGCS",void 0),Ce=b([_("esri.layers.support.rasterFunctions.SlopeFunction")],Ce);const Uu=Ce,An=new kt({1:"min",2:"max",3:"mean",4:"stddev",5:"median",6:"majority",7:"minority"},{useNumericKeys:!0});function ju(r,t){const{fillNoDataOnly:e}=t,{band:s,width:n,height:i,mask:a,outBand:o}=r;if(e&&!a)return void o.set(s);const{statisticsType:l,kernelRows:u,kernelCols:p}=t,c=l==="stddev",h=n*i,f=new Float64Array(h),m=new Float64Array(h),y=new Uint32Array(h);for(let C=0;C<i;C++){const k=C*n;let A=0,S=0,I=0;for(let R=0;R<p;R++)a&&!a[k+R]||(A+=s[k+R],c&&(S+=s[k+R]**2),I++);f[k]=A,m[k]=S,y[k]=I;for(let R=1;R<=n-p;R++){const N=k+R-1,F=N+p;a?(a[N]&&(I--,A-=s[N],c&&(S-=s[N]**2)),a[F]&&(I++,A+=s[F],c&&(S+=s[F]**2))):(A-=s[N],A+=s[F],c&&(S-=s[N]**2,S+=s[F]**2)),f[k+R]=A,y[k+R]=I,c&&(m[k+R]=S)}}const d=new Float64Array(h),v=new Float64Array(h),w=new Uint32Array(h),T=u*n;for(let C=0;C<=n-p;C++){let k=0,A=0,S=0;for(let I=0;I<u;I++){const R=I*n+C;k+=f[R],S+=y[R],c&&(A+=m[R])}d[C]=k,v[C]=A,w[C]=S;for(let I=1;I<=i-u;I++){const R=(I-1)*n+C,N=R+T;k-=f[R],k+=f[N],S-=y[R],S+=y[N],c&&(A-=m[R],A+=m[N]),d[I*n+C]=k,v[I*n+C]=A,w[I*n+C]=S}}const g=Math.floor(u/2),x=Math.floor(p/2);for(let C=g;C<i-g;C++){const k=C*n;for(let A=x;A<n-x;A++){const S=(C-g)*n+A-x,I=w[S];if(I===0||e&&(!a||a[k+A]))continue;const R=d[S]/I,N=c?Math.sqrt((v[S]-d[S]*R)/I):R;o[k+A]=N,a&&(a[k+A]=255)}}}function zu(r,t){const{fillNoDataOnly:e}=t,{band:s,width:n,height:i,mask:a,outBand:o}=r;if(e&&!a)return void o.set(s);const{kernelRows:l,kernelCols:u,statisticsType:p}=t,c=Math.floor(l/2),h=Math.floor(u/2),f=p==="min",m=o.slice(),y=new Uint32Array(n*i);for(let d=c;d<i-c;d++){const v=d*n;for(let w=h;w<n-h;w++){let T=f?Number.MAX_VALUE:-Number.MAX_VALUE,g=0;for(let x=0;x<l;x++)for(let C=0;C<u;C++){const k=v+w+(x-c)*n+C-h;a&&!a[k]||(T=f?Math.min(T,s[k]):Math.max(T,s[k]),g++)}a?(m[v+w]=g===0?0:T,y[v+w]=g):o[v+w]=g===0?0:T}}if(a)for(let d=c;d<i-c;d++){const v=d*n;for(let w=h;w<n-h;w++)if(y[v+w]){if(e&&a[v+w])continue;o[v+w]=m[v+w],a[v+w]=255}}}function Vu(r,t){const{fillNoDataOnly:e}=t,{band:s,width:n,height:i,mask:a,outBand:o}=r;if(e&&!a)return void o.set(s);const{kernelRows:l,kernelCols:u}=t,p=Math.floor(l/2),c=Math.floor(u/2),h=o.slice(),f=new Uint32Array(n*i);for(let m=p;m<i-p;m++){const y=m*n;for(let d=c;d<n-c;d++){if(e&&(a!=null&&a[y+d]))continue;const v=[];for(let w=0;w<l;w++)for(let T=0;T<u;T++){const g=y+d+(w-p)*n+T-c;a&&!a[g]||v.push(s[g])}v.length&&(v.sort((w,T)=>w-T),a?(h[y+d]=v[Math.floor((v.length-1)/2)],f[y+d]=v.length):o[y+d]=v[Math.floor((v.length-1)/2)])}}if(a)for(let m=p;m<i-p;m++){const y=m*n;for(let d=c;d<n-c;d++)if(f[y+d]){if(e&&a[y+d])continue;o[y+d]=h[y+d],a[y+d]=255}}}function Wu(r,t){const{fillNoDataOnly:e}=t,{band:s,width:n,height:i,mask:a,outBand:o}=r;if(e&&!a)return void o.set(s);const{kernelRows:l,kernelCols:u}=t,p=Math.floor(l/2),c=Math.floor(u/2),h=t.statisticsType==="majority",f=l*u,m=o.slice(),y=new Uint32Array(n*i);for(let d=p;d<i-p;d++){const v=d*n;for(let w=c;w<n-c;w++){if(e&&(a!=null&&a[v+w]))continue;const T=new Map;for(let k=0;k<l;k++)for(let A=0;A<u;A++){const S=v+w+(k-p)*n+A-c;if(a&&!a[S])continue;const I=s[S];T.set(I,T.has(I)?T.get(I)+1:1)}if(T.size===0)continue;let g=0,x=0,C=h?0:f+1;for(const k of T.keys())x=T.get(k),h===x>C&&(C=x,g=k);a?(m[v+w]=g,y[v+w]=T.size):o[v+w]=g}}if(a)for(let d=p;d<i-p;d++){const v=d*n;for(let w=c;w<n-c;w++)if(y[v+w]){if(e&&a[v+w])continue;o[v+w]=m[v+w],a[v+w]=255}}}function Hu(r,t){const{mask:e}=r,{fillNoDataOnly:s}=t;if(s&&!e)return r;const{pixels:n,width:i,height:a,bandMasks:o,pixelType:l}=r,u=n.length,p=i*a,c=[],{kernelRows:h,kernelCols:f,statisticsType:m,mirrorEdges:y}=t;if(s&&!e)return r;const d=t.outputPixelType??l,v=[];for(let g=0;g<u;g++){const x=n[g],C=$.createEmptyBand(d,p);s&&C.set(x);const k=(o==null?void 0:o[g])??e,A=(k==null?void 0:k.slice())??null,S={band:x,width:i,height:a,mask:A,outBand:C};switch(m){case"min":case"max":zu(S,t);break;case"mean":case"stddev":ju(S,t);break;case"median":Vu(S,t);break;case"majority":case"minority":Wu(S,t)}y&&!s&&Os(C,i,a,h,f),c.push(C),A&&v.push(A)}let w=v[0]??e;v.length!==u&&(v.length=0),u>1&&(o!=null&&o.length)&&(w=$.combineBandMasks(o));const T=new $({pixelType:d,width:i,height:a,pixels:c,bandMasks:o&&v.length?v:null,mask:w});return T.updateStatistics(),T}var cs;let Ae=cs=class extends at{constructor(){super(...arguments),this.rows=3,this.cols=3,this.fillNoDataOnly=!1,this.statisticsType="min"}clone(){return new cs({rows:this.rows,cols:this.cols,fillNoDataOnly:this.fillNoDataOnly,statisticsType:this.statisticsType,raster:Z(this.raster)})}};b([P({json:{write:!0,read:{source:["kernelRows","rows"],reader:(r,t)=>Number(r??(t==null?void 0:t.kernelRows)??3)}}})],Ae.prototype,"rows",void 0),b([P({json:{write:!0,read:{source:["kernelCols","cols"],reader:(r,t)=>Number(r??(t==null?void 0:t.kernelCols)??3)}}})],Ae.prototype,"cols",void 0),b([P({json:{write:!0}})],Ae.prototype,"fillNoDataOnly",void 0),b([P({json:{read:{source:["statisticsType","type"],reader:(r,t)=>An.fromJSON((t==null?void 0:t.statisticsType)??(t==null?void 0:t.type))??"min"},write:{target:"type"}}}),At(An)],Ae.prototype,"statisticsType",void 0),Ae=cs=b([_("esri.layers.support.rasterFunctions.StatisticsFunctionArguments")],Ae);const Ju=Ae;let Le=class extends it{constructor(){super(...arguments),this.functionName="Statistics",this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{type:t}=this.functionArguments.toJSON();if(t<1||t>7)return{success:!1,supportsGPU:!1,error:`statistics-function: the given statistics type is not supported ${t}`};const e=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(e.pixelType);const s=e.clone();s.pixelType=this.outputPixelType;const{statisticsType:n}=this.functionArguments;return n==="stddev"&&this._removeStatsHistColormapVAT(s),this.rasterInfo=s,{success:!0,supportsGPU:s.bandCount<=3&&t<5}}_processPixels(t){var o;const e=(o=t.pixelBlocks)==null?void 0:o[0];if(e==null)return e;const{statisticsType:s,rows:n,cols:i,fillNoDataOnly:a}=this.functionArguments;return Hu(e,{kernelRows:n,kernelCols:i,fillNoDataOnly:a,outputPixelType:this.outputPixelType,statisticsType:s,mirrorEdges:!0})}_getWebGLParameters(){const{rows:t,cols:e,statisticsType:s,fillNoDataOnly:n}=this.functionArguments;return{fillNoDataOnly:n,kernelRows:t,kernelCols:e,statisticsType:s,clampRange:Qt(this.outputPixelType)}}};b([P({json:{write:!0,name:"rasterFunction"}})],Le.prototype,"functionName",void 0),b([P({type:Ju,json:{write:!0,name:"rasterFunctionArguments"}})],Le.prototype,"functionArguments",void 0),b([P()],Le.prototype,"rasterArgumentNames",void 0),Le=b([_("esri.layers.support.rasterFunctions.StatisticsFunction")],Le);const qu=Le;var ps;let Te=ps=class extends at{constructor(){super(...arguments),this.statistics=null,this.histograms=null}readStatistics(r,t){if(!(r!=null&&r.length))return null;const e=[];return r.forEach(s=>{const n={min:s.min,max:s.max,avg:s.avg??s.mean,stddev:s.stddev??s.standardDeviation};e.push(n)}),e}writeStatistics(r,t,e){if(!(r!=null&&r.length))return;const s=[];r.forEach(n=>{const i={...n,mean:n.avg,standardDeviation:n.stddev};delete i.avg,delete i.stddev,s.push(i)}),t[e]=s}clone(){return new ps({statistics:Z(this.statistics),histograms:Z(this.histograms)})}};b([P({json:{write:!0}})],Te.prototype,"statistics",void 0),b([Xt("statistics")],Te.prototype,"readStatistics",null),b([Ie("statistics")],Te.prototype,"writeStatistics",null),b([P({json:{write:!0}})],Te.prototype,"histograms",void 0),Te=ps=b([_("esri.layers.support.rasterFunctions.StatisticsHistogramFunctionArguments")],Te);const Ku=Te;let Jt=class extends it{constructor(){super(...arguments),this.functionName="StatisticsHistogram",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const t=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType("u8");const e=t.clone(),{statistics:s,histograms:n}=this.functionArguments;return n&&(e.histograms=n),s&&(e.statistics=s),this.rasterInfo=e,{success:!0,supportsGPU:!0}}_processPixels(t){var e;return(e=t.pixelBlocks)==null?void 0:e[0]}};b([P({json:{write:!0,name:"rasterFunction"}})],Jt.prototype,"functionName",void 0),b([P({type:Ku,json:{write:!0,name:"rasterFunctionArguments"}})],Jt.prototype,"functionArguments",void 0),b([P()],Jt.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],Jt.prototype,"indexedColormap",void 0),b([P()],Jt.prototype,"isNoopProcess",void 0),Jt=b([_("esri.layers.support.rasterFunctions.StatisticsHistogramFunction")],Jt);const Yu=Jt;var hs;const Xu=new kt({0:"none",3:"standard-deviation",4:"histogram-equalization",5:"min-max",6:"percent-clip",9:"sigmoid"},{useNumericKeys:!0});let dt=hs=class extends at{constructor(){super(...arguments),this.computeGamma=!1,this.dynamicRangeAdjustment=!1,this.gamma=[],this.histograms=null,this.statistics=null,this.stretchType="none",this.useGamma=!1}writeStatistics(r,t,e){r!=null&&r.length&&(Array.isArray(r[0])||(r=r.map(s=>[s.min,s.max,s.avg,s.stddev])),t[e]=r)}clone(){return new hs({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:Z(this.statistics),gamma:Z(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,histograms:Z(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment,raster:this.raster})}};b([P({type:Boolean,json:{write:!0}})],dt.prototype,"computeGamma",void 0),b([P({type:Boolean,json:{name:"dra",write:!0}})],dt.prototype,"dynamicRangeAdjustment",void 0),b([P({type:[Number],json:{write:!0}})],dt.prototype,"gamma",void 0),b([P()],dt.prototype,"histograms",void 0),b([P({type:Number,json:{write:!0}})],dt.prototype,"maxPercent",void 0),b([P({type:Number,json:{write:!0}})],dt.prototype,"minPercent",void 0),b([P({type:Number,json:{write:!0}})],dt.prototype,"numberOfStandardDeviations",void 0),b([P({type:Number,json:{name:"max",write:!0}})],dt.prototype,"outputMax",void 0),b([P({type:Number,json:{name:"min",write:!0}})],dt.prototype,"outputMin",void 0),b([P({type:Number,json:{write:!0}})],dt.prototype,"sigmoidStrengthLevel",void 0),b([P({json:{type:[[Number]],write:!0}})],dt.prototype,"statistics",void 0),b([Ie("statistics")],dt.prototype,"writeStatistics",null),b([At(Xu)],dt.prototype,"stretchType",void 0),b([P({type:Boolean,json:{write:!0}})],dt.prototype,"useGamma",void 0),dt=hs=b([_("esri.layers.support.rasterFunctions.StretchFunctionArguments")],dt);const Zu=dt;let qt=class extends it{constructor(){super(...arguments),this.functionName="Stretch",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null,this.cutOffs=null}_bindSourceRasters(){this.lookup=null,this.cutOffs=null;const t=this.sourceRasterInfos[0],{pixelType:e}=t,{functionArguments:s}=this,{dynamicRangeAdjustment:n,gamma:i,useGamma:a}=s;if(!n&&["u8","u16","s8","s16"].includes(e)){const p=Kt(s.toJSON(),{rasterInfo:t}),c=yt(this.outputPixelType)?"round":"float";this.lookup=Ur({pixelType:e,...p,gamma:a?i:null,rounding:c}),this.cutOffs=p}else n||(this.cutOffs=Kt(s.toJSON(),{rasterInfo:t}));this.outputPixelType=this._getOutputPixelType(e);const o=t.clone();o.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(o),this.outputPixelType==="u8"&&(o.keyProperties.DataType="processed");const{outputMin:l=0,outputMax:u=255}=this.functionArguments;o.statistics=[];for(let p=0;p<o.bandCount;p++)o.statistics[p]={min:l,max:u};return this.rasterInfo=o,{success:!0,supportsGPU:!n}}_processPixels(t){var o;const e=(o=t.pixelBlocks)==null?void 0:o[0];if(e==null)return e;const{lookup:s}=this;if(s)return rr(e,{...s,outputPixelType:this.rasterInfo.pixelType});const{functionArguments:n}=this,i=this.cutOffs||Kt(n.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:e}),a=n.useGamma?n.gamma:null;return pr(e,{...i,gamma:a,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const{outputMin:t=0,outputMax:e=255,gamma:s,useGamma:n}=this.functionArguments,i=this.rasterInfo.bandCount>=2?3:1,a=n&&(s!=null&&s.length)?Ns(i,s):[1,1,1],{minCutOff:o,maxCutOff:l}=this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,255,255]};o.length===1&&(o[1]=o[2]=o[0],l[1]=l[2]=l[0]);const u=l.map((f,m)=>(e-t)/(l[m]-o[m])),p=yt(this.outputPixelType),c=n&&s?[s[0],s[1]??s[0],s[2]??s[0]]:[1,1,1],h=n?[a[0],a[1]??a[0],a[2]??a[0]]:[1,1,1];return{bandCount:i,minOutput:t,maxOutput:e,minCutOff:o,maxCutOff:l,factor:u,useGamma:n,gamma:c,gammaCorrection:h,stretchType:this.functionArguments.stretchType,isOutputRounded:p,type:"stretch"}}};b([P({json:{write:!0,name:"rasterFunction"}})],qt.prototype,"functionName",void 0),b([P({type:Zu,json:{write:!0,name:"rasterFunctionArguments"}})],qt.prototype,"functionArguments",void 0),b([P()],qt.prototype,"rasterArgumentNames",void 0),b([P({json:{write:!0}})],qt.prototype,"lookup",void 0),b([P({json:{write:!0}})],qt.prototype,"cutOffs",void 0),qt=b([_("esri.layers.support.rasterFunctions.StretchFunction")],qt);const Qu=qt;var fs;let mr=fs=class extends at{constructor(){super(...arguments),this.attributeTableAsRecordSet=null}clone(){return new fs({attributeTableAsRecordSet:Z(this.attributeTableAsRecordSet)})}};b([P({json:{write:!0}})],mr.prototype,"attributeTableAsRecordSet",void 0),mr=fs=b([_("esri.layers.support.rasterFunctions.TableFunctionArguments")],mr);const tc=mr;let Se=class extends it{constructor(){super(...arguments),this.functionName="Table",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const r=this.sourceRasterInfos[0];if(r.bandCount>1||r.pixelType.startsWith("f"))return{success:!1,supportsGPU:!1,error:"table-function: Source data must be single band and integer pixel type."};const{attributeTableAsRecordSet:t}=this.functionArguments;if(!t)return{success:!1,supportsGPU:!1,error:"table-function: Missing attributeTableAsRecordSet argument."};this.outputPixelType=this._getOutputPixelType(r.pixelType);const e=r.clone();return e.pixelType=this.outputPixelType,e.bandCount=1,e.dataType!=="thematic"&&(e.keyProperties=e.keyProperties?{...e.keyProperties,DataType:"thematic"}:{DataType:"thematic"}),this.rasterInfo=e,{success:!0,supportsGPU:!0}}_processPixels(r){var t;return(t=r.pixelBlocks)==null?void 0:t[0]}};b([P({json:{write:!0,name:"rasterFunction"}})],Se.prototype,"functionName",void 0),b([P({type:tc,json:{write:!0,name:"rasterFunctionArguments"}})],Se.prototype,"functionArguments",void 0),b([P()],Se.prototype,"rasterArgumentNames",void 0),b([P()],Se.prototype,"isNoopProcess",void 0),Se=b([_("esri.layers.support.rasterFunctions.TableFunction")],Se);const ec=Se,st=new Map;function rc(r,t){const{rasterFunctionArguments:e}=r;e&&(e.rasters||[e.raster,e.raster2]).forEach(s=>{s&&typeof s!="number"&&(typeof s=="string"?s.startsWith("http")&&(t.includes(s)||t.push(s)):"rasterFunctionArguments"in s&&rc(s,t))})}function sc(r,t){if(t=t??{},"function"in(r=Z(r))&&"arguments"in r&&r.arguments){const e=po(r,new Map,t);if(gs(e),!e.renderingRule)throw new xt("raster-function-helper","Unsupported raster function json.");r=e.renderingRule}if("rasterFunction"in r)return uo(r=ms(r),t);throw new xt("raster-function-helper","unsupported raster function json.")}function nc(r,t){return t[0]==="rasters"&&Array.isArray(r.rasters)?r.rasters:t.map(e=>r[e])}function Tn(r){return!!(r&&typeof r=="object"&&r.rasterFunction&&r.rasterFunctionArguments)}function ms(r){var n;const{rasterFunction:t,rasterFunctionArguments:e}=r,s={};for(const i in e){let a=e[i];const o=i.toLowerCase();if(o==="rasters"&&Array.isArray(a))s.rasters=a.map(l=>Tn(l)?ms(l):l);else switch(Tn(a)&&(a=ms(a)),o){case"dra":s.dra=a;break;case"pspower":s.psPower=a;break;case"pszfactor":s.psZFactor=a;break;case"bandids":s.bandIds=a;break;default:s[i[0].toLowerCase()+i.slice(1)]=a}}return t!=="Local"||(n=s.rasters)!=null&&n.length||(s.rasters=["$$"]),{...r,rasterFunctionArguments:s}}function uo(r,t){var h,f;const{rasterFunction:e,rasterFunctionArguments:s}=r,n=(h=r.outputPixelType)==null?void 0:h.toLowerCase();if(e==null||!st.has(e))throw new xt("raster-function-helper",`unsupported raster function: ${e}`);const i=st.get(e),a=(typeof i.ctor=="function"?i.ctor:i.ctor.default).fromJSON({...r,outputPixelType:n}),{rasterArgumentNames:o}=a,l=[],u=nc(s,o),p=o[0]==="rasters"||o.length>1,c=[];for(let m=0;m<u.length;m++){const y=u[m];let d;y==null||typeof y=="string"&&y.startsWith("$")?l.push(t==null?void 0:t.raster):typeof y=="string"?t[y]&&l.push(t[y]):typeof y!="number"&&"rasterFunction"in y&&(d=uo(y,t),p||(a.functionArguments[o[m]]=d),l.push(d)),p&&c.push(d??y)}if(p&&(o[0]==="rasters"?a.functionArguments.rasters=c:o.forEach((m,y)=>{a.functionArguments[m]=c[y]})),t){a.sourceRasters=l;const m=(f=t.raster)==null?void 0:f.url;m&&(a.mainPrimaryRasterId=m)}return a}function co(r,t){if(r&&t)for(const e in r){const s=r[e];s&&typeof s=="object"&&"type"in s&&(s.type==="RasterFunctionTemplate"?co(s.arguments,t):s.type==="RasterFunctionVariable"&&t[s.name]!=null&&(s.value=t[s.name]))}}function ds(r,t){var n;if(!r||typeof r!="object")return r;const{value:e}=r;if(!e||typeof e!="object")return r.isDataset?"$$":e;if(Array.isArray(e))return e.length===0?[]:e.map(i=>typeof i=="object"&&i.type==="RasterFunctionVariable"?ds(i,t):i);if("value"in e&&["number","string","boolean"].includes(typeof e.value))return e.value;if(r.isDataset&&e.type!=="Scalar")return"$$";if(!("type"in e))return e;let s=e;switch(e.type){case"Scalar":s=e.value;break;case"AlgorithmicColorRamp":s=Sn(e);break;case"MultiPartColorRamp":s={type:"multipart",colorRamps:e.ArrayOfColorRamp.map(Sn)};break;case"ArgumentArray":if((n=e.elements)!=null&&n.length&&e.elements[0].type!=="RasterStatistics"){const i=[];for(let a=0;a<e.elements.length;a++){const o=e.elements[a],{type:l}=o;if(l)if(l==="RasterFunctionTemplate"){const{renderingRule:u}=po(o,t);i.push(u),o._object_id!=null&&t.set(o._object_id,u)}else{if(l!=="RasterFunctionVariable")throw new xt("raster-function-helper","unsupported raster function json.");{const u=ds(o,t);i.push(u),o._object_id!=null&&t.set(o._object_id,u)}}else i.push(o)}s=i}else s=e.elements}return e._object_id!=null&&t.set(e._object_id,s),s}function Sn(r){const t=r.algorithm??"esriHSVAlgorithm";let{FromColor:e,ToColor:s}=r;if(!Array.isArray(e)){const{r:n,g:i,b:a}=Fr({h:e.Hue,s:e.Saturation,v:e.Value});e=[n,i,a,e.AlphaValue]}if(!Array.isArray(s)){const{r:n,g:i,b:a}=Fr({h:s.Hue,s:s.Saturation,v:s.Value});s=[n,i,a,s.AlphaValue]}return{type:"algorithmic",algorithm:t,fromColor:e,toColor:s}}function po(r,t,e){e&&co(r,e);const s={renderingRule:{},templates:t};return ho(r,s),s}function ho(r,t){if(!r||!t.renderingRule)return;const{renderingRule:e,templates:s}=t,{function:n,arguments:i,_object_id:a}=r;if(!n||!i)return;a!=null&&s.set(a,e),e.rasterFunction=n.type.replace("Function",""),e.outputPixelType=n.pixelType;const o={};e.rasterFunctionArguments=o;for(const l in i){if(l==="type"||l==="object_id"||l==="_object_ref_id")continue;const u=i[l];u&&typeof u=="object"&&"type"in u&&(u.type==="RasterFunctionTemplate"||u.type==="RasterFunctionVariable")?(u.type==="RasterFunctionVariable"?o[l]=ds(u,s):(e.rasterFunctionArguments[l]={},ho(u,{renderingRule:e.rasterFunctionArguments[l],templates:s})),u._object_id!=null&&s.set(u._object_id,o[l])):o[l]=u}switch(o.DEM&&!o.Raster&&(o.Raster=o.DEM,delete o.DEM),e.rasterFunction){case"Stretch":oc(o);break;case"Colormap":ic(o);break;case"Convolution":ac(o);break;case"Mask":lc(o)}}function gs(r){const{renderingRule:t,templates:e}=r;if(typeof t!="object"||!(t!=null&&t.rasterFunctionArguments)||!e.size)return;const{rasterFunctionArguments:s}=t;for(const n in s){const i=s[n],a=n==="_object_ref_id"?i:i&&typeof i=="object"&&"_object_ref_id"in i?i._object_ref_id:null;if(a==null)i&&typeof i=="object"&&(i.rasterFunctionArguments&&gs({renderingRule:i,templates:e}),Array.isArray(i)&&i.forEach((o,l)=>{if(typeof o=="object")if(o._object_ref_id!=null){if(!e.has(o._object_ref_id))throw new xt("raster-function-helper",`unsupported raster function json. _object_ref_id: ${i} does not exist`);const u=e.get(a);u&&typeof u=="object"?Object.assign(o,u):i[l]=u}else gs({renderingRule:o,templates:e})}));else{if(!e.has(a))throw new xt("raster-function-helper",`unsupported raster function json. _object_ref_id: ${a} does not exist`);const o=e.get(a);n!=="_object_ref_id"?s[n]=o:o&&typeof o=="object"&&Object.assign(s,o)}}}function oc(r){var t;(t=r.Statistics)!=null&&t.length&&typeof r.Statistics=="object"&&(r.Statistics=r.Statistics.map(e=>[e.min,e.max,e.mean,e.standardDeviation])),r.NumberOfStandardDeviation!=null&&(r.NumberOfStandardDeviations=r.NumberOfStandardDeviation,delete r.NumberOfStandardDeviation)}function ic(r){var t,e;((e=(t=r.ColorRamp)==null?void 0:t.type)==null?void 0:e.toLowerCase())==="randomcolorramp"&&(delete r.ColorRamp,r.ColormapName="Random"),r.ColorSchemeType===0&&delete r.ColorRamp}function ac(r){r.ConvolutionType!=null&&(r.Type=r.ConvolutionType,delete r.ConvolutionType)}function lc(r){var t;(t=r.NoDataValues)!=null&&t.length&&typeof r.NoDataValues[0]=="string"&&(r.NoDataValues=r.NoDataValues.filter(e=>e!=="").map(e=>Number(e)))}st.set("Arithmetic",{desc:"Arithmetic Function",ctor:ol,rasterArgumentNames:["rasters"]}),st.set("Aspect",{desc:"Aspect Function",ctor:al,rasterArgumentNames:["raster"]}),st.set("BandArithmetic",{desc:"Band Arithmetic Function",ctor:El,rasterArgumentNames:["raster"]}),st.set("Colormap",{desc:"Colormap Function",ctor:Hl,rasterArgumentNames:["raster"]}),st.set("ColormapToRGB",{desc:"ColormapToRGB Function",ctor:ql,rasterArgumentNames:["raster"]}),st.set("CompositeBand",{desc:"CompositeBand Function",ctor:Yl,rasterArgumentNames:["rasters"]}),st.set("ComputeChange",{desc:"ComputeChange Function",ctor:iu,rasterArgumentNames:["rasters"]}),st.set("Convolution",{desc:"Convolution Function",ctor:du,rasterArgumentNames:["raster"]}),st.set("ContrastBrightness",{desc:"Contrast Brightness Function",ctor:lu,rasterArgumentNames:["raster"]}),st.set("ExtractBand",{desc:"ExtractBand Function",ctor:bu,rasterArgumentNames:["raster"]}),st.set("Curvature",{desc:"Curvature Function",ctor:yu,rasterArgumentNames:["raster"]}),st.set("Hillshade",{desc:"Hillshade Function",ctor:Iu,rasterArgumentNames:["raster"]}),st.set("ShadedRelief",{desc:"ShadedRelief Function",ctor:Gu,rasterArgumentNames:["raster"]}),st.set("Grayscale",{desc:"Grayscale Function",ctor:Su,rasterArgumentNames:["raster"]}),st.set("Clip",{desc:"Clip Function",ctor:Bl,rasterArgumentNames:["raster"]}),st.set("Local",{desc:"Local Function",ctor:Nu,rasterArgumentNames:["rasters"]}),st.set("Mask",{desc:"Mask Function",ctor:$u,rasterArgumentNames:["raster"]}),st.set("NDVI",{desc:"NDVI Function",ctor:Eu,rasterArgumentNames:["raster"]}),st.set("Remap",{desc:"Remap Function",ctor:Bu,rasterArgumentNames:["raster"]}),st.set("Slope",{desc:"Slope Function",ctor:Uu,rasterArgumentNames:["raster"]}),st.set("Statistics",{desc:"Focal Statistics Function",ctor:qu,rasterArgumentNames:["raster"]}),st.set("StatisticsHistogram",{desc:"Statistics Histogram Function",ctor:Yu,rasterArgumentNames:["raster"]}),st.set("Stretch",{desc:"Stretch Function",ctor:Qu,rasterArgumentNames:["raster"]}),st.set("Table",{desc:"Attribute Table Function",ctor:ec,rasterArgumentNames:["raster"]});let Ze=class extends Lt{get affectsPixelSize(){return!1}forwardTransform(r){return r}inverseTransform(r){return r}};b([P()],Ze.prototype,"affectsPixelSize",null),b([P({json:{write:!0}})],Ze.prototype,"spatialReference",void 0),Ze=b([_("esri.layers.support.rasterTransforms.BaseRasterTransform")],Ze);const Bs=Ze;var ys;function ws(r,t,e){const{x:s,y:n}=t;if(e<2)return{x:r[0]+s*r[2]+n*r[4],y:r[1]+s*r[3]+n*r[5]};if(e===2){const h=s*s,f=n*n,m=s*n;return{x:r[0]+s*r[2]+n*r[4]+h*r[6]+m*r[8]+f*r[10],y:r[1]+s*r[3]+n*r[5]+h*r[7]+m*r[9]+f*r[11]}}const i=s*s,a=n*n,o=s*n,l=i*s,u=i*n,p=s*a,c=n*a;return{x:r[0]+s*r[2]+n*r[4]+i*r[6]+o*r[8]+a*r[10]+l*r[12]+u*r[14]+p*r[16]+c*r[18],y:r[1]+s*r[3]+n*r[5]+i*r[7]+o*r[9]+a*r[11]+l*r[13]+u*r[15]+p*r[17]+c*r[19]}}function kn(r,t,e){const{xmin:s,ymin:n,xmax:i,ymax:a,spatialReference:o}=t;let l=[];if(e<2)l.push({x:s,y:a}),l.push({x:i,y:a}),l.push({x:s,y:n}),l.push({x:i,y:n});else{let c=10;for(let h=0;h<c;h++)l.push({x:s,y:n+(a-n)*h/(c-1)}),l.push({x:i,y:n+(a-n)*h/(c-1)});c=8;for(let h=1;h<=c;h++)l.push({x:s+(i-s)*h/c,y:n}),l.push({x:s+(i-s)*h/c,y:a})}l=l.map(c=>ws(r,c,e));const u=l.map(c=>c.x),p=l.map(c=>c.y);return new _t({xmin:Math.min.apply(null,u),xmax:Math.max.apply(null,u),ymin:Math.min.apply(null,p),ymax:Math.max.apply(null,p),spatialReference:o})}function uc(r){const[t,e,s,n,i,a]=r,o=s*a-i*n,l=i*n-s*a;return[(i*e-t*a)/o,(s*e-t*n)/l,a/o,n/l,-i/o,-s/l]}let St=ys=class extends Bs{constructor(){super(...arguments),this.polynomialOrder=1,this.type="polynomial"}readForwardCoefficients(r,t){const{coeffX:e,coeffY:s}=t;if(!(e!=null&&e.length)||!(s!=null&&s.length)||e.length!==s.length)return null;const n=[];for(let i=0;i<e.length;i++)n.push(e[i]),n.push(s[i]);return n}writeForwardCoefficients(r,t,e){const s=[],n=[];for(let i=0;i<(r==null?void 0:r.length);i++)i%2==0?s.push(r[i]):n.push(r[i]);t.coeffX=s,t.coeffY=n}get inverseCoefficients(){let r=this._get("inverseCoefficients");const t=this._get("forwardCoefficients");return!r&&t&&this.polynomialOrder<2&&(r=uc(t)),r}set inverseCoefficients(r){this._set("inverseCoefficients",r)}readInverseCoefficients(r,t){const{inverseCoeffX:e,inverseCoeffY:s}=t;if(!(e!=null&&e.length)||!(s!=null&&s.length)||e.length!==s.length)return null;const n=[];for(let i=0;i<e.length;i++)n.push(e[i]),n.push(s[i]);return n}writeInverseCoefficients(r,t,e){const s=[],n=[];for(let i=0;i<(r==null?void 0:r.length);i++)i%2==0?s.push(r[i]):n.push(r[i]);t.inverseCoeffX=s,t.inverseCoeffY=n}get affectsPixelSize(){return this.polynomialOrder>0}forwardTransform(r){if(r.type==="point"){const t=ws(this.forwardCoefficients,r,this.polynomialOrder);return new er({x:t.x,y:t.y,spatialReference:r.spatialReference})}return kn(this.forwardCoefficients,r,this.polynomialOrder)}inverseTransform(r){if(r.type==="point"){const t=ws(this.inverseCoefficients,r,this.polynomialOrder);return new er({x:t.x,y:t.y,spatialReference:r.spatialReference})}return kn(this.inverseCoefficients,r,this.polynomialOrder)}clone(){return new ys({polynomialOrder:this.polynomialOrder,forwardCoefficients:this.forwardCoefficients?[...this.forwardCoefficients]:null,inverseCoefficients:this.inverseCoefficients?[...this.inverseCoefficients]:null})}};b([P({json:{write:!0}})],St.prototype,"polynomialOrder",void 0),b([P()],St.prototype,"forwardCoefficients",void 0),b([Xt("forwardCoefficients",["coeffX","coeffY"])],St.prototype,"readForwardCoefficients",null),b([Ie("forwardCoefficients")],St.prototype,"writeForwardCoefficients",null),b([P({json:{write:!0}})],St.prototype,"inverseCoefficients",null),b([Xt("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],St.prototype,"readInverseCoefficients",null),b([Ie("inverseCoefficients")],St.prototype,"writeInverseCoefficients",null),b([P()],St.prototype,"affectsPixelSize",null),b([At({PolynomialXform:"polynomial"})],St.prototype,"type",void 0),St=ys=b([_("esri.layers.support.rasterTransforms.PolynomialTransform")],St);const cc=St;var bs;let Qe=bs=class extends Bs{constructor(){super(...arguments),this.type="gcs-shift",this.tolerance=1e-8}forwardTransform(r){return(r=r.clone()).type==="point"?(r.x>180+this.tolerance&&(r.x-=360),r):(r.xmin>=180-this.tolerance?(r.xmax-=360,r.xmin-=360):r.xmax>180+this.tolerance&&(r.xmin=-180,r.xmax=180),r)}inverseTransform(r){return(r=r.clone()).type==="point"?(r.x<-this.tolerance&&(r.x+=360),r):(r.xmin<-this.tolerance&&(r.xmin+=360,r.xmax+=360),r)}clone(){return new bs({tolerance:this.tolerance})}};b([At({GCSShiftXform:"gcs-shift"})],Qe.prototype,"type",void 0),b([P()],Qe.prototype,"tolerance",void 0),Qe=bs=b([_("esri.layers.support.rasterTransforms.GCSShiftTransform")],Qe);const pc=Qe;var vs;let dr=vs=class extends Bs{constructor(){super(...arguments),this.type="identity"}clone(){return new vs}};b([At({IdentityXform:"identity"})],dr.prototype,"type",void 0),dr=vs=b([_("esri.layers.support.rasterTransforms.IdentityTransform")],dr);const hc=dr,fc={GCSShiftXform:pc,IdentityXform:hc,PolynomialXform:cc};function mc(r){if(!(r==null?void 0:r.type))return null;const e=fc[r==null?void 0:r.type];if(e){const s=new e;return s.read(r),s}return null}class dc{convertVectorFieldData(t){const e=$.fromJSON(t.pixelBlock),s=Fo(e,t.type);return Promise.resolve(s!=null?s.toJSON():null)}computeStatisticsHistograms(t){const e=$.fromJSON(t.pixelBlock),s=ta(e);return Promise.resolve(s)}async decode(t){const e=await Hi(t.data,t.options);return e&&e.toJSON()}symbolize(t){t.pixelBlock=$.fromJSON(t.pixelBlock),t.extent=t.extent?_t.fromJSON(t.extent):null;const e=this.symbolizer.symbolize(t);return Promise.resolve(e!=null?e.toJSON():null)}async updateSymbolizer(t){var e;this.symbolizer=oa.fromJSON(t.symbolizerJSON),t.histograms&&((e=this.symbolizer)==null?void 0:e.rendererJSON.type)==="rasterStretch"&&(this.symbolizer.rendererJSON.histograms=t.histograms)}async updateRasterFunction(t){this.rasterFunction=sc(t.rasterFunctionJSON)}async process(t){var s;const e=this.rasterFunction.process({extent:_t.fromJSON(t.extent),primaryPixelBlocks:t.primaryPixelBlocks.map(n=>n!=null?$.fromJSON(n):null),primaryPixelSizes:(s=t.primaryPixelSizes)==null?void 0:s.map(n=>n!=null?er.fromJSON(n):null),primaryRasterIds:t.primaryRasterIds});return e!=null?e.toJSON():null}stretch(t){const e=this.symbolizer.simpleStretch($.fromJSON(t.srcPixelBlock),t.stretchParams);return Promise.resolve(e==null?void 0:e.toJSON())}estimateStatisticsHistograms(t){const e=to($.fromJSON(t.srcPixelBlock));return Promise.resolve(e)}split(t){const e=$o($.fromJSON(t.srcPixelBlock),t.tileSize,t.maximumPyramidLevel??0,t.useBilinear===!1);return e&&e.forEach((s,n)=>{e.set(n,s==null?void 0:s.toJSON())}),Promise.resolve(e)}clipTile(t){const e=$.fromJSON(t.pixelBlock),s=Mo({...t,pixelBlock:e});return Promise.resolve(s==null?void 0:s.toJSON())}async mosaicAndTransform(t){const e=t.srcPixelBlocks.map(a=>a?new $(a):null),s=Eo(e,t.srcMosaicSize,{blockWidths:t.blockWidths,alignmentInfo:t.alignmentInfo,clipOffset:t.clipOffset,clipSize:t.clipSize});let n,i=s;return t.coefs&&(i=Oo(s,t.destDimension,t.coefs,t.sampleSpacing,t.interpolation)),t.projectDirections&&t.gcsGrid&&(n=Bo(t.destDimension,t.gcsGrid),i=Do(i,t.isUV?"vector-uv":"vector-magdir",n)),{pixelBlock:i==null?void 0:i.toJSON(),localNorthDirections:n}}async createFlowMesh(t,e){const s={data:new Float32Array(t.flowData.buffer),mask:new Uint8Array(t.flowData.maskBuffer),width:t.flowData.width,height:t.flowData.height},{vertexData:n,indexData:i}=await Go(t.meshType,t.simulationSettings,s,e.signal);return{result:{vertexBuffer:n.buffer,indexBuffer:i.buffer},transferList:[n.buffer,i.buffer]}}async getProjectionOffsetGrid(t){const e=_t.fromJSON(t.projectedExtent),s=_t.fromJSON(t.srcBufferExtent);let n=null;t.datumTransformationSteps&&(n=new Co({steps:t.datumTransformationSteps})),(t.includeGCSGrid||Uo(e.spatialReference,s.spatialReference,n))&&await jo();const i=t.rasterTransform?mc(t.rasterTransform):null;return zo({...t,projectedExtent:e,srcBufferExtent:s,datumTransformation:n,rasterTransform:i})}}const op=Object.freeze(Object.defineProperty({__proto__:null,default:dc},Symbol.toStringTag,{value:"Module"}));export{Tc as A,sr as B,Ii as C,Is as D,rc as E,Pi as F,op as G,Ti as L,Jn as N,Ic as P,xr as R,Ac as S,sc as T,qn as U,oa as _,Sc as a,xc as b,qo as c,Qo as d,Ki as e,Fc as f,En as g,ei as h,Cc as i,_n as j,Hi as k,Ec as l,ma as m,Vo as n,Nc as o,ta as p,to as q,Rc as r,$c as s,qi as t,Yi as u,pc as v,ks as w,hi as x,cc as y,ze as z};
